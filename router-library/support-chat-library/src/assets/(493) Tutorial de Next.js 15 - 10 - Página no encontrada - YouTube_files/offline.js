(function(g){var window=this;'use strict';var daD=function(a){var l=new g.Mn("und",new g.ZO("Default","und",!0));l.captionTracks=a.captionTracks;return l},jUc=function(a){return new g.$G(function(l,m){var T=a.length,y=[];
if(T)for(var R=function(d,A){T--;y[d]=A;T==0&&l(y)},H=function(d){m(d)},b,M=0;M<a.length;M++)b=a[M],g.DIR(b,g.qF(R,M),H);
else l(y)})},S1=function(a){this.T=a},fE=function(){S1.apply(this,arguments)},A5V=function(){fE.apply(this,arguments)},Pvr=function(){fE.apply(this,arguments)},Gac=function(){fE.apply(this,arguments)},Vqr=function(){fE.apply(this,arguments)},pHg=function(){fE.apply(this,arguments)},ZQD=function(){fE.apply(this,arguments)},W4c=function(){S1.apply(this,arguments)},c5n=function(){fE.apply(this,arguments)},L4n=function(){fE.apply(this,arguments)},NZI=function(){fE.apply(this,arguments)},QUn=function(){fE.apply(this,
arguments)},tqD=function(){fE.apply(this,arguments)},eac=function(){fE.apply(this,arguments)},F4d=function(){fE.apply(this,arguments)},haX=function(){fE.apply(this,arguments)},OQs=function(){fE.apply(this,arguments)},K4I=function(){fE.apply(this,arguments)},zaI=function(){fE.apply(this,arguments)},vp5=function(){fE.apply(this,arguments)},$ag=function(){S1.apply(this,arguments)},sUs=function(){fE.apply(this,arguments)},SOB=function(){fE.apply(this,arguments)},fn5=function(){fE.apply(this,arguments)},
J5d=function(){fE.apply(this,arguments)},BZ_=function(){fE.apply(this,arguments)},kaI=function(){fE.apply(this,arguments)},npB=function(){fE.apply(this,arguments)},wHs=function(){fE.apply(this,arguments)},Ins=function(){fE.apply(this,arguments)},CvV=function(){S1.apply(this,arguments)},Epr=function(){S1.apply(this,arguments)},opc=function(){S1.apply(this,arguments)},xaI=function(){fE.apply(this,arguments)},Dag=function(){fE.apply(this,arguments)},uyF=function(){fE.apply(this,arguments)},XHX=function(){fE.apply(this,
arguments)},YOV=function(){fE.apply(this,arguments)},Ua_=function(){fE.apply(this,arguments)},r5V=function(){fE.apply(this,arguments)},ax5=function(){fE.apply(this,arguments)},lx5=function(){fE.apply(this,arguments)},mSF=function(){fE.apply(this,arguments)},T9X=function(){fE.apply(this,arguments)},ypd=function(){fE.apply(this,arguments)},RUI=function(){fE.apply(this,arguments)},HaV=function(){fE.apply(this,arguments)},q$B=function(){fE.apply(this,arguments)},bas=function(){fE.apply(this,arguments)},
gxD=function(){fE.apply(this,arguments)},MfF=function(){fE.apply(this,arguments)},iag=function(){fE.apply(this,arguments)},dSD=function(){fE.apply(this,arguments)},j3g=function(){fE.apply(this,arguments)},Ap5=function(){fE.apply(this,arguments)},Ph5=function(){fE.apply(this,arguments)},GtF=function(){fE.apply(this,arguments)},VfI=function(){fE.apply(this,arguments)},pEs=function(){fE.apply(this,arguments)},Zag=function(){S1.apply(this,arguments)},WpV=function(){fE.apply(this,arguments)},cpD=function(){fE.apply(this,
arguments)},Lp5=function(){fE.apply(this,arguments)},N9s=function(){fE.apply(this,arguments)},Q39=function(){fE.apply(this,arguments)},tfF=function(){fE.apply(this,arguments)},eUc=function(){fE.apply(this,arguments)},Fp_=function(){fE.apply(this,arguments)},hUF=function(){fE.apply(this,arguments)},OaD=function(){fE.apply(this,arguments)},KpI=function(){fE.apply(this,arguments)},zU_=function(){fE.apply(this,arguments)},vxV=function(){fE.apply(this,arguments)},$Ss=function(){fE.apply(this,arguments)},
s3D=function(){fE.apply(this,arguments)},S$_=function(){fE.apply(this,arguments)},fx_=function(){fE.apply(this,arguments)},Jpc=function(){fE.apply(this,arguments)},B9d=function(){fE.apply(this,arguments)},ktc=function(){fE.apply(this,arguments)},nxF=function(){fE.apply(this,arguments)},wEr=function(){fE.apply(this,arguments)},IxB=function(){fE.apply(this,arguments)},Ch9=function(){fE.apply(this,arguments)},ExI=function(){fE.apply(this,arguments)},ox_=function(){fE.apply(this,arguments)},xSc=function(){fE.apply(this,
arguments)},DSF=function(){fE.apply(this,arguments)},u0D=function(){fE.apply(this,arguments)},XEd=function(){fE.apply(this,arguments)},Y$s=function(){fE.apply(this,arguments)},US_=function(){fE.apply(this,arguments)},rpD=function(a){a=a.key||a.id;
if(!a)throw Error("Entity key is missing");return a},aLs=function(){if(Jx)return Jx();
var a={};Jx=g.yQ("PersistentEntityStoreDb",{Dl:(a.EntityStore={OZ:1},a.EntityAssociationStore={OZ:2},a),shared:!1,upgrade:function(l,m){m(1)&&g.Bw(g.vw(l,"EntityStore",{keyPath:"key"}),"entityType","entityType");m(2)&&(l=g.vw(l,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.Bw(l,"byParentEntityKey","parentEntityKey"),g.Bw(l,"byChildEntityKey","childEntityKey"))},
version:3});return Jx()},lL_=function(a){return g.xT(aLs(),a)},m2F=function(a){return g.xT((0,g.n55)(),a)},Bm=function(a){this.token=a},kE=function(a,l){l=l===void 0?{}:l;
g.YH.call(this,g.w6D[a],Object.assign({},{name:"PESEncoderError",type:a},l));this.type=a;this.level="WARNING";Object.setPrototypeOf(this,kE.prototype)},TXr=function(a){return new kE("WRONG_DATA_TYPE",{Iz:a})},yC_=function(a){return a instanceof Error?new kE("UNKNOWN_ENCODE_ERROR",{originalMessage:a.message}):new kE("UNKNOWN_ENCODE_ERROR")},RJs=function(a){return a instanceof Error?new kE("UNKNOWN_DECODE_ERROR",{originalMessage:a.message}):new kE("UNKNOWN_DECODE_ERROR")},H1s=function(a,l){a=a instanceof
kE?a:l(a);
g.kt(a);throw a;},qBI=function(){},b1d=function(a,l,m){try{return a.Z(l,m)}catch(T){H1s(T,yC_)}},gGg=function(a){a=(new TextEncoder).encode(a).subarray(0,16);
var l=new Uint8Array(16);l.set(a);return l},nE=function(a){this.T=a},i1I=function(a){var l=MFV[a];
if(l)return l;g.nU(new g.YH("Entity model not found.",{entityType:a}))},d2_=function(a,l){this.T=a;
this.L=l;this.Z={}},ACc=function(a,l){a:{a=jk_(a.L,l.version);
try{var m=a.L(l.data,l.key);break a}catch(T){H1s(T,RJs)}m=void 0}return m},wB=function(a,l,m){return a.T.objectStore("EntityStore").get(l).then(function(T){if(T){if(m&&T.entityType!==m)throw Error("Incorrect entity type");
return ACc(a,T)}})},IJ=function(a,l,m){return m?(m=m.map(function(T){return wB(a,T,l)}),g.Fz.all(m)):a.T.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(l)).then(function(T){return T.map(function(y){return ACc(a,y)})})},Em=function(a,l,m){var T=rpD(l),y=jk_(a.L,1),R=Object.assign({},l);
return a.T.objectStore("EntityStore").get(T).then(function(H){if(H){if(H.entityType!==m)throw Error("Incorrect entity type");R.entityMetadata||(H=ACc(a,H),R.entityMetadata=H.entityMetadata)}}).then(function(){var H={key:T,
entityType:m,data:b1d(y,R,T),version:1};return g.Fz.all([g.Ss(a.T.objectStore("EntityStore"),H),PBs(a,R,m)])}).then(function(){CE(a,T,m);
return T})},GWd=function(a,l,m){l=l.map(function(T){return Em(a,T,m)});
return g.Fz.all(l)},oJ=function(a,l,m){if(m==null?0:m.Hh){var T=new Set;
return VFs(a,l,T).then(function(){for(var R=[],H=g.c(T),b=H.next();!b.done;b=H.next())R.push(oJ(a,b.value));return g.Fz.all(R).then(function(){})})}var y=g.aN(l).entityType;
return g.Fz.all([a.T.objectStore("EntityStore").delete(l),pZX(a,l)]).then(function(){CE(a,l,y)})},Z15=function(a,l){return g.I$(a.T.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(l)},function(m){return g.Fz.all([m.delete(),
pZX(a,m.cursor.primaryKey)]).then(function(){CE(a,m.cursor.primaryKey,l);return g.n2(m)})})},WNc=function(a,l,m,T){var y=jk_(a.L,1);
return wB(a,l,T).then(function(R){if(R){R=g.WX(R,m);var H={key:l,entityType:T,data:b1d(y,R,l),version:1};return g.Fz.all([g.Ss(a.T.objectStore("EntityStore"),H),PBs(a,R,T)])}}).then(function(){CE(a,l,T);
return l})},CE=function(a,l,m){var T=a.Z[m];
T||(T=new Set,a.Z[m]=T);T.add(l)},cCs=function(a,l,m){var T=rpD(l);
m=i1I(m);if(!m)return g.Fz.resolve([]);m=new m(l);a=a.T.objectStore("EntityAssociationStore");l=[];m=g.c(m.L());for(var y=m.next();!y.done;y=m.next())l.push(g.Ss(a,{parentEntityKey:T,childEntityKey:y.value}));return g.Fz.all(l).then(function(R){return R.map(function(H){return H[1]})})},pZX=function(a,l){return a.T.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(l))},PBs=function(a,l,m){var T=rpD(l);
return pZX(a,T).then(function(){return cCs(a,l,m)})},VFs=function(a,l,m){if(m.has(l))return g.Fz.resolve(void 0);
m.add(l);return LNs(a,l).then(function(T){return a.T.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(l)).then(function(){return T})}).then(function(T){var y=g.Fz.resolve(void 0);
T=g.c(T);for(var R=T.next(),H={};!R.done;H={Rq:void 0},R=T.next())H.Rq=R.value,y=y.then(function(b){return function(){return VFs(a,b.Rq,m)}}(H));
return y}).then(function(){})},LNs=function(a,l){var m=a.T.objectStore("EntityAssociationStore");
return m.index("byParentEntityKey").getAll(IDBKeyRange.only(l)).then(function(T){var y=[];T=g.c(T);for(var R=T.next();!R.done;R=T.next())R=R.value,y.push(m.index("byChildEntityKey").getAll(R.childEntityKey));return g.Fz.all(y)}).then(function(T){var y=[];
T=g.c(T);for(var R=T.next();!R.done;R=T.next())R=R.value,R.length===1&&y.push(R[0].childEntityKey);return y})},xE=function(){},NX_=function(){this.T={};
this.T[0]=new xE;if(!g.Q7("aes_pes_encoder_killswitch")){var a=this.T;try{var l=g.UC();var m=gGg(l);var T=new nE(new g.em(m),new g.tE(m))}catch(y){throw a=y instanceof Error?new kE("KEY_CREATION_FAILED",{originalMessage:y.message}):new kE("KEY_CREATION_FAILED"),g.kt(a),a;}a[1]=T}},jk_=function(a,l){l=l===void 0?0:l;
a=a.T[l];if(!a)throw l=new kE("INVALID_ENCODER_VERSION",{Iz:l}),g.kt(l),l;return a},Do=function(a,l){g.k.call(this);
this.token=a;this.T=l;this.observers=[];a=new g.u7.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.UC());a.onmessage=this.L.bind(this);this.channel=a},u8=function(a,l,m){var T,y,R,H;
return g.J(function(b){if(b.L==1)return g.z(b,lL_(a.token),2);if(b.L!=3)return T=b.T,g.z(b,g.s9(T,["EntityStore","EntityAssociationStore"],l,function(M){y=new d2_(M,a.T);return m(y)}),3);
R=b.T;y&&(H=y.Z,Object.keys(H).length>0&&(a.channel.postMessage(H),Qkd(a,H)));return b.return(R)})},Xo=function(a,l,m){return u8(a,{mode:"readwrite",
xX:!0},function(T){return Em(T,l,m)})},tFV=function(a,l){return u8(a,{mode:"readwrite",
xX:!0},function(m){return GWd(m,l,"offlineOrchestrationActionWrapperEntity")})},eJ_=function(a,l){return u8(a,{mode:"readwrite",
xX:!0},function(m){return oJ(m,l)})},FNV=function(a){return u8(a,{mode:"readwrite",
xX:!0},function(l){return Z15(l,"videoPlaybackPositionEntity")})},YE=function(a,l,m){return u8(a,{mode:"readonly",
xX:!0},function(T){return wB(T,l,m)})},Um=function(a,l,m){return u8(a,{mode:"readonly",
xX:!0},function(T){return IJ(T,l,m)})},Qkd=function(a,l){a=g.c(a.observers);
for(var m=a.next();!m.done;m=a.next())m=m.value,m(l)},hJD=function(){var a,l,m;
return g.J(function(T){if(T.L==1)return g.LP(T,2),g.z(T,g.m8(),4);if(T.L!=2){a=T.T;if(!a||!g.rQ()||typeof g.u7.BroadcastChannel==="undefined")return T.return();l=new NX_;return T.return(new Do(a,l))}m=g.OQ(T);m instanceof Error&&g.kt(m);return T.return()})},rB=function(){O1I||(O1I=hJD());
return O1I},KND=function(a){var l;
a=(l=a.options)==null?void 0:l.persistenceOption;return a==="ENTITY_PERSISTENCE_OPTION_PERSIST"||a==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},zJd=function(a){var l;
return g.J(function(m){return m.L==1?g.z(m,rB(),2):(l=m.T)?g.z(m,u8(l,"readwrite",function(T){for(var y={},R=g.c(a),H=R.next(),b={};!H.done;b={Vp:void 0,ub:void 0},H=R.next())b.Vp=H.value,b.Vp.entityKey&&KND(b.Vp)&&(b.ub=g.os(b.Vp.payload),H=void 0,b.Vp.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(H=function(M){return function(){return Em(T,M.Vp.payload[M.ub],M.ub)}}(b)),b.Vp.type==="ENTITY_MUTATION_TYPE_DELETE"&&(H=function(M){return function(){return oJ(T,M.Vp.entityKey)}}(b)),b.Vp.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(H=function(M){return function(){return WNc(T,M.Vp.entityKey,M.Vp.payload[M.ub],M.ub)}}(b)),H&&(y[b.Vp.entityKey]=y[b.Vp.entityKey]?y[b.Vp.entityKey].then(H):H()));
return g.Fz.all(Object.values(y))}),0):m.return()})},vGc=function(a){var l;
return g.J(function(m){if(m.L==1){l=a.mutations;if(!l||l.length<=0)return m.return();if(g.RY){var T={type:"ENTITY_LOADED"};l!==void 0&&(T.payload=l);g.RY.dispatch(T)}return g.z(m,zJd(l),2)}l.length=0;g.c5(m)})},$2I=function(a){return a!==void 0},skX=function(a){var l=g.vV();
l=Object.assign({},l);a=Object.assign({},a);for(var m in l)a[m]?(l[m]!==4&&(l[m]=a[m]),delete a[m]):l[m]!==2&&(l[m]=4);Object.assign(l,a);g.bl5(l);JSON.stringify(l);return l},SBB=function(a){var l,m;
return g.J(function(T){if(T.L==1)return g.z(T,g.m8(),2);if(T.L!=3)return(l=T.T)?g.z(T,g.Si(l),3):T.return();m=T.T;return T.return(g.s9(m,["index","media","captions"],{mode:"readwrite",xX:!0},function(y){var R=IDBKeyRange.bound(a+"|",a+"~");y=[y.objectStore("index").delete(R),y.objectStore("media").delete(R),y.objectStore("captions").delete(R)];return g.Fz.all(y).then(function(){})}))})},fLr=function(){var a,l;
return g.J(function(m){if(m.L==1)return g.z(m,g.m8(),2);if(m.L!=3){a=m.T;if(!a)throw g.t7("rvdfd");return g.z(m,g.Si(a),3)}l=m.T;return m.return(g.s9(l,["index","media"],{mode:"readwrite",xX:!0},function(T){var y={};return g.kT(T.objectStore("index"),{},function(R){var H=R.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),b=g.Fz.resolve(void 0);if(H){var M=H[1];H=H[2];y[M]=y[M]||{};var d;y[M][H]=g.jnw((d=R.getValue())==null?void 0:d.fmts)}else b=R.delete().then(function(){});
return g.Fz.all([g.n2(R),b]).then(function(A){return g.c(A).next().value})}).then(function(){for(var R={},H=g.c(Object.keys(y)),b=H.next();!b.done;b=H.next()){b=b.value;
var M=y[b].v;R[b]=y[b].a&&M?1:2}var d=skX(R);return g.QHt(T.objectStore("media"),{},function(A){var P=A.cursor.key.match(g.V_l);P&&R[P[1]]||T.objectStore("media").delete(A.cursor.key);return g.P0P(A)}).then(function(){return d})})}))})},JC_=function(a,l){var m,T;
return g.J(function(y){if(y.L==1)return g.z(y,g.m8(),2);if(y.L!=3){m=y.T;if(!m)throw g.t7("wct");return g.z(y,g.Si(m),3)}T=y.T;return g.z(y,g.s9(T,["captions"],{mode:"readwrite",xX:!0},function(R){var H=[];R=R.objectStore("captions");for(var b=0;b<l.length;b++){var M=g.Ss(R,l[b],a+"|"+l[b].metadata.vss_id);H.push(M)}return g.Fz.all(H)}),0)})},BXD=function(a){var l,m,T;
return g.J(function(y){if(y.L==1)return l=IDBKeyRange.bound(a+"|",a+"~"),g.z(y,g.m8(),2);if(y.L!=3){m=y.T;if(!m)throw g.t7("gactfv");return g.z(y,g.Si(m),3)}T=y.T;return y.return(T.getAll("captions",l))})},kW9=function(a){return g.J(function(l){g.sS(a,0);
return l.return(SBB(a))})},nGs=function(a){return{context:g.m0(),
videoIds:a}},wZs=function(a){return{context:g.m0(),
playlistIds:a}},ILF=function(a){return{context:g.m0(),
offlinePlaylistSyncChecks:a}},CBs=function(){this.T=new Map},oGX=function(){EGs||(EGs=new CBs);
return EGs},x2X=function(a,l){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:a},metadata:l,statusCode:void 0,csn:void 0,can:void 0}},D2n=function(a,l,m){if(!m){var T=T===void 0?!1:T;
m=a.T.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!m||T)m=g.FH(16),a.T.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",m)}a={flowNonce:m,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:l.eventType};l.metadata&&(a.flowMetadata=l.metadata);l.statusCode!==void 0&&(a.flowEventStatus=l.statusCode);l.csn&&(a.csn=l.csn);l.can&&(a.can=l.can);g.js("flowEvent",a,void 0)},uSD=function(a){var l,m,T,y,R,H,b,M,d,A,P,G,V,p,L,N,e,t,v,S,n,X,D,yp,H5,ad,Md,U,Nd,hz,EQ,ec,MF,KP,Ft,Hn,Q,gw,D9,Nj;
return g.J(function(zd){if(zd.L==1)return g.z(zd,u8(a,{mode:"readonly",xX:!0},function(Gd){return IJ(Gd,"playbackData").then(function(ww){var fD=ww.map(function(K){return K.transfer}).filter(function(K){return!!K}),vn=ww.map(function(K){return K.offlineVideoPolicy}).filter(function(K){return!!K}),h=ww.filter(function(K){return!!K.key}).map(function(K){return g.lZ(g.aN(K.key).entityId,"downloadStatusEntity")});
fD=IJ(Gd,"transfer",fD);vn=IJ(Gd,"offlineVideoPolicy",vn);h=IJ(Gd,"downloadStatusEntity",h);var O=fD.then(function(K){K=K.reduce(function(f,C){(C==null?0:C.offlineVideoStreams)&&f.push.apply(f,g.F(C.offlineVideoStreams));return f},[]).filter(function(f){return!!f});
return IJ(Gd,"offlineVideoStreams",K)});
return g.Fz.all([fD,vn,O,h]).then(function(K){var f=g.c(K);K=f.next().value;var C=f.next().value;var tz=f.next().value;f=f.next().value;return[ww,K,C,tz,f]})})}),2);
if(zd.L!=3)return l=zd.T,g.z(zd,u8(a,{mode:"readonly",xX:!0},function(Gd){return IJ(Gd,"mainDownloadsListEntity").then(function(ww){var fD,vn;return(vn=(fD=ww[0])==null?void 0:fD.downloads)!=null?vn:[]})}),3);
m=zd.T;T=g.c(l);y=T.next().value;R=T.next().value;H=T.next().value;b=T.next().value;M=T.next().value;d=y;A=R;P=H;G=b;V=M;p={};L={};N={};e={};t={};v=[];S=g.c(A);for(n=S.next();!n.done;n=S.next())(X=n.value)&&(p[X.key]=X);D=g.c(P);for(yp=D.next();!yp.done;yp=D.next())(H5=yp.value)&&(L[H5.key]=H5);ad=g.c(V);for(Md=ad.next();!Md.done;Md=ad.next())(U=Md.value)&&(N[U.key]=U);Nd=g.c(G);for(hz=Nd.next();!hz.done;hz=Nd.next())(EQ=hz.value)&&(e[EQ.key]=EQ);ec=g.c(m);for(MF=ec.next();!MF.done;MF=ec.next())KP=
MF.value,Ft=void 0,t[(Ft=KP.videoItem)!=null?Ft:""]=!0,KP.videoItem&&(Q=Hn=void 0,gw=(Q=(Hn=g.aN(KP.videoItem))==null?void 0:Hn.entityId)!=null?Q:"",v.push({externalVideoId:gw}));D9=d.filter(function(Gd){if(!Gd||!Gd.key||!Gd.offlineVideoPolicy)return!1;Gd=g.aN(Gd.key).entityId;Gd=g.lZ(Gd,"downloadStatusEntity");var ww;return!(Gd&&((ww=N[Gd])==null?void 0:ww.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
Nj=D9.map(function(Gd){var ww=p[Gd.transfer],fD=[];if(ww==null?0:ww.offlineVideoStreams)for(var vn=g.c(ww.offlineVideoStreams),h=vn.next();!h.done;h=vn.next())(h=e[h.value])&&fD.push(h);vn=L[Gd.offlineVideoPolicy];h=t;var O=Gd==null?void 0:Gd.playerResponseTimestamp,K=g.aN(vn.key).entityId;Gd=g.lZ(K,"mainVideoEntity");if(vn.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var f="OFFLINE_VIDEO_STATE_DISABLED";vn.expirationTimestamp&&Number(vn.expirationTimestamp)<Date.now()/1E3&&(f="OFFLINE_VIDEO_STATE_EXPIRED")}else if(vn.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")f="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(ww==null?void 0:ww.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":f="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":f="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":f="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":f="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":f="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":f="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:f="OFFLINE_VIDEO_STATE_UNKNOWN"}if(f==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(ww==null?void 0:ww.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":f="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":f="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":f=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}K={id:K,videoState:f};if(ww==null?0:ww.cotn)K.cotn=ww.cotn;if(ww==null?0:ww.maximumDownloadQuality)K.selectedVideoQuality=ww==null?void 0:ww.maximumDownloadQuality;if(ww==null?0:ww.lastProgressTimeMs)K.lastProgressTimeMs=ww.lastProgressTimeMs;O&&(K.playerResponseSavedTimeMs=String(Number(O)*1E3));ww=String;O=0;fD=g.c(fD);for(f=fD.next();!f.done;f=fD.next())if(f=f.value,f.streamsProgress){f=g.c(f.streamsProgress);for(var C=f.next();!C.done;C=f.next()){var tz=void 0;
O+=Number((tz=C.value.numBytesDownloaded)!=null?tz:0)}}K.downloadedBytes=ww(O);K.selectedOfflineMode=h[Gd]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";vn.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(K.offlinePlaybackDisabledReason=vn.offlinePlaybackDisabledReason);return K});
return zd.return({offlineVideos:Nj,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:v}}})})},XZV=function(){this.locks=navigator.locks},YBF=function(){try{var a=g.Yl("ytglobal.locks_");
if(a)return a;var l;if(l=navigator){var m=navigator;l="locks"in m&&!!m.locks}if(l)return g.u7.localStorage&&g.u7.localStorage.getItem("noop"),a=new XZV,g.Xt("ytglobal.locks_",a),a}catch(T){}},aC=function(){},U2F=function(){},rCs=function(a){if(a.includes(":"))throw Error("Invalid user cache name: "+a);
return a+":"+g.UC("CacheStorage get")},ayn=function(){return g.J(function(a){if(lC!==void 0)return a.return(lC);
lC=new Promise(function(l){var m;return g.J(function(T){switch(T.L){case 1:return g.LP(T,2),g.z(T,mx.open("test-only"),4);case 4:return g.z(T,mx.delete("test-only"),5);case 5:g.e7(T,3);break;case 2:if(m=g.OQ(T),m instanceof Error&&m.name==="SecurityError")return l(!1),T.return();case 3:l("caches"in window),g.c5(T)}})});
return a.return(lC)})},mPB=function(){return g.J(function(a){if(a.L==1)return g.z(a,ayn(),2);
if(!a.T)return a.return(void 0);lyB||(lyB=new U2F);return a.return(lyB)})},T3=function(a,l,m){g.nU(new g.YH("Woffle: "+a,m?{cotn:m}:""));
l instanceof Error&&g.nU(l)},TOX=function(a){var l;
return g.J(function(m){if(m.L==1)return g.z(m,uSD(a),2);l=m.T;g.js("offlineStateSnapshot",l);g.c5(m)})},yy=function(a){g.k.call(this);
var l=this;this.api=a;this.lM={t7N:function(){return l.T},
LgL:function(){return l.L}};
typeof g.u7.BroadcastChannel!=="undefined"&&(this.T=new g.u7.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.UC()),this.T.onmessage=this.Z.bind(this),this.L=new g.u7.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.UC()),this.L.onmessage=this.j.bind(this))},RC=function(a,l){a.api.Pz("onOfflineOperationFailure",l);
var m;(m=a.T)==null||m.postMessage(l)},yQ9=function(a,l,m,T){var y=this;
this.J=a;this.N=l;this.visibility=m;this.V=T;this.K=this.B=this.C=this.Z=this.T=!1;this.j=new g.aH(function(){y.ij()});
this.lM={mE:function(){return y.L},
ij:function(){y.ij()},
qwx:function(){return y.j}};
this.visibility.subscribe("visibilitystatechange",function(){y.aY()})},RGc=function(a){if(!a.Z&&!a.T){var l=YBF();
if(l){a.Z=!0;var m=g.UC("OfflineLockManager");l.request("woffle_orchestration_leader:"+m,{},function(){var T,y,R,H;return g.J(function(b){switch(b.L){case 1:return g.LP(b,2),a.L=new g.pr,a.T=!0,a.Z=!1,g.z(b,a.J(),4);case 4:return g.z(b,a.L.promise,5);case 5:g.e7(b,0);break;case 2:T=g.OQ(b),((R=(y=a).V)==null?0:R.call(y,"wo_relinquish_leadership_on_lock_request_error"))||a.ij(),T instanceof Error&&(H=T,H.args=[{name:"WoLockManagerError",RE:T.name}],g.kt(H)),g.c5(b)}})})}}},Hr5=function(a){a.T&&(a.K=
!0,Hq(a))},qAD=function(a,l){a.T&&(a.C=l,Hq(a))},brr=function(a,l){a.T&&(a.B=l,Hq(a))},Hq=function(a){a.B&&a.C&&a.K&&a.visibility.isBackground()?g.l0(a.j,6E4):a.j.stop()},q0=function(a){var l;
a.offlineDeleteReason=(l=a.offlineDeleteReason)!=null?l:"OFFLINE_DELETE_REASON_UNKNOWN";var m;a.offlineModeType=(m=a.offlineModeType)!=null?m:"OFFLINE_NOW";g.js("offlineDeleteEvent",a)},bC=function(a,l){var m=l.videoId;
var T=l.Ms;l=l.offlineModeType;a.encryptedVideoId=m;a.cotn=T==null?void 0:T.cotn;a.offlineabilityFormatType=T==null?void 0:T.maximumDownloadQuality;var y;a.isRefresh=(y=T==null?void 0:T.isRefresh)!=null?y:!1;var R;a.softErrorCount=(R=T==null?void 0:T.transferRetryCount)!=null?R:0;a.offlineModeType=l!=null?l:"OFFLINE_NOW";(a.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&a.statusType==="UNKNOWN_STATUS_TYPE"||!a.transferStatusType&&!a.statusType)&&g.nU(Error("Woffle unknown transfer status"));
g.js("offlineTransferStatusChanged",a)},gYn=function(a){bC({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",
statusType:"ADDED_TO_QUEUE"},a)},MzI=function(a,l,m,T){T={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!T};l&&m&&(l=Math.floor(l/1024).toFixed(),m=Math.floor(m/1024).toFixed(),T.alreadyDownloadedKbytes=l,T.totalFetchedKbytes=l,T.totalContentKbytes=m);bC(T,a)},irc=function(a){bC({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},a)},dPV=function(a){bC({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},a)},jI5=function(a){switch(a){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
gc=function(a){var l,m,T;
return((T=(l=a.actionMetadata)==null?void 0:(m=l.retryScheduleIntervalsInSeconds)==null?void 0:m.length)!=null?T:0)>0},M0=function(a){return a.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!a.entityKey},iC=function(a){return a.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!a.entityKey},dc=function(a){return a.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!a.entityKey},AQI=function(a){return a.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!a.entityKey},
jT=function(a,l,m,T,y){y=y===void 0?!1:y;
var R,H,b,M,d,A;return g.J(function(P){if(P.L==1)return R=g.lZ(a,l),H=g.lZ(a,"downloadStatusEntity"),g.z(P,u8(m,{mode:"readonly",xX:!0},function(G){return g.Fz.all([wB(G,R,l),wB(G,H,"downloadStatusEntity")])}),2);
b=P.T;M=b.length?b[0]:void 0;if(!M)return P.iT(0);d=Pn9;if(A=b.length>1?b[1]:void 0){if(A.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!y)return P.return();A.downloadState=T}else A={key:H,downloadState:T};g.o9(M,d,A);return g.z(P,u8(m,{mode:"readwrite",xX:!0},function(G){return g.Fz.all([Em(G,M,l),Em(G,A,"downloadStatusEntity")])}),0)})},AX=function(a,l){return a.actionType===l.actionType&&a.entityKey===l.entityKey},Pq=function(a,l){if(a&&a.transferState!=="TRANSFER_STATE_COMPLETE"&&a.transferState!==
"TRANSFER_STATE_FAILED"){var m=g.aN(a.key).entityId;
bC({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:m,Ms:a,offlineModeType:l})}},G3=function(a){if(!a||!a.thumbnails)return[];
var l=[];a=g.c(a.thumbnails);for(var m=a.next();!m.done;m=a.next())m=m.value,m.url&&l.push(m.url);return l},G6B=function(a,l,m){m=m===void 0?[]:m;
var T,y,R,H,b,M,d,A,P,G,V,p,L;return g.J(function(N){if(N.L==1)return m.length?g.z(N,Um(a,l),2):N.return([]);T=N.T;y=new Set;R=g.c(T);for(H=R.next();!H.done;H=R.next())if(b=H.value,M=b.id||b.key)d=g.aN(M).entityId,y.add(d);A=[];P=g.c(m);for(G=P.next();!G.done;G=P.next())V=G.value,p=V.offlineVideoData,L=void 0,((L=p)==null?0:L.videoId)&&!y.has(p.videoId)&&A.push(V);return N.return(A)})},Vzs=function(a,l,m){return new g.Dj(a,{cotn:l,
raw_player_response:m,download_media:!0,start:Infinity,disable_watch_next:!0})},pvF=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},Vy=function(a,l,m,T,y,R,H,b,M,d,A){this.entityType=a;
this.actionId=l;this.action=m;this.parentActionId=T;this.rootActionId=y===void 0?l:y;this.childActionIds=R;this.prereqActionId=H;this.postreqActionIds=b;this.hasChildActionFailed=d;this.retryScheduleIndex=0;this.T=A||Date.now();this.retryScheduleIndex=M||0},pX=function(a){if(!a.key)throw Error("Entity key is required.");
if(!a.actionProto)throw Error("OfflineOrchestrationAction is required.");var l=g.aN(a.key),m=g.aN(a.actionProto.entityKey);return new Vy(m.entityType,l.entityId,a.actionProto,a.parentActionId,a.rootActionId,a.childActionIds,a.prereqActionId,a.postreqActionIds,a.retryScheduleIndex,a.hasChildActionFailed,Number(a.enqueueTimeSec)*1E3)},ZT=function(a){return{key:g.lZ(a.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:a.action,parentActionId:a.parentActionId,rootActionId:a.rootActionId,childActionIds:a.childActionIds,prereqActionId:a.prereqActionId,postreqActionIds:a.postreqActionIds,retryScheduleIndex:a.retryScheduleIndex,hasChildActionFailed:a.hasChildActionFailed,enqueueTimeSec:(a.T/1E3).toFixed()}},Zrs=function(){var a;
return g.J(function(l){return l.L==1?g.z(l,mPB(),2):(a=l.T)?l.return(a.delete("yt-player-local-img")):l.return(!0)})},Wq=function(a){var l,m;
return g.J(function(T){if(T.L==1)return g.z(T,mPB(),2);if(T.L!=3){l=T.T;if(!l)throw Error("Cache API not supported");return a.length?g.z(T,l.open("yt-player-local-img"),3):T.return()}m=T.T;return g.z(T,Promise.all(a.map(function(y){return m.delete(y)})),0)})},cq=function(a){var l,m;
return g.J(function(T){if(T.L==1)return g.z(T,mPB(),2);if(T.L!=3){l=T.T;if(!l)throw Error("Cache API not supported");return a.length?g.z(T,l.open("yt-player-local-img"),3):T.return()}m=T.T;return g.z(T,m.addAll(a),0)})},LX=function(a,l,m,T,y){var R,H,b,M,d,A,P,G,V,p,L,N,e,t,v,S,n,X,D,yp,H5,ad,Md,U,Nd,hz,EQ,ec,MF,KP,Ft;
return g.J(function(Hn){switch(Hn.L){case 1:return R=g.lZ(a,"mainVideoEntity"),H=g.lZ(a,"ytMainChannelEntity"),b=g.lZ(a,"transfer"),M=g.lZ(a,"videoDownloadContextEntity"),g.z(Hn,u8(l,{mode:"readonly",xX:!0},function(Q){return g.Fz.all([wB(Q,R,"mainVideoEntity"),wB(Q,H,"ytMainChannelEntity"),wB(Q,b,"transfer"),wB(Q,M,"videoDownloadContextEntity"),IJ(Q,"ytMainChannelEntity"),IJ(Q,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:d=Hn.T;A=g.c(d);P=A.next().value;G=A.next().value;V=A.next().value;p=A.next().value;L=A.next().value;N=A.next().value;e=P;t=G;v=V;S=p;n=L;X=N;if(!e&&!t){Hn.iT(3);break}D=e?G3(e.thumbnail):[];if(!t){yp=[];Hn.iT(4);break}return g.z(Hn,WX_(t,n),5);case 5:yp=Hn.T;case 4:return H5=yp,g.z(Hn,Wq(D.concat(H5)),3);case 3:ad=[];Md=g.lZ(a,"downloadStatusEntity");U=g.c(X);for(Nd=U.next();!Nd.done;Nd=U.next())hz=Nd.value,EQ=g.aN(hz.key).entityId,ec=pX(hz),MF=g.aN(ec.action.entityKey).entityId,EQ!==a&&MF!==
a||AX(m,hz.actionProto)||ad.push(hz.key);return g.z(Hn,u8(l,{mode:"readwrite",xX:!0},function(Q){var gw=ad.map(function(D9){return oJ(Q,D9)});
gw.push(oJ(Q,R,{Hh:!0}));gw.push(oJ(Q,Md,{Hh:!0}));return g.Fz.all(gw)}),7);
case 7:Ft=(KP=S)==null?void 0:KP.offlineModeType,y&&(q0(y),y.offlineModeType&&(Ft=y.offlineModeType)),Pq(v,Ft),RC(T,{entityKey:R,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.c5(Hn)}})},NOB=function(a,l,m,T){var y,R,H,b,M,d,A,P,G,V,p,L,N,e,t,v,S,n,X,D,yp,H5,ad,Md,U,Nd,hz,EQ,ec,MF,KP,Ft,Hn,Q,gw,D9,Nj,zd,Gd,ww,fD,vn,h,O,K,f,C,tz,TH,ZR;
return g.J(function(Rd){switch(Rd.L){case 1:return y=g.lZ(a,"mainPlaylistEntity"),R=g.lZ(a,"ytMainChannelEntity"),g.z(Rd,u8(l,{mode:"readonly",xX:!0},function(v5){return g.Fz.all([wB(v5,y,"mainPlaylistEntity"),wB(v5,R,"ytMainChannelEntity"),IJ(v5,"mainPlaylistEntity"),IJ(v5,"mainDownloadsListEntity"),IJ(v5,"ytMainChannelEntity"),IJ(v5,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:H=Rd.T;b=g.c(H);M=b.next().value;d=b.next().value;A=b.next().value;P=b.next().value;G=b.next().value;V=b.next().value;p=M;L=d;N=A;e=P;t=G;v=V;if(!p&&!L){Rd.iT(3);break}S=p?cQ_(p):[];if(!L){n=[];Rd.iT(4);break}return g.z(Rd,WX_(L,t),5);case 5:n=Rd.T;case 4:return X=n,g.z(Rd,Wq(S.concat(X)),3);case 3:D=[];yp=new Map;if(!p){Rd.iT(7);break}return g.z(Rd,LXg(p,N,e),8);case 8:D=Rd.T;H5=g.c(D);for(ad=H5.next();!ad.done;ad=H5.next())Md=ad.value,yp.set(Md,{videoId:Md,playlistId:a,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return g.z(Rd,u8(l,{mode:"readonly",xX:!0},function(v5){return g.Fz.all([IJ(v5,"transfer"),IJ(v5,"videoDownloadContextEntity")])}),9);
case 9:U=Rd.T;Nd=g.c(U);hz=Nd.next().value;EQ=Nd.next().value;ec=hz;MF=EQ;KP=g.c(ec);for(Ft=KP.next();!Ft.done;Ft=KP.next())Hn=Ft.value,Q=g.aN(Hn.key).entityId,(gw=yp.get(Q))&&Hn&&(gw.cotn=Hn.cotn);D9=g.c(MF);for(Nj=D9.next();!Nj.done;Nj=D9.next())zd=Nj.value,Gd=g.aN(zd.key).entityId,(ww=yp.get(Gd))&&zd&&(ww.offlineModeType=zd.offlineModeType);case 7:fD=[];vn=g.c(v);for(h=vn.next();!h.done;h=vn.next())O=h.value,K=g.aN(O.key).entityId,f=pX(O),K!==a&&f.rootActionId!==a||AX(m,O.actionProto)||fD.push(O.key);
C=g.lZ(a,"mainPlaylistEntity");return g.z(Rd,u8(l,{mode:"readwrite",xX:!0},function(v5){var UQ=fD.map(function(Q5){return oJ(v5,Q5)});
UQ.push(oJ(v5,C,{Hh:!0}));return g.Fz.all(UQ)}),10);
case 10:if(!p){Rd.iT(0);break}D.reverse();if(!D){Rd.iT(0);break}tz=g.c(D);TH=tz.next();case 13:if(TH.done){Rd.iT(0);break}ZR=TH.value;return g.z(Rd,LX(ZR,l,m,T,yp.get(ZR)),14);case 14:TH=tz.next(),Rd.iT(13)}})},tzD=function(a,l,m,T){var y,R,H,b,M,d,A,P,G;
return g.J(function(V){if(V.L==1)return y=g.lZ("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),R=new Map,g.z(V,u8(a,{mode:"readwrite",xX:!0},function(p){var L=IJ(p,"transfer"),N=IJ(p,"offlineOrchestrationActionWrapperEntity"),e=IJ(p,"videoDownloadContextEntity"),t=wB(p,y,"mainDownloadsListEntity");return g.Fz.all([L,N,e,t]).then(function(v){v=g.c(v);var S=v.next().value;var n=v.next().value;var X=v.next().value;var D=v.next().value;v=QIs.map(function(H5){return Z15(p,H5)});
n=g.c(n);for(var yp=n.next();!yp.done;yp=n.next())yp=yp.value,AX(l,yp.actionProto)||v.push(oJ(p,yp.key,{Hh:!0}));D&&(D.downloads=[],v.push(Em(p,D,"mainDownloadsListEntity")));if(X)for(X=g.c(X),D=X.next();!D.done;D=X.next())D=D.value,n=g.aN(D.key).entityId,n=g.lZ(n,"transfer"),R.set(n,D.offlineModeType);return g.Fz.all(v).then(function(){return S})})}),2);
H=V.T;b=g.c(H);for(M=b.next();!M.done;M=b.next())d=M.value,Pq(d,R.get(d.key)),A=g.aN(d.key).entityId,P={videoId:A,offlineDeleteReason:T,cotn:d.cotn,offlineModeType:R.get(d.key)},q0(P),G=g.lZ(A,"mainVideoEntity"),RC(m,{entityKey:G,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.z(V,Zrs(),0)})},cQ_=function(a,l){var m=[];
if(a.thumbnailStyleData){a=g.c(a.thumbnailStyleData);for(var T=a.next();!T.done;T=a.next()){var y=void 0,R=void 0,H=void 0;m=m.concat(G3((y=T.value)==null?void 0:(R=y.value)==null?void 0:(H=R.collageThumbnail)==null?void 0:H.coverThumbnail))}}l=G3(l);return m.concat(l)},LXg=function(a,l,m){var T,y,R,H,b,M,d,A,P,G,V,p,L,N,e,t,v,S,n,X,D,yp,H5;
return g.J(function(ad){T=[];y=new Set;if(m.length)for(R=g.c(m),H=R.next();!H.done;H=R.next())if(b=H.value,M=void 0,(M=b.downloads)==null?0:M.length)for(d=g.c(b.downloads),A=d.next();!A.done;A=d.next())P=A.value,P.videoItem&&(G=g.aN(P.videoItem).entityId,y.add(G));if(a.videos){V=g.c(a.videos);for(p=V.next();!p.done;p=V.next())L=p.value,N=JSON.parse(g.aN(L).entityId),N.videoId&&!y.has(N.videoId)&&T.push(N.videoId);e=g.c(l);for(t=e.next();!t.done;t=e.next())if(v=t.value,v.key!==a.key&&(S=v.videos))for(n=
g.c(S),X=n.next();!X.done;X=n.next())D=X.value,yp=JSON.parse(g.aN(D).entityId),yp.videoId&&(H5=T.indexOf(yp.videoId),H5!==-1&&T.splice(H5,1))}return ad.return(T)})},WX_=function(a,l){var m,T,y,R,H,b,M,d;
return g.J(function(A){m=G3(a.avatar);T=g.c(l);for(y=T.next();!y.done;y=T.next())if(R=y.value,R.id!==a.id)for(H=g.c(G3(R.avatar)),b=H.next();!b.done;b=H.next())M=b.value,d=m.indexOf(M),d!==-1&&m.splice(d,1);return A.return(m)})},eGV=function(a){var l;
return g.J(function(m){l=g.I(a.frameworkUpdates,N0);return a.frameworkUpdates&&l?g.z(m,vGc(l),0):m.return()})},hGX=function(a){var l;
if((l=a.onResponseReceivedActions)!=null&&l.length){var m;a=(m=g.I(g.I(a.onResponseReceivedActions[0],FXB),g.BGr))==null?void 0:m.actions;if(a!=null&&a.length)return a}},OrV=function(a){var l,m,T;
return g.J(function(y){if(y.L==1)return a?g.z(y,YE(a,g.sH,"mainDownloadsListEntity"),2):y.return([]);l=y.T;return((m=l)==null?0:(T=m.downloads)==null?0:T.length)?y.return(l.downloads.map(function(R){var H;return(H=R.videoItem)!=null?H:""})):y.return([])})},zGn=function(a,l){var m;
return g.J(function(T){return T.L==1?g.z(T,KXn(a,l),2):(m=T.T)?g.z(T,u8(a,{mode:"readwrite",xX:!0},function(y){var R=[Em(y,m.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];m.mainDownloadsListEntity&&R.push(Em(y,m.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.Fz.all(R)}),0):T.iT(0)})},KXn=function(a,l){var m,T,y,R,H,b,M,d,A,P,G,V,p,L,N,e,t,v;
return g.J(function(S){if(S.L==1)return m=g.lZ("main_downloads_library_id","mainDownloadsLibraryEntity"),T=g.lZ("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.z(S,u8(a,{mode:"readonly",xX:!0},function(n){return g.Fz.all([wB(n,m,"mainDownloadsLibraryEntity"),wB(n,T,"mainDownloadsListEntity")])}),2);
y=S.T;R=g.c(y);H=R.next().value;b=R.next().value;M=H;d=b;M||(M={id:m});A=g.c(l);for(P=A.next();!P.done;P=A.next())if(G=P.value,G===g.sH){if(M.smartDownloadsList)return S.return();M.smartDownloadsList=G}else if(V=g.aN(G).entityType,p={},V==="mainPlaylistEntity"?p.playlistItem=G:V==="mainVideoEntity"&&(p.videoItem=G),!g.rg(p)){L=void 0;if((L=d)==null?0:L.downloads){N=!1;e=g.c(d.downloads);for(t=e.next();!t.done;t=e.next())if(v=t.value,v.playlistItem===G||v.videoItem===G){N=!0;break}N||d.downloads.push(p)}else d=
{id:T,downloads:[p]};M.downloadsList=T}return S.return({mainDownloadsLibraryEntity:M,mainDownloadsListEntity:d})})},vY5=function(a,l){var m,T,y,R,H,b,M,d,A,P,G,V,p,L,N;
return g.J(function(e){if(e.L==1)return m=g.lZ("main_downloads_library_id","mainDownloadsLibraryEntity"),T=g.lZ("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.z(e,u8(a,{mode:"readonly",xX:!0},function(t){return g.Fz.all([wB(t,m,"mainDownloadsLibraryEntity"),wB(t,T,"mainDownloadsListEntity"),wB(t,g.sH,"mainDownloadsListEntity")])}),2);
y=e.T;R=g.c(y);H=R.next().value;b=R.next().value;M=R.next().value;d=H;A=b;P=M;if(!d)return e.iT(0);if(l===g.sH&&((G=P)==null?0:G.downloads))P.downloads=[];else if((V=A)==null?0:V.downloads)for(p=g.aN(l).entityType,L=0;L<A.downloads.length;L++)if(N=A.downloads[L],p==="mainVideoEntity"&&N.videoItem===l){A.downloads.splice(L,1);break}else if(p==="mainPlaylistEntity"&&N.playlistItem===l){A.downloads.splice(L,1);break}return g.z(e,u8(a,{mode:"readwrite",xX:!0},function(t){var v=[Em(t,d,"mainDownloadsLibraryEntity")];
A&&v.push(Em(t,A,"mainDownloadsListEntity"));P&&v.push(Em(t,P,"mainDownloadsListEntity"));return g.Fz.all(v)}),0)})},Qy=function(a,l){var m,T,y,R,H,b,M,d,A,P,G;
return g.J(function(V){if(V.L==1)return m=g.lZ(l,"transfer"),T=g.lZ(l,"videoDownloadContextEntity"),g.z(V,u8(a,{mode:"readonly",xX:!0},function(p){return g.Fz.all([wB(p,m,"transfer"),wB(p,T,"videoDownloadContextEntity")])}),2);
y=V.T;R=g.c(y);H=R.next().value;b=R.next().value;M=H;d=b;G={videoId:l,cotn:(A=M)==null?void 0:A.cotn,offlineModeType:(P=d)==null?void 0:P.offlineModeType};return V.return(G)})},tX=function(a,l,m,T,y){var R,H,b,M,d,A,P,G,V,p,L,N,e,t,v,S,n,X,D,yp;
return g.J(function(H5){switch(H5.L){case 1:return R=g.lZ(a,"musicTrack"),H=g.lZ(a,"transfer"),g.z(H5,u8(l,{mode:"readonly",xX:!0},function(ad){return g.Fz.all([wB(ad,R,"musicTrack"),wB(ad,H,"transfer"),IJ(ad,"musicTrack"),IJ(ad,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:b=H5.T;M=g.c(b);d=M.next().value;A=M.next().value;P=M.next().value;G=M.next().value;V=d;p=A;L=P;N=G;if(!V){H5.iT(3);break}return g.z(H5,$Pg(V,L),4);case 4:return e=H5.T,g.z(H5,Wq(e),3);case 3:t=[];v=g.c(N);for(S=v.next();!S.done;S=v.next())n=S.value,X=g.aN(n.key).entityId,D=pX(n),yp=g.aN(D.action.entityKey).entityId,X!==a&&yp!==a||AX(m,n.actionProto)||t.push(n.key);return g.z(H5,u8(l,{mode:"readwrite",xX:!0},function(ad){var Md=t.map(function(U){return oJ(ad,U)});
Md.push(oJ(ad,R,{Hh:!0}));return g.Fz.all(Md)}),6);
case 6:Pq(p),y&&q0(y),RC(T,{entityKey:R,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.c5(H5)}})},eT=function(a,l,m,T,y){var R,H,b,M,d,A,P,G,V,p,L,N,e,t,v,S,n,X,D,yp,H5,ad,Md,U,Nd,hz,EQ,ec,MF,KP,Ft,Hn,Q,gw,D9,Nj;
return g.J(function(zd){switch(zd.L){case 1:return R=g.lZ(a,l),H=g.lZ("music_downloads_library_id","musicDownloadsLibraryEntity"),g.z(zd,u8(m,{mode:"readonly",xX:!0},function(Gd){return g.Fz.all([wB(Gd,R,l),wB(Gd,H,"musicDownloadsLibraryEntity"),IJ(Gd,l),IJ(Gd,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:b=zd.T;M=g.c(b);d=M.next().value;A=M.next().value;P=M.next().value;G=M.next().value;V=d;p=A;L=P;N=G;if(!V){zd.iT(3);break}return g.z(zd,$Pg(V,L),4);case 4:return e=zd.T,g.z(zd,Wq(e),3);case 3:t=[];v=new Map;if(!V){zd.iT(6);break}return g.z(zd,sIr(V,L,p),7);case 7:t=zd.T;S=g.c(t);for(n=S.next();!n.done;n=S.next())X=n.value,D=g.aN(X).entityId,v.set(D,{videoId:D,playlistId:a,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return g.z(zd,Um(m,"transfer"),8);case 8:for(yp=zd.T,H5=
g.c(yp),ad=H5.next();!ad.done;ad=H5.next())Md=ad.value,U=g.aN(Md.key).entityId,(Nd=v.get(U))&&Md&&(Nd.cotn=Md.cotn);case 6:hz=[];EQ=g.c(N);for(ec=EQ.next();!ec.done;ec=EQ.next())MF=ec.value,KP=g.aN(MF.key).entityId,Ft=pX(MF),KP!==a&&Ft.rootActionId!==a||AX(T,MF.actionProto)||hz.push(MF.key);Hn=g.lZ(a,l);return g.z(zd,u8(m,{mode:"readwrite",xX:!0},function(Gd){var ww=hz.map(function(fD){return oJ(Gd,fD)});
ww.push(oJ(Gd,Hn,{Hh:!0}));return g.Fz.all(ww)}),9);
case 9:if(!V){zd.iT(0);break}t.reverse();if(!t.length){zd.iT(0);break}Q=g.c(t);gw=Q.next();case 12:if(gw.done){zd.iT(0);break}D9=gw.value;Nj=g.aN(D9).entityId;if(!Nj){zd.iT(13);break}return g.z(zd,tX(Nj,m,T,y,v.get(Nj)),13);case 13:gw=Q.next(),zd.iT(12)}})},FT=function(a,l,m){var T,y,R,H,b,M,d;
return g.J(function(A){if(A.L==1)return g.z(A,u8(a,{mode:"readwrite",xX:!0},function(P){var G=IJ(P,"transfer"),V=IJ(P,"offlineOrchestrationActionWrapperEntity");return g.Fz.all([G,V]).then(function(p){p=g.c(p);var L=p.next().value;var N=p.next().value;p=SA9.map(function(S){return Z15(P,S)});
N=g.c(N);for(var e=N.next();!e.done;e=N.next()){e=e.value;var t=g.aN(e.actionProto.entityKey).entityType==="musicTrack",v=e.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";AX(l,e.actionProto)||t&&(!t||v)||p.push(oJ(P,e.key,{Hh:!0}))}return g.Fz.all(p).then(function(){return L})})}),2);
T=A.T;y=g.c(T);for(R=y.next();!R.done;R=y.next())H=R.value,Pq(H),b=g.aN(H.key).entityId,M={videoId:b,offlineDeleteReason:void 0,cotn:H.cotn},q0(M),d=g.lZ(b,"musicTrack"),RC(m,{entityKey:d,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.z(A,Zrs(),0)})},fyc=function(a){for(var l,m=g.c(a.additionalMetadatas),T=m.next();!T.done;T=m.next())T=T.value,T.offlineMusicVideoData&&(l=T.offlineMusicVideoData);
var y,R,H,b,M;return{id:g.lZ(a.videoId,"musicTrack"),videoId:a.videoId,title:a.title,thumbnailDetails:a.thumbnail,lengthMs:String(Number(a.lengthSeconds)*1E3),albumTitle:(y=l)==null?void 0:y.releaseTitle,musicVideoType:(R=l)==null?void 0:R.musicVideoType,contentRating:{explicitType:(H=l)==null?void 0:H.explicitType},artistNames:((b=l)==null?void 0:b.byline)||((M=l)==null?void 0:M.channelName),downloadMetadata:g.lZ(a.videoId,"musicTrackDownloadMetadataEntity")}},sIr=function(a,l,m){var T,y,R,H,b,M,
d,A,P,G,V,p,L,N,e,t,v,S;
return g.J(function(n){T=[];y=new Set;if((R=m)==null?0:(H=R.downloadedTracks)==null?0:H.length)for(b=g.c(m.downloadedTracks),M=b.next();!M.done;M=b.next())d=M.value,y.add(d);if(a.tracks){A=g.c(a.tracks);for(P=A.next();!P.done;P=A.next())G=P.value,y.has(G)||T.push(G);V=g.c(l);for(p=V.next();!p.done;p=V.next())if(L=p.value,L.id!==a.id&&(N=L.tracks))for(e=g.c(N),t=e.next();!t.done;t=e.next())v=t.value,S=T.indexOf(v),S!==-1&&T.splice(S,1)}return n.return(T)})},$Pg=function(a,l){var m,T,y,R,H,b,M,d;
return g.J(function(A){m=G3(a.thumbnailDetails);T=g.c(l);for(y=T.next();!y.done;y=T.next())if(R=y.value,R.id!==a.id)for(H=g.c(G3(R.thumbnailDetails)),b=H.next();!b.done;b=H.next())M=b.value,d=m.indexOf(M),d!==-1&&m.splice(d,1);return A.return(m)})},JQ9=function(a,l){var m,T,y,R,H,b,M,d,A;
return g.J(function(P){if(P.L==1)return m=g.lZ("music_downloads_library_id","musicDownloadsLibraryEntity"),g.z(P,YE(a,m,"musicDownloadsLibraryEntity"),2);(T=P.T)||(T={id:m});y=g.aN(l).entityType;y==="musicTrack"?(R=T.downloadedTracks)!=null&&R.includes(l)||(T.downloadedTracks=((H=T.downloadedTracks)!=null?H:[]).concat(l)):y==="musicPlaylist"?(b=T.downloadedPlaylists)!=null&&b.includes(l)||(T.downloadedPlaylists=((M=T.downloadedPlaylists)!=null?M:[]).concat(l)):y!=="musicAlbumRelease"||(d=T.downloadedAlbumReleases)!=
null&&d.includes(l)||(T.downloadedAlbumReleases=((A=T.downloadedAlbumReleases)!=null?A:[]).concat(l));return g.z(P,Xo(a,T,"musicDownloadsLibraryEntity"),0)})},BOg=function(a,l){var m,T,y,R,H,b,M;
return g.J(function(d){if(d.L==1)return m=g.lZ("music_downloads_library_id","musicDownloadsLibraryEntity"),g.z(d,YE(a,m,"musicDownloadsLibraryEntity"),2);T=d.T;if(!T)return d.iT(0);y=g.aN(l).entityType;y==="musicTrack"?R=T.downloadedTracks:y==="musicPlaylist"&&(R=T.downloadedPlaylists);if((H=R)==null?0:H.length)for(b=0;b<R.length;b++)if(M=R[b],M===l){R.splice(b,1);break}return g.z(d,Xo(a,T,"musicDownloadsLibraryEntity"),0)})},k6X=function(a){var l=a.videos;
a=[];var m=[];if(l){l=g.c(l);for(var T=l.next();!T.done;T=l.next()){var y=T.value.offlineVideoData.videoId;T=g.lZ(y,"musicTrack");y=g.lZ(y,"musicTrackDownloadMetadataEntity");a.push(T);m.push(y)}}return{Bk:a,Vq:m}},hX=function(a,l,m){l={track:fyc(l)};
m&&(l.playlistId=m);if(a=g.I(a.actionMetadata,nYs))l.maximumDownloadQuality=a.maximumDownloadQuality;return{musicTrackEntityActionMetadata:l}},IyX=function(a){var l,m,T,y,R,H,b,M;
return g.J(function(d){switch(d.L){case 1:return l=g.gs(),m=nGs(a),T=g.R0(wv_),g.LP(d,2),R={Yu:!0},g.z(d,g.Ux(l,m,T,void 0,R),4);case 4:y=d.T;g.e7(d,3);break;case 2:H=g.OQ(d);if(H instanceof g.HX)throw b="GetOffline network manager error: "+H.message,T3(b,H),Error(b);T3("GetOffline fetch request error",H);throw Error("GetOffline fetch request error");case 3:M=O1(y);if(!y)throw T3("Network request failed"),Error("Network request failed");if(M!==void 0)KX(M);else if(!y.videos||!y.videos.length)throw T3("No data"),
Error("No data");return d.return(y.videos.map(function(A){return A.offlineVideoData}))}})},CnF=function(a){var l,m,T,y,R,H,b,M;
return g.J(function(d){switch(d.L){case 1:return l=g.gs(),m=wZs(a),T=g.R0(wv_),g.LP(d,2),R={Yu:!0},g.z(d,g.Ux(l,m,T,void 0,R),4);case 4:y=d.T;g.e7(d,3);break;case 2:H=g.OQ(d);if(H instanceof g.HX)throw b="GetOffline network manager error for playlist: "+H.message,T3(b,H),Error(b);T3("GetOffline fetch request error for playlist",H);throw Error("GetOffline fetch request error for playlist");case 3:M=O1(y);if(!y)throw T3("Network request failed for playlist"),Error("Network request failed for playlist");
if(M!==void 0)KX(M,"playlist");else if(!y.playlists||!y.playlists.length)throw T3("No data for playlist"),Error("No data for playlist");return d.return(y.playlists.map(function(A){return A.offlinePlaylistData}))}})},oYr=function(a,l,m,T){var y,R,H,b,M,d,A,P,G,V,p,L,N,e,t,v,S,n,X,D,yp,H5,ad,Md,U,Nd,hz,EQ,ec,MF;
return g.J(function(KP){switch(KP.L){case 1:return g.z(KP,rB(),2);case 2:y=KP.T;if(!y)return KP.return([]);R=[];if((H=T)==null?0:H.length){R=T;KP.iT(3);break}return g.z(KP,Um(y,"mainPlaylistEntity"),4);case 4:R=KP.T;case 3:if(!R.length)return KP.return([]);b=[];M=Date.now()/1E3;d=g.c(R);A=d.next();case 5:if(A.done)return b.length?g.z(KP,EY9(b),10):KP.return([]);P=A.value;if(!P.downloadState){G=void 0;KP.iT(8);break}return g.z(KP,YE(y,P.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:G=
KP.T;case 8:V=G;p=void 0;N=(L=(p=P)==null?void 0:p.entityMetadata)&&L.nextAutoRefreshIntervalSeconds?Number(L.nextAutoRefreshIntervalSeconds):NaN;e=Number.isNaN(N)?a:N;v=t=void 0;S=((t=V)==null?0:t.lastSyncedTimestampMillis)?Number((v=V)==null?void 0:v.lastSyncedTimestampMillis)/1E3:0;X=n=void 0;D=((n=V)==null?0:n.addedTimestampMillis)?Number((X=V)==null?void 0:X.addedTimestampMillis)/1E3:0;if(m||!L||S+e<=M){yp=[];H5=void 0;if((H5=P.videos)==null?0:H5.length)for(ad=g.c(P.videos),Md=ad.next();!Md.done;Md=
ad.next())U=Md.value,Nd=JSON.parse(g.aN(U).entityId),Nd.videoId&&yp.push(Nd.videoId);hz="0";L&&(EQ=void 0,hz=String(Number((EQ=L.offlineLastModifiedTimestampSeconds)!=null?EQ:0).toFixed()));ec={playlistId:P.playlistId,videoIds:yp,offlineLastModifiedTimestamp:hz,autoSync:l,offlineDateAddedTimestamp:String(D.toFixed())};b.push(ec)}A=d.next();KP.iT(5);break;case 10:return MF=KP.T,KP.return(MF)}})},xPB=function(){var a,l,m,T,y;
return g.J(function(R){if(R.L==1)return g.z(R,rB(),2);if(R.L!=3)return(a=R.T)?g.z(R,Um(a,"refresh"),3):R.return(!1);l=R.T;if((m=l[0])==null||!m.refreshTime)return R.return(!1);T=Number(l[0].refreshTime);y=Date.now()/1E3;return R.return(isFinite(T)&&y>=T)})},ues=function(a,l){var m,T,y;
return g.J(function(R){switch(R.L){case 1:return g.LP(R,2),g.z(R,DP9(a,l),4);case 4:return T=R.T,g.z(R,eGV(T),5);case 5:m=hGX(T);g.e7(R,3);break;case 2:y=g.OQ(R),T3("getAndProcessSmartDownloadsResponse request or processing error",y);case 3:return R.return(m)}})},Xvr=function(a,l,m,T){var y,R,H,b,M,d,A,P,G,V,p,L,N,e,t,v,S,n,X,D,yp,H5,ad,Md,U,Nd,hz,EQ,ec,MF;
return g.J(function(KP){switch(KP.L){case 1:return g.z(KP,rB(),2);case 2:y=KP.T;if(!y)return KP.return([]);R=[];if((H=T)==null?0:H.length){R=T;KP.iT(3);break}return g.z(KP,Um(y,"musicPlaylist"),4);case 4:R=KP.T;case 3:if(!R.length)return KP.return([]);b=[];M=Date.now()/1E3;d=g.c(R);A=d.next();case 5:if(A.done)return b.length?g.z(KP,EY9(b),10):KP.return([]);P=A.value;G=void 0;p=(V=(G=P)==null?void 0:G.entityMetadata)&&V.nextAutoRefreshIntervalSeconds?Number(V.nextAutoRefreshIntervalSeconds):NaN;L=
Number.isNaN(p)?a:p;e=N=0;t="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!P.downloadMetadata){KP.iT(8);break}return g.z(KP,YE(y,P.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:v=KP.T,n=S=void 0,N=Number((n=(S=v)==null?void 0:S.addedTimestampMillis)!=null?n:"0")/1E3,D=X=void 0,e=Number((D=(X=v)==null?void 0:X.lastModifiedTimestampMillis)!=null?D:"0")/1E3,H5=yp=void 0,t=(H5=(yp=v)==null?void 0:yp.syncState)!=null?H5:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:ad=void 0;if(m||t!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||
!V||Number((ad=V.lastSyncedTimestampSeconds)!=null?ad:0)+L<=M){Md=[];U=void 0;if((U=P.tracks)==null?0:U.length)for(Nd=g.c(P.tracks),hz=Nd.next();!hz.done;hz=Nd.next())EQ=hz.value,Md.push(g.aN(EQ).entityId);ec={playlistId:P.playlistId,videoIds:Md,offlineLastModifiedTimestamp:String(e.toFixed()),autoSync:l,offlineDateAddedTimestamp:String(N.toFixed())};b.push(ec)}A=d.next();KP.iT(5);break;case 10:return MF=KP.T,KP.return(MF)}})},DP9=function(a,l){var m,T,y,R,H,b,M,d,A,P;
return g.J(function(G){switch(G.L){case 1:return m=g.gs(),g.z(G,rB(),2);case 2:T=G.T;if(!T){G.iT(3);break}return g.z(G,uSD(T),4);case 4:y=G.T;case 3:var V=y;R={context:g.m0(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:a},offlineClientState:V,clientStateRequestData:{preferredFormatType:l}}}};H=g.R0(YA9);g.LP(G,5);M={Yu:!0};return g.z(G,g.Ux(m,R,H,void 0,M),7);case 7:b=G.T;g.e7(G,6);break;case 5:d=g.OQ(G);if(d instanceof g.HX)throw A=
"DPS network manager error for smart downloads: "+d.message,T3(A,d),Error(A);T3("DPS fetch request error for smart downloads",d);throw Error("DPS fetch request error for smart downloads");case 6:P=O1(b);if(b)P!==void 0&&KX(P,"smart downloads");else throw T3("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return G.return(b)}})},rQc=function(a,l){var m,T,y,R,H,b,M,d;
return g.J(function(A){switch(A.L){case 1:return m=g.gs(),T={context:g.m0(),videoPlaybackPositionEntities:a,lastSyncTimestampUsec:l},y=g.R0(UPn),g.LP(A,2),H={Yu:!0},g.z(A,g.Ux(m,T,y,void 0,H),4);case 4:R=A.T;g.e7(A,3);break;case 2:b=g.OQ(A);if(b instanceof g.HX)throw M="VPPS network manager error: "+b.message,T3(M,b),Error(M);T3("VPPS fetch request error",b);throw Error("VPPS fetch request error");case 3:d=O1(R);if(R)d!==void 0&&KX(d,"position sync");else throw T3("Network request failed for position sync"),
Error("Network request failed for position sync");return A.return(R)}})},lKg=function(a,l,m){var T,y,R,H,b,M,d,A;
return g.J(function(P){switch(P.L){case 1:T=g.gs();var G=m.refreshData,V=m.isEnqueuedForExpiredStreamUrlRefetch,p=m.IJ,L=m.offlineSourceData,N=m.mediaCapabilities,e={entityKey:a};G&&(e.refreshData=G);V&&(e.isExpiredStreamUrlRefetch=V);p&&(e.downloadParameters=p);L&&(e.offlineSourceData=L);G={context:g.qh(l),signatureTimestamp:20209,videos:[e]};N&&(G.mediaCapabilities=N);y=G;R=g.R0(aKc);g.LP(P,2);b={Yu:!0};return g.z(P,g.Ux(T,y,R,void 0,b),4);case 4:H=P.T;g.e7(P,3);break;case 2:M=g.OQ(P);if(M instanceof
g.HX)throw d="GetPDE network manager error: "+M.message,T3(d,M),Error(d);T3("GetPDE fetch request error",M);throw Error("GetPDE fetch request error");case 3:A=O1(H);if(H)A!==void 0&&KX(A,"PDE");else throw T3("Network request failed for PDE"),Error("Network request failed for PDE");return P.return(H)}})},O1=function(a){var l;
return(l=a.errorMetadata)==null?void 0:l.status},KX=function(a,l){l=l?" for "+l:"";
if(a===0)throw a="Empty response body"+l,T3(a),Error(a);a="Response with error"+l;T3(a);throw Error(a);},EY9=function(a){var l,m,T,y,R,H,b,M;
return g.J(function(d){switch(d.L){case 1:return l=g.gs(),m=ILF(a),T=g.R0(mVs),g.LP(d,2),R={Yu:!0},g.z(d,g.Ux(l,m,T,void 0,R),4);case 4:y=d.T;g.e7(d,3);break;case 2:H=g.OQ(d);if(H instanceof g.HX)throw b="offlinePlaylistSyncCheck network manager error: "+H.message,T3(b,H),Error(b);T3("offlinePlaylistSyncCheck fetch request error",H);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:M=O1(y);if(!y)throw T3("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(M!==void 0)KX(M,"playlist sync");else if(!y.offlinePlaylistSyncCheckDatas||!y.offlinePlaylistSyncCheckDatas.length)throw T3("No data for playlist sync"),Error("No data for playlist sync");return d.return(y.offlinePlaylistSyncCheckDatas.map(function(A){return A.offlinePlaylistSyncCheckData}))}})},z3=function(a){this.T=a},TRD=function(a,l){var m,T,y,R,H,b;
return g.J(function(M){switch(M.L){case 1:m=new Map,T=g.c(l),y=T.next();case 2:if(y.done){M.iT(4);break}R=y.value;H=m;b=H.set;return g.z(M,a.L(R),5);case 5:b.call(H,R,M.T);y=T.next();M.iT(2);break;case 4:return M.return(m)}})},vq=function(a,l,m,T,y,R){l=g.lZ(l,m);
T=Object.assign({},R,{priority:T,retryScheduleIntervalsInSeconds:y});return{actionType:a,entityKey:l,actionMetadata:T}},$o=function(a,l,m,T,y,R){this.status=a;
this.T=l;this.j=m;this.L=T;this.Z=y;this.downloadState=R},yyV=function(a,l,m){this.T=a;
this.aj=l;this.Z=m},qds=function(a,l){var m,T,y,R,H,b,M,d,A;
return g.J(function(P){switch(P.L){case 1:return m=l.entityKey,y=(T=g.I(l.actionMetadata,s1))==null?void 0:T.isEnqueuedForExpiredStreamUrlRefetch,g.LP(P,2),R=void 0,g.z(P,RWg(a,l),4);case 4:R=P.T;g.LP(P,5);var G=(G=g.I(l.actionMetadata,s1))?{maximumDownloadQuality:G.maximumDownloadQuality}:void 0;return g.z(P,lKg(m,a.aj,{isEnqueuedForExpiredStreamUrlRefetch:y,IJ:G,offlineSourceData:R}),7);case 7:H=P.T;g.e7(P,6,2);break;case 5:return g.OQ(P,2),b=gc(l)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",T3("PDE handleAdd error"),P.return(ST(l,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",b,"DOWNLOAD_STATE_FAILED"));case 6:return g.z(P,HGD(a,H,l),8);case 8:return P.return(ST(l,!0,H.orchestrationActions));case 2:return M=g.OQ(P),d="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",A="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",M instanceof g.Ww&&M.type==="QUOTA_EXCEEDED"&&(d="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
A="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),T3("PDE handleAdd error"),P.return(ST(l,!1,void 0,d,A,"DOWNLOAD_STATE_FAILED"))}})},MYr=function(a,l){var m,T,y,R,H,b,M,d,A,P,G,V,p,L,N,e,t,v,S,n,X,D,yp,H5;
return g.J(function(ad){switch(ad.L){case 1:return m=l.entityKey,T=g.aN(m).entityId,g.z(ad,u8(a.T,{mode:"readonly",xX:!0},function(Md){var U=wB(Md,m,"playbackData"),Nd=wB(Md,g.lZ(T,"offlineVideoPolicy"),"offlineVideoPolicy");Md=wB(Md,g.lZ(T,"transfer"),"transfer");return g.Fz.all([U,Nd,Md])}),2);
case 2:y=ad.T;R=g.c(y);H=R.next().value;b=R.next().value;M=R.next().value;d=H;A=b;P=M;if(!d||!A)return ad.return(ST(l,!0));G=[];L=((p=d)==null?0:p.playerResponseJson)?JSON.parse(d.playerResponseJson):null;if(!(P&&L&&a.aj.V("html5_refresh_deprecated_downloads"))){ad.iT(3);break}V=bGs(a,L,P);return g.z(ad,g$s(a,P),4);case 4:G=ad.T;case 3:N={lastPlayerResponseTimestampSeconds:d.playerResponseTimestamp,offlineToken:A.offlineToken,formatIds:G};e={};if((t=P)==null?0:t.maximumDownloadQuality)e.maximumDownloadQuality=
P.maximumDownloadQuality;g.LP(ad,5);v=void 0;return g.z(ad,RWg(a,l),7);case 7:return v=ad.T,g.LP(ad,8),g.z(ad,lKg(m,a.aj,{refreshData:N,IJ:e,offlineSourceData:v,mediaCapabilities:V}),10);case 10:S=ad.T;g.e7(ad,9,5);break;case 8:return g.OQ(ad,5),n=gc(l)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",T3("PDE handleRefresh error"),ad.return(ST(l,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",n,
"DOWNLOAD_STATE_FAILED"));case 9:return g.z(ad,HGD(a,S,l),11);case 11:return ad.return(ST(l,!0,S.orchestrationActions));case 5:return X=g.OQ(ad),D="PDE handleRefresh error",X instanceof Error&&(D="PDE handleRefresh error: "+X.message),yp="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",H5="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",X instanceof g.Ww&&X.type==="QUOTA_EXCEEDED"&&(yp="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",H5="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
T3(D),ad.return(ST(l,!1,void 0,yp,H5,"DOWNLOAD_STATE_FAILED"))}})},RWg=function(a,l){var m,T,y,R;
return g.J(function(H){if(H.L==1)return m=g.aN(l.entityKey).entityId,T=g.lZ(m,"videoDownloadContextEntity"),g.z(H,YE(a.T,T,"videoDownloadContextEntity"),2);y=H.T;return(R=y)!=null&&R.offlineModeType?H.return({offlineModeType:y.offlineModeType}):H.return(void 0)})},HGD=function(a,l,m){var T,y,R,H,b;
return g.J(function(M){if(M.L==1){if(!l.frameworkUpdates||!g.I(l.frameworkUpdates,N0))return M.return();if(!(g.I(l.frameworkUpdates,N0).mutations&&g.I(l.frameworkUpdates,N0).mutations.length>0&&g.I(l.frameworkUpdates,N0).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return M.iT(2);T=g.aN(g.I(l.frameworkUpdates,N0).mutations[0].entityKey).entityId;return g.z(M,Qy(a.T,T),3)}if(M.L!=2){y=M.T;R=g.I(m.actionMetadata,s1);if(b=(H=R)==null?void 0:H.playlistId)y.playlistId=b;y.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.aX(a.aj)?g.z(M,LX(T,a.T,m,a.Z,y),2):g.IE(a.aj)?g.z(M,tX(T,a.T,m,a.Z),2):M.iT(2)}return g.z(M,vGc(g.I(l.frameworkUpdates,N0)),0)})},ST=function(a,l,m,T,y,R){return new $o(l?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",gc(a),m,T,y,R)},bGs=function(a,l,m){l=Vzs(a.aj,m.cotn,l);
m=g.i9(l);return g.upl(l,m,a.aj)},g$s=function(a,l){var m,T,y,R,H,b,M,d,A,P,G;
return g.J(function(V){if(V.L==1)return m=[],g.z(V,u8(a.T,{mode:"readonly",xX:!0},function(p){var L=[],N=l.offlineVideoStreams;if(N){N=g.c(N);for(var e=N.next();!e.done;e=N.next())L.push(wB(p,e.value,"offlineVideoStreams"))}return g.Fz.all(L)}),2);
if(T=V.T)for(y=g.c(T),R=y.next();!R.done;R=y.next())if(H=R.value,b=void 0,(b=H)==null?0:b.streamsProgress)for(M=H.streamsProgress,d=0;d<M.length;d++)A=M[d],P=JSON.parse(A.formatStreamBytes),G={itag:P.itag,lmt:P.lastModified,xtags:P.xtags},m.push(G);return V.return(m)})},iG5=function(a,l){this.T=a;
this.aj=l},dVs=function(a,l){var m,T,y,R,H,b,M,d,A,P,G,V;
return g.J(function(p){switch(p.L){case 1:return m=gc(l),g.z(p,Um(a.T,"videoPlaybackPositionEntity"),2);case 2:T=p.T;if(T.length===0)return p.return(new $o("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",m));g.LP(p,3);return g.z(p,Bm.getInstance(),5);case 5:y=p.T;if(!y)throw Error("prefStorage is undefined");return g.z(p,y.get("psi"),6);case 6:return R=p.T,M=(b=(H=R)==null?void 0:H.wG)!=null?b:"0",g.z(p,rQc(T,M),7);case 7:return d=p.T,A={isPaused:d.watchHistoryPaused,wG:d.syncTimestampUsec},g.z(p,y.set("psi",
A),8);case 8:if(A.isPaused){p.iT(9);break}P=g.I(d.frameworkUpdates,N0);if(!d.frameworkUpdates||!P){p.iT(9);break}return g.z(p,vGc(P),9);case 9:g.e7(p,4);break;case 3:return G=g.OQ(p),V="PPE handleRefresh error: "+(G instanceof Error?G.message:"unknown error"),T3(V),p.return(new $o("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",m,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return p.return(new $o("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
m))}})},Ayn=function(a,l){var m,T,y,R,H,b,M,d;
return g.J(function(A){switch(A.L){case 1:return m=gc(l),T=g.aN(l.entityKey).entityId,g.LP(A,2),g.z(A,Bm.getInstance(),4);case 4:y=A.T;if(!y)throw Error("prefStorage is undefined");return g.z(A,y.get("psi"),5);case 5:R=A.T;H=g.I(l.actionMetadata,jAs);if(((b=R)==null?void 0:b.isPaused)!==!1||(M=H)==null||!M.lastPlaybackPositionSeconds){A.iT(6);break}d={key:g.lZ(T,"videoPlaybackPositionEntity"),videoId:T,lastPlaybackPositionSeconds:H.lastPlaybackPositionSeconds};return g.z(A,Xo(a.T,d,"videoPlaybackPositionEntity"),
6);case 6:g.e7(A,3);break;case 2:return g.OQ(A),A.return(new $o("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",m,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return A.return(new $o("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",m))}})},P_I=function(a,l){var m,T,y;
return g.J(function(R){switch(R.L){case 1:m=gc(l);g.LP(R,2);T=g.aN(l.entityKey).entityId;if(T==="!*$_ALL_ENTITIES_!*$")return g.z(R,FNV(a.T),5);y=g.lZ(T,"videoPlaybackPositionEntity");return g.z(R,eJ_(a.T,y),5);case 5:g.e7(R,3);break;case 2:return g.OQ(R),R.return(new $o("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",m,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return R.return(new $o("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
m))}})},GJF=function(a,l){this.api=a;
this.T=l;this.logger=new g.bw("woffle");this.L=!1;this.lM={DB:this.DB};this.logger.debug("Initialized OfflineMediaManager")},VYV=function(a){return g.J(function(l){return l.return(kW9(a))})},pfs=function(a){var l;
return g.J(function(m){if(m.L==1)return g.z(m,g.A_w(a),2);l=m.T;return m.return(l.filter(function(T){return!!T.url}).map(function(T){return T.url}))})},fX=function(a,l){var m=g.$W(l);
if(m===1||m===0)return Promise.resolve();(m=ZGn(a,l))&&m.stopVideo();a.Z=0;return VYV(l)},JX=function(a,l,m,T){m=m===void 0?!1:m;
T=T===void 0?!0:T;var y=typeof l==="string"?l:l.videoDetails.videoId;g.$W(y)===2&&((l=ZGn(a,y))?l.stopVideo():a.logger.info(function(){return"Corresponding player for "+y+" not found. Pausing anyway"}),g.sS(y,2),a.Z=2,m?Wy5(a.T):T&&cyn(a.T))},ZGn=function(a,l){var m;
return((m=a.player)==null?void 0:m.getVideoData().videoId)===l?a.player:null},LyI=function(a,l,m){l.getPlayerResponse();
g.sS(l.videoId,2);a.Z=2;a.L=!1;var T;(T=a.player)==null||T.dispose();a.player=a.api.oT(l);l={};a.player.H7((l.localmediachange=a.oE,l.signatureexpired=a.pC,l.statechange=a.s0b,l),a);var y=a.DB(m);a.player.kG(g.du(y,y,!0,"m"),!1);a.logger.debug(function(){return"Starting headless playback with quality: "+y});
a.player.rp(!1)},NR9=function(a,l){this.T=a;
this.aj=l},tYI=function(a,l){var m,T;
return g.J(function(y){switch(y.L){case 1:return m=gc(l),g.z(y,YE(a.T,l.entityKey,"transfer"),2);case 2:if(T=y.T)return y.return(new $o("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",m));g.LP(y,3);return g.z(y,QAc(a,l),5);case 5:g.e7(y,4);break;case 3:return g.OQ(y),y.return(new $o("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",m,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return y.return(new $o("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
m))}})},eWX=function(a,l){var m,T;
return g.J(function(y){switch(y.L){case 1:return m=gc(l),g.z(y,YE(a.T,l.entityKey,"transfer"),2);case 2:T=y.T;if(!T||T.transferState!=="TRANSFER_STATE_COMPLETE")return y.return(new $o("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",m));g.LP(y,3);return g.z(y,QAc(a,l,!0),5);case 5:g.e7(y,4);break;case 3:return g.OQ(y),y.return(new $o("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",m,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return y.return(new $o("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",m))}})},Fy_=function(a,l){var m,T,y,R,H,b,M,d,A,P;
return g.J(function(G){switch(G.L){case 1:return m=gc(l),T=g.aN(l.entityKey).entityId,g.z(G,u8(a.T,{mode:"readonly",xX:!0},function(V){var p=wB(V,l.entityKey,"transfer");V=wB(V,g.lZ(T,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.Fz.all([p,V])}),2);
case 2:y=G.T;R=g.c(y);H=R.next().value;b=R.next().value;M=H;d=b;if(!M||M.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return G.return(new $o("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",m));g.LP(G,3);M.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return g.z(G,Xo(a.T,M,"transfer"),5);case 5:A=g.aN(M.key).entityId;irc({videoId:A,Ms:M,offlineModeType:(P=d)==null?void 0:P.offlineModeType});g.e7(G,4);break;case 3:return g.OQ(G),G.return(new $o("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",
m,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return G.return(new $o("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",m))}})},QAc=function(a,l,m){m=m===void 0?!1:m;
var T,y,R,H,b,M,d,A,P,G,V,p,L,N,e;return g.J(function(t){switch(t.L){case 1:return T=g.I(l.actionMetadata,hWd),y=g.aN(l.entityKey).entityId,R=g.lZ(y,"downloadStatusEntity"),g.z(t,u8(a.T,{mode:"readonly",xX:!0},function(v){var S=wB(v,R,"downloadStatusEntity");v=wB(v,g.lZ(y,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.Fz.all([S,v])}),2);
case 2:return H=t.T,b=g.c(H),M=b.next().value,d=b.next().value,A=M,P=d,G="TRANSFER_STATE_TRANSFER_IN_QUEUE",((V=A)==null?void 0:V.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(G="TRANSFER_STATE_PAUSED_BY_USER"),N={key:l.entityKey,transferState:G,cotn:g.FH(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(p=T)==null?void 0:p.maximumDownloadQuality,preferredAudioTrack:(L=T)==null?void 0:L.preferredAudioTrack,transferRetryCount:0,isRefresh:m,hasLoggedFirstStarted:!1},g.z(t,u8(a.T,
{mode:"readwrite",xX:!0},function(v){var S=[];m&&S.push(oJ(v,g.lZ(y,"offlineVideoStreams")));S.push(Em(v,N,"transfer"));return g.Fz.all(S)}),3);
case 3:if(!m){t.iT(4);break}return g.z(t,VYV(y),4);case 4:gYn({videoId:y,Ms:N,offlineModeType:(e=P)==null?void 0:e.offlineModeType}),g.c5(t)}})},Kyg=function(a,l,m,T){if(!a.action.entityKey)throw Error("entityKey is missing.");
var y=g.aN(a.action.entityKey);y={entityType:y.Ui,entityId:y.entityId,offlineOrchestrationActionType:a.action.actionType,orchestrationAction:{orchestrationActionId:a.actionId}};l&&(y.offlineOrchestrationActionResult=l.status,y.isRetryable=m?!1:l.T,l.Z&&(y.offlineOrchestrationFailureReason=OGV(l.Z,y.isRetryable)));var R,H;if((R=a.action.actionMetadata)==null?0:(H=R.offlineLoggingData)==null?0:H.offlineModeType)y.offlineModeType=a.action.actionMetadata.offlineLoggingData.offlineModeType;T&&(y.additionalOrchestrationActions=
T.map(function(b){return{orchestrationActionId:b.actionId}}));
return y},OGV=function(a,l){return a!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||l?a==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&l?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":a:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},zW9=function(a,l){var m={offlineOrchestrationContext:Kyg(a)};
l=x2X(l,m);D2n(oGX(),l,a.rootActionId)},v$_=function(a,l,m,T){T=T===void 0?[]:T;
l={offlineOrchestrationContext:Kyg(a,l,m,T)};l=x2X(3,l);D2n(oGX(),l,a.rootActionId)},$Vr=function(){this.actions=[]},sA9=function(a,l){l=g.c(l);
for(var m=l.next();!m.done;m=l.next())m=m.value,zW9(m,1),a.actions.push(m);a.actions.sort(a.T)},Sdg=function(a,l){if(l)for(var m=0;m<a.actions.length;m++)if(l==="!*$_ALL_ENTITIES_!*$"&&a.actions[m].actionId!==l||l!=="!*$_ALL_ENTITIES_!*$"&&a.actions[m].rootActionId===l&&a.actions[m].actionId!==l)a.actions.splice(m,1),m--},fKF=function(a,l){a=g.c(a.actions);
for(var m=a.next();!m.done;m=a.next())if(m.value.actionId===l)return!0;return!1},Bq=function(a,l,m,T,y){g.k.call(this);
var R=this;this.L=a;this.jt=l;this.Ij=m;this.B=T;this.aj=y;this.T=new $Vr;this.C=new g.Uc;this.Z=new g.aH(function(){R.retry()});
this.J=NaN;this.K=!1;this.lM={OYg:function(){return R.T},
x3:function(){return R.C},
Eux:function(){return R.Z},
retry:function(){return R.retry()}};
g.w(this,this.Z);this.N=this.L.observe(this.lT.bind(this))},kJF=function(a,l,m,T,y){var R;
return g.J(function(H){if(H.L==1)return R=new Bq(a,l,m,T,y),g.z(H,JyF(R),2);BRF(R);return H.return(R)})},BRF=function(a){var l=a.T.actions[0];
return a.j?((l==null?void 0:l.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&a.j[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(a.K=!0),Promise.resolve()):n$r(a)},n$r=function(a){var l,m,T,y,R,H,b,M,d,A,P,G,V,p,L,N,e;
return g.J(function(t){switch(t.L){case 1:if(a.j)throw Error("Already processing an action");if(a.FO())return t.return();l=a.T.actions.shift();qAD(a.Ij,!l);if(l===void 0)return t.return();l.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&l.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&Sdg(a.T,l.actionId);m="";l.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&l.rootActionId===l.actionId&&(m=l.actionId);T=[l];a.j=T;if(y=a.jt[l.entityType]){t.iT(2);break}a.j=
void 0;return g.z(t,n$r(a),3);case 3:return t.return();case 2:R=g.c(T);for(H=R.next();!H.done;H=R.next())b=H.value,zW9(b,2);g.LP(t,4,5);return g.z(t,TRD(y,T.map(function(v){return v.action})),7);
case 7:M=t.T,d=g.c(T),A=d.next();case 8:if(A.done){t.iT(10);break}P=A.value;G=M.get(P.action);return g.z(t,wfB(a,P,G),9);case 9:A=d.next();t.iT(8);break;case 10:Sdg(a.T,m);case 5:g.zH(t);a.j=void 0;g.$l(t,6);break;case 4:return V=g.OQ(t),T3("Orchestration error",V),g.LP(t,12),g.z(t,IKB(a,T),14);case 14:g.e7(t,5);break;case 12:p=g.OQ(t);T3("Orchestration retry error",p);L=g.c(T);for(N=L.next();!N.done;N=L.next())e=N.value,e.retryScheduleIndex<3&&sA9(a.T,[e]);t.iT(5);break;case 6:return g.z(t,n$r(a),
0)}})},wfB=function(a,l,m){var T,y,R,H,b,M,d,A,P,G,V,p;
return g.J(function(L){switch(L.L){case 1:T=l.retryScheduleIndex+2===3;if(m.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){L.iT(2);break}if(m.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){L.iT(0);break}v$_(l,m,T);if(m.T&&l.retryScheduleIndex+1<3)return g.z(L,IKB(a,[l]),0);R=((y=m)==null?0:y.L)?m.L:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";H={entityKey:l.action.entityKey,failureReason:R};b=void 0;g.aX(a.aj)?b="mainVideoDownloadStateEntity":g.IE(a.aj)&&(b="musicTrackDownloadMetadataEntity");
if(!b||!m.downloadState){L.iT(7);break}M=g.aN(l.action.entityKey).entityId;return g.z(L,jT(M,b,a.L,m.downloadState),7);case 7:RC(a.B,H);if(m.downloadState==="DOWNLOAD_STATE_FAILED"&&a.aj.V("html5_auto_retry_failed_pde_actions")){L.iT(0);break}T3("Orchestration result is not retryable, deleting action");return g.z(L,eJ_(a.L,ZT(l).key),0);case 2:d=void 0;try{d=(A=m.j)==null?void 0:A.map(function(N){return a.createAction(N,l)})}catch(N){return v$_(l,m,T),P={entityKey:l.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},RC(a.B,P),T3("Orchestration subactions creation error",N),L.return()}v$_(l,m,T,d);if(!d){L.iT(12);break}G=d.map(function(N){return ZT(N)});
V=0;case 13:if(!(V<d.length)||a.K){L.iT(15);break}return g.z(L,u8(a.L,{mode:"readwrite",xX:!0},function(N){var e=[];e.push(GWd(N,G.slice(V,V+10),"offlineOrchestrationActionWrapperEntity"));return g.Fz.all(e)}),16);
case 16:V+=10;L.iT(13);break;case 15:if(a.K)return a.K=!1,L.return();case 12:return p=ZT(l),g.z(L,eJ_(a.L,p.key),17);case 17:zW9(l,4),g.c5(L)}})},xVI=function(a,l){var m,T,y,R,H,b,M,d,A,P,G,V;
return g.J(function(p){m=[];T=Infinity;y=4E3;R=g.c(l);for(H=R.next();!H.done;H=R.next())b=H.value,M=Number(b.enqueueTimeSec),d=C_9(M),A=b.retryScheduleIndex,P=A!=null&&A>0,d>0&&P?(T=Math.min(T,M),y=Math.min(d,y)):m.push(b);isFinite(T)&&(!a.Z.isActive()||T<a.J)&&(a.J=T,a.Z.start(y));a.C.Dq()||(G=m.length,m=m.filter(function(L){var N;L=((N=L.actionProto)==null?void 0:N.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!E$r.includes(L)}),V=m.length<G,!a.Z.isActive()&&V&&a.Z.start(1));
m.length>0&&o$c(a,m);return g.z(p,BRF(a),0)})},u3V=function(a){var l,m,T,y,R,H,b;
return g.J(function(M){if(M.L==1)return g.z(M,DVF(a),2);l=M.T;m=[];T=g.c(l);for(y=T.next();!y.done;y=T.next())R=y.value,H=g.aN(R.key),b=H.entityId,fKF(a.T,b)||m.push(R);return g.z(M,xVI(a,m),0)})},C_9=function(a){a=a*1E3-Date.now();
return a>4E3?4E3:a},IKB=function(a,l){var m,T,y;
return g.J(function(R){m=g.c(l);for(T=m.next();!T.done;T=m.next()){y=T.value;var H=void 0,b=void 0,M=((b=y.action)==null?void 0:(H=b.actionMetadata)==null?void 0:H.retryScheduleIntervalsInSeconds)||[1,2,4];H=1;y.retryScheduleIndex<M.length&&(H=M[y.retryScheduleIndex]);y.T=H*1E3+Date.now();y.retryScheduleIndex++}return g.z(R,Xfs(a,l),0)})},JyF=function(a){var l;
return g.J(function(m){if(m.L==1)return g.z(m,Um(a.L,"offlineOrchestrationActionWrapperEntity"),2);l=m.T;return g.z(m,xVI(a,l),0)})},o$c=function(a,l){l.length!==0&&l.forEach(function(m){m=pX(m);
m.retryScheduleIndex<3&&sA9(a.T,[m])})},DVF=function(a,l){var m;
return g.J(function(T){if(T.L==1)return g.z(T,Um(a.L,"offlineOrchestrationActionWrapperEntity",l),2);m=T.T;return T.return(m.filter($2I))})},Xfs=function(a,l){if(l.length===0)return Promise.resolve([]);
l=l.map(function(m){return ZT(m)});
return tFV(a.L,l)},YdX=function(a){this.bT=a;
this.T=void 0},UVs=function(a,l){var m,T,y,R;
return g.J(function(H){m=l.videoId;T=!0;if(l.captionTracks.length)y=daD(l),a.T=new g.px(a.bT,l,y);else if(l.p5)R=g.eK3(l),a.T=new g.W3(a.bT,l.p5,m,R,l.c7,l.eventId),T=l.c7;else return H.return();return H.return(new Promise(function(b){var M;(M=a.T)==null||M.XD({pu:function(){return g.J(function(d){if(d.L==1)return g.z(d,a.pu(m,T),2);b();g.c5(d)})},
cB:function(){}})}))})},rys=function(a){var l;
return g.J(function(m){if(m.L==1)return g.z(m,BXD(a),2);l=m.T;return m.return(!!l&&l.length>0)})},ko=function(a){g.k.call(this);
this.T=a;this.L=this.T.observe(this.Z.bind(this))},aSr=function(a,l){var m,T,y,R,H,b,M;
return g.J(function(d){switch(d.L){case 1:if(l.length===0)return d.return([]);m=l.map(function(A){return g.lZ(A,"transfer")});
return g.z(d,Um(a.T,"transfer",m),2);case 2:T=d.T;y=T.filter($2I).map(function(A){return g.aN(A.key).entityId});
R=l.filter(function(A){return y.indexOf(A)===-1});
if(R.length===0)return d.return([]);H=g.c(R);b=H.next();case 3:if(b.done){d.iT(5);break}M=b.value;return g.z(d,VYV(M),4);case 4:b=H.next();d.iT(3);break;case 5:return d.return(R)}})},TKX=function(a,l,m,T,y,R){var H,b,M;
return g.J(function(d){H="STREAM_TYPE_UNKNOWN";m.video&&m.audio?(H="STREAM_TYPE_AUDIO_AND_VIDEO",T3("unexpected stream type")):m.video&&!m.audio?H="STREAM_TYPE_VIDEO":!m.video&&m.audio&&(H="STREAM_TYPE_AUDIO");b=g.lZ(l,"offlineVideoStreams");M={numBytesDownloaded:y.toFixed(),numTotalBytes:R.toFixed(),streamType:H,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(T),itag:H==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(m.itag):void 0};return g.z(d,u8(a,{mode:"readwrite",xX:!0},
function(A){var P=wB(A,b,"offlineVideoStreams"),G=wB(A,g.lZ(l,"transfer"),"transfer");return g.Fz.all([P,G]).then(function(V){V=g.c(V);var p=V.next().value;V=V.next().value;if(!V)return oJ(A,b).then(function(){});
var L=lSI(p);p=m$s(p,T,M,b);var N=Em(A,p,"offlineVideoStreams");lSI(p)>L&&(V.lastProgressTimeMs=Date.now().toString());L=[N];V.offlineVideoStreams||(V.offlineVideoStreams=[]);V.offlineVideoStreams.indexOf(b)===-1&&(V.offlineVideoStreams.push(b),L.push(Em(A,V,"transfer")));return g.Fz.all(L)})}),0)})},yMs=function(a,l){var m,T,y,R,H;
return g.J(function(b){if(b.L==1)return m=g.lZ(l,"offlineVideoStreams"),g.z(b,YE(a,m,"offlineVideoStreams"),2);T=b.T;if(!T||!T.streamsProgress)return b.return();y=g.c(T.streamsProgress);for(R=y.next();!R.done;R=y.next())H=R.value,H.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",H.numTotalBytes!==H.numBytesDownloaded&&(H.numBytesDownloaded=H.numTotalBytes);return g.z(b,Xo(a,T,"offlineVideoStreams"),0)})},m$s=function(a,l,m,T){if(a&&a.streamsProgress){T=a;
a:{l=l.itag+";"+l.xtags;for(var y=a.streamsProgress,R=0;R<y.length;R++){var H=JSON.parse(y[R].formatStreamBytes);if(H.itag+";"+H.xtags===l){y[R]=m;m=y;break a}}y.push(m);m=y}T.streamsProgress=m}else a={key:T,streamsProgress:[m]};return a},lSI=function(a){if(a==null?0:a.streamsProgress){var l=0;
a=a.streamsProgress;for(var m=0;m<a.length;m++){var T=a[m];isNaN(Number(T.numBytesDownloaded))?T3("stream progress bytes number invalid"):l+=Number(T.numBytesDownloaded)}return l}return 0},RRg=function(a,l,m,T){g.k.call(this);
var y=this;this.L=a;this.api=l;this.St=m;this.lT=T;this.C=new g.Uc;this.j=new g.aH(function(){y.T&&y.T.transferState==="TRANSFER_STATE_TRANSFERRING"&&y.C.Dq()&&((y.T.transferRetryCount||0)<3?JX(y.B,y.K,!1,!1):fX(y.B,y.K.videoDetails.videoId),y.h2("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.Ij=this.hM=0;this.N=this.J=!1;this.tM=g.PU(this.api.Y().experiments,"html5_transfer_processing_logs_interval");this.AM=new g.BT(this);this.lM={A5T:function(){return y.j},
vuj:function(){return y.lT},
x3:function(){return y.C}};
this.jt=this.L.observe(this.u6.bind(this));this.B=new GJF(l,this);this.Mj=new YdX(l);this.qj=new ko(this.L);this.Cx=this.C.listen("publicytnetworkstatus-online",this.u8.bind(this));this.Kx=this.C.listen("publicytnetworkstatus-offline",this.JbT.bind(this));this.N=this.api.Y().V("html5_less_transfer_processing_logs");g.w(this,this.AM);this.AM.W(l,"offlinetransferpause",this.f6O);g.aX(this.api.Y())?this.Z="mainVideoDownloadStateEntity":g.IE(this.api.Y())&&(this.Z="musicTrackDownloadMetadataEntity")},
Hec=function(a){return g.J(function(l){if(l.L==1)l=g.z(l,fLr(),2);
else{var m=a.qj;var T=g.vV();T=Object.keys(T);m=aSr(m,T);l=g.z(l,m,0)}return l})},wc=function(a,l){l=l===void 0?!1:l;
var m;return g.J(function(T){if(T.L==1){if(a.T)throw Error("Already downloading a video");a.Ij=0;a.J=!1;return g.z(T,q3n(a),2)}return T.L!=4?(m=T.T,brr(a.St,!m),m&&a.C.Dq()?l?g.z(T,new Promise(function(y){g.ZC(y,1E3)}),4):T.iT(4):(!m&&a.T&&nX(a),T.iT(0))):g.z(T,beg(a,m),0)})},ge_=function(a){return g.J(function(l){if(l.L==1)return a.K?g.z(l,fX(a.B,a.K.videoDetails.videoId),3):l.iT(0);
nX(a);g.c5(l)})},Mt9=function(a,l){var m,T,y;
return g.J(function(R){switch(R.L){case 1:return g.LP(R,2),(m=!!l.captionTracks.length||!!l.p5)?g.z(R,rys(l.videoId),4):R.return();case 4:return(T=R.T)?R.return():g.z(R,UVs(a.Mj,l),5);case 5:g.e7(R,0);break;case 2:y=g.OQ(R),T3("Caption downloading error",y,l.cotn),g.c5(R)}})},beg=function(a,l){var m,T,y,R,H,b;
return g.J(function(M){switch(M.L){case 1:if(a.J)return M.return();a.J=!0;a.T=l;m=g.aN(a.T.key);T=m.entityId;y=void 0;if(a.T.transferState==="TRANSFER_STATE_TRANSFERRING")return g.z(M,IC(a,T),7);if(a.T.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||a.T.transferRetryCount||a.T.hasLoggedFirstStarted){M.iT(3);break}return g.z(M,IC(a,T),5);case 5:return y=M.T,a.T.hasLoggedFirstStarted=!0,g.z(M,ieF(a),6);case 6:MzI({videoId:T,Ms:a.T,offlineModeType:y},void 0,void 0,!0);M.iT(3);break;case 7:y=M.T,
bC({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:T,Ms:a.T,offlineModeType:y});case 3:return g.z(M,d$s(a),8);case 8:return R=null,g.LP(M,9),g.z(M,jHI(a,l),11);case 11:R=M.T;a.K=R;g.e7(M,10);break;case 9:return H=g.OQ(M),T3("error getting player response",H,l.cotn),g.z(M,a.h2("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return M.return();case 10:return b=Vzs(a.api.Y(),l.cotn,R),g.z(M,Mt9(a,b),13);case 13:return g.z(M,pfs(b.videoId),
14);case 14:b.n3=M.T,LyI(a.B,b,l.maximumDownloadQuality),a.j.start(108E5),g.c5(M)}})},q3n=function(a){var l,m;
return g.J(function(T){if(T.L==1)return g.z(T,Um(a.L,"transfer"),2);l=T.T;m=l.filter(AMV).sort(P0D);return m.length===0?T.return():T.return(m[0])})},d$s=function(a){var l,m,T;
return g.J(function(y){if(y.L==1){if(!a.T)return CX(a,"onTransferStart"),y.return();a.j.start(108E5);return g.z(y,E1(a,"TRANSFER_STATE_TRANSFERRING"),2)}l=a.T;return(T=((m=l)==null?0:m.key)?g.aN(l.key).entityId:"")&&a.Z?g.z(y,jT(T,a.Z,a.L,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):y.iT(0)})},Wy5=function(a){var l,m,T,y;
g.J(function(R){switch(R.L){case 1:if(!a.T){CX(a,"onTransferPausedByUser");R.iT(2);break}l=a.T;a.j.stop();return g.z(R,E1(a,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:T=((m=l)==null?0:m.key)?g.aN(l.key).entityId:"";if(!T||!a.Z){R.iT(4);break}return g.z(R,jT(T,a.Z,a.L,"DOWNLOAD_STATE_PAUSED"),4);case 4:return g.z(R,IC(a,T),6);case 6:y=R.T,dPV({videoId:T,Ms:l,offlineModeType:y});case 2:nX(a),wc(a),g.c5(R)}})},cyn=function(a){var l,m,T;
g.J(function(y){if(y.L==1){if(!a.T)return CX(a,"onTransferPausedByNetwork"),y.return();a.j.stop();return g.z(y,E1(a,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(y.L!=3)return l=a.T,(T=((m=l)==null?0:m.key)?g.aN(l.key).entityId:"")&&a.Z?g.z(y,jT(T,a.Z,a.L,"DOWNLOAD_STATE_PAUSED"),3):y.iT(3);nX(a);g.c5(y)})},Gwc=function(a){var l,m,T,y,R;
g.J(function(H){switch(H.L){case 1:if(!a.T)return CX(a,"onTransferComplete"),H.return();l=a.T;a.j.stop();if(!l||!a.K){H.iT(2);break}m=Vzs(a.api.Y(),l.cotn,a.K);return g.z(H,Mt9(a,m),2);case 2:return g.z(H,E1(a,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:y=((T=l)==null?0:T.key)?g.aN(l.key).entityId:"";if(!y||!a.Z){H.iT(5);break}return g.z(H,jT(y,a.Z,a.L,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return g.z(H,yMs(a.L,y),7);case 7:return g.z(H,IC(a,y),8);case 8:R=H.T,bC({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:y,Ms:l,offlineModeType:R}),nX(a),wc(a),g.c5(H)}})},VtF=function(a,l,m){var T,y;
g.J(function(R){switch(R.L){case 1:if(!a.T)return CX(a,"onTransferProgress: "+l),R.return();if(a.T.transferState==="TRANSFER_STATE_TRANSFERRING"){R.iT(2);break}return g.z(R,d$s(a),2);case 2:T=Date.now();if(!(T-a.hM>1E3)){R.iT(4);break}a.hM=T;return g.z(R,TKX(a.L,m.videoId,m.L,m.nA,m.bytesDownloaded,m.T),5);case 5:if(a.N&&!(a.N&&T-a.Ij>a.tM)){R.iT(4);break}a.Ij=T;return g.z(R,IC(a,l),7);case 7:y=R.T,MzI({videoId:l,Ms:a.T,offlineModeType:y},m.bytesDownloaded,m.T);case 4:a.j.start(108E5),g.c5(R)}})},
pbr=function(a){var l=(a.T.transferRetryCount||0)<3;
l&&(a=a.T,a.transferRetryCount=(a.transferRetryCount||0)+1);return l},ZeX=function(a,l){l=l===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":l;
var m,T,y,R;return g.J(function(H){if(H.L==1)return a.T||CX(a,"setTransferToFailed: "+l),m="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",l==="TRANSFER_FAILURE_REASON_NETWORK"?m="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":l==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(m="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),g.z(H,E1(a,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",l),2);if(H.L!=3)return RC(a.lT,{entityKey:(T=a.T)==null?void 0:T.key,failureReason:m}),
y=a.T?g.aN(a.T.key).entityId:"",g.z(H,IC(a,y),3);R=H.T;var b={videoId:y,Ms:a.T,offlineModeType:R},M=l,d={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};M&&(d.transferFailureReason=M,d.failureReason=jI5(M));bC(d,b);g.c5(H)})},E1=function(a,l,m,T){var y;
return g.J(function(R){if(R.L==1){if(!a.T)return CX(a,"saveTransferState: "+l),R.return();a.T.transferState=l;a.T.failureReason=T;g.LP(R,2);return g.z(R,ieF(a,function(H){return m?IJ(H,"offlineVideoStreams",a.T.offlineVideoStreams).then(function(b){for(var M=g.c(b),d=M.next();!d.done;d=M.next())if((d=d.value)&&d.streamsProgress){d=g.c(d.streamsProgress);for(var A=d.next();!A.done;A=d.next())A.value.streamState=m}return GWd(H,b.filter(function(P){return!!P}),"offlineVideoStreams")}):g.Fz.resolve(void 0)}),
4)}if(R.L!=2)return g.e7(R,0);
y=g.OQ(R);return y instanceof g.Ww&&y.type==="QUOTA_EXCEEDED"?g.z(R,a.h2("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):R.iT(0)})},ieF=function(a,l){var m;
return g.J(function(T){if(!a.T)return T.return();m=a.T;return g.z(T,u8(a.L,{mode:"readwrite",xX:!0},function(y){var R=[Em(y,m,"transfer")];l&&R.push(l(y));return g.Fz.all(R)}),0)})},nX=function(a){a.T=void 0;
a.K=void 0;a.j.stop()},jHI=function(a,l){var m,T,y,R,H;
return g.J(function(b){if(b.L==1)return m=g.aN(l.key),T=m.entityId,y=g.lZ(T,"playbackData"),g.z(b,YE(a.L,y,"playbackData"),2);R=b.T;if((H=R)==null?0:H.playerResponseJson)return b.return(JSON.parse(R.playerResponseJson));throw Error("No PlayerResponse found");})},CX=function(a,l){a.api.Tu("woffle",{mcte:l});
T3("missing current transfer entity.")},IC=function(a,l){var m,T,y;
return g.J(function(R){if(R.L==1)return g.z(R,YE(a.L,g.lZ(l,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);m=R.T;return R.return((y=(T=m)==null?void 0:T.offlineModeType)!=null?y:void 0)})},AMV=function(a){return WqV[a.transferState]!==void 0},P0D=function(a,l){var m=WqV[a.transferState],T=WqV[l.transferState];
return m!==T?m-T:Number(a.enqueuedTimestampMs)-Number(l.enqueuedTimestampMs)},oC=function(a,l){var m=this;
this.aj=a;this.api=l;this.C=new g.Uc;this.K=new g.pr;this.lM={mE:function(){return m.Z.lM.mE()},
x3:function(){return m.C},
Ik8:function(){return m.Z},
KD:function(){return m.KD()},
ST:function(){return m.ST()},
po:function(){return m.po()},
Gv:function(){return m.Gv()},
rX:function(){return m.rX()},
c8:function(T){return m.c8(T)}};
this.Z=new yQ9(function(){return cM9(m)},function(){m.po()},this.api.Fm(),this.api.V.bind(this.api));
this.T=new yy(this.api);RGc(this.Z)},cM9=function(a){return g.J(function(l){a.api.Pz("onOrchestrationBecameLeader");
return g.z(l,a.ST(),0)})},NKV=function(a){var l,m;
return g.J(function(T){if(T.L==1)return g.z(T,rB(),2);if(T.L!=3){l=T.T;if(!l)return T3("PES is undefined"),T.return();a.L=new RRg(l,a.api,a.Z,a.T);m=a.yR(l);return g.z(T,kJF(l,m,a.Z,a.T,a.aj),3)}a.B=T.T;return g.z(T,Lqs(a),0)})},Lqs=function(a){var l;
return g.J(function(m){switch(m.L){case 1:if(!a.L)return T3("transferManager is undefined"),m.return();if(a.L.T){m.iT(2);break}return g.z(m,wc(a.L),2);case 2:if(!a.aj.V("woffle_enable_main_downloads_library")){m.iT(4);break}return g.z(m,a.KJ(),4);case 4:if(!a.aj.V("html5_offline_playback_position_sync")){m.iT(6);break}return g.z(m,a.Nv(),7);case 7:return g.z(m,a.c8(864E5),6);case 6:return g.z(m,a.refreshAllStaleEntities(43200,!0),9);case 9:return g.z(m,a.nw(),10);case 10:if(!a.aj.V("html5_retry_downloads_for_expiration")){m.iT(11);
break}return g.z(m,a.rX(),11);case 11:return a.J=g.W$(function(){a.refreshAllStaleEntities(43200,!0);a.nw()},9E5),g.m$(g.yi(),function(){return a.Gv()}),g.z(m,rB(),13);
case 13:return l=m.T,g.z(m,TOX(l),14);case 14:Hr5(a.Z),g.c5(m)}})},QH_=function(){var a,l,m,T,y,R;
return g.J(function(H){switch(H.L){case 1:return g.z(H,rB(),2);case 2:a=H.T;if(!a)return H.return([]);l=Date.now()/1E3;return g.z(H,Um(a,"offlineVideoPolicy"),3);case 3:m=H.T,T=g.c(m),y=T.next();case 4:if(y.done){H.iT(6);break}R=y.value;if(!(R.expirationTimestamp&&Number(R.expirationTimestamp)<l)){H.iT(5);break}R.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";R.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return g.z(H,Xo(a,R,"offlineVideoPolicy"),5);
case 5:y=T.next();H.iT(4);break;case 6:return H.return(m.map(function(b){return b.key}))}})},xo=function(a,l,m,T,y){var R,H,b;
return g.J(function(M){if(M.L==1)return g.z(M,rB(),2);R=M.T;if(!R)return M.return([]);H=l.map(function(d){var A=g.lZ(d,m);A={actionType:T,entityKey:A,actionMetadata:Object.assign({},pvF(),y)};T!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(A.actionMetadata.priority=0);d=new Vy(m,d,A);return ZT(d)});
b=tFV(R,H);RGc(a.Z);return M.return(b)})},ttX=function(a,l,m,T){var y,R,H,b,M,d,A,P;
return g.J(function(G){switch(G.L){case 1:y=[],R=g.c(l),H=R.next();case 2:if(H.done){G.iT(4);break}b=H.value;if(b.upToDate||m&&!b.shouldAutoSyncMetadata||!b.playlistId){G.iT(3);break}M={};switch(T){case "mainPlaylistEntity":d={nextAutoRefreshIntervalSeconds:b.checkInSeconds,autoSync:m};M={mainPlaylistEntityActionMetadata:d};break;case "musicPlaylist":A={autoSync:m},M={musicPlaylistEntityActionMetadata:A}}return g.z(G,xo(a,[b.playlistId],T,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",M),6);case 6:(P=
G.T)&&y.push.apply(y,g.F(P));case 3:H=R.next();G.iT(2);break;case 4:return G.return(y)}})},eRn=function(a,l){var m;
return g.J(function(T){return l.length?(m=pvF(),g.o9(m,s1,{isEnqueuedForExpiredStreamUrlRefetch:!0}),a.api.Tu("qrd",{v:l.length}),T.return(xo(a,l,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",m))):T.return([])})},Fqr=function(a,l,m){this.T=a;
this.aj=l;this.Z=m},Kqg=function(a,l){var m,T,y,R,H,b,M,d,A,P,G,V,p,L,N,e,t;
return g.J(function(v){switch(v.L){case 1:return m=gc(l),T=g.aN(l.entityKey),y=T.entityId,R=[],g.LP(v,2),g.z(v,hR5(a,y),4);case 4:R=v.T;if(!(a.aj.V("woffle_enable_main_downloads_library")&&((H=R)==null?0:H.length))){v.iT(5);break}return g.z(v,zGn(a.T,[l.entityKey]),5);case 5:g.e7(v,3);break;case 2:return b=g.OQ(v),M="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",d="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",b instanceof g.Ww&&b.type==="QUOTA_EXCEEDED"?(M="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
d="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):T3("Playlist add error"),v.return(new $o("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",m,void 0,M,d));case 3:A=[];if(!a.aj.V("html5_offline_prevent_redownload_downloaded_video")){v.iT(7);break}return g.z(v,G6B(a.T,"mainVideoEntity",R),8);case 8:R=v.T;case 7:if((P=R)==null?0:P.length)for(G=g.c(R),V=G.next();!V.done;V=G.next())if(p=V.value,L=p.offlineVideoData,N=void 0,(N=L)==null?0:N.videoId)e=void 0,t=Number(((e=l.actionMetadata)==null?void 0:e.priority)||
0)+1,A.push(vq("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",L.videoId,"mainVideoEntity",t,DT,OeF(l,L,y)));return v.return(new $o("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",m,A))}})},veF=function(a,l){var m,T,y,R,H,b,M,d,A,P,G,V,p,L,N,e,t,v,S,n,X,D,yp,H5,ad,Md,U,Nd,hz,EQ,ec,MF,KP,Ft,Hn,Q,gw,D9,Nj,zd,Gd,ww,fD,vn,h,O,K,f,C,tz,TH,ZR,Rd,v5,UQ,Q5,Qk,$_,XP,D2,YA,Nc,jp,$1,Z4,sh,Dn,uv,F6,H6,U8,qj,F3,Eu;
return g.J(function(pc){switch(pc.L){case 1:return m=gc(l),T=l.entityKey,y=g.aN(T).entityId,R=[],H=!1,y==="!*$_ALL_ENTITIES_!*$"?(H=!0,g.z(pc,Um(a.T,"mainPlaylistEntity"),5)):g.z(pc,YE(a.T,T,"mainPlaylistEntity"),4);case 4:(b=pc.T)&&R.push(b);pc.iT(3);break;case 5:R=pc.T;case 3:if((M=R)==null||!M.length)return pc.return(new $o("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",m));d=g.I(l.actionMetadata,zRB);P=(A=d)==null?void 0:A.nextAutoRefreshIntervalSeconds;V=(G=d)==null?void 0:G.autoSync;p=[];N=L=
!0;e=!1;if(!H&&V===!1){pc.iT(6);break}g.LP(pc,7);return g.z(pc,oYr(0,!!V,!0,R),9);case 9:p=pc.T;g.e7(pc,8);break;case 7:t=g.OQ(pc);if(!(t instanceof Error&&t.message==="No data")){t instanceof Error&&t.message==="Empty response body"&&T3(t.message);pc.iT(8);break}return y==="!*$_ALL_ENTITIES_!*$"?g.z(pc,tzD(a.T,l,a.Z,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):g.z(pc,NOB(y,a.T,l,a.Z),8);case 8:if(!p.length||!H&&p[0].playlistId!==y)return pc.return(new $o("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
m));case 6:if(H){v=[];S=g.c(p);for(n=S.next();!n.done;n=S.next())X=n.value,X.upToDate||V&&!X.shouldAutoSyncMetadata||!X.playlistId||(D={nextAutoRefreshIntervalSeconds:X.checkInSeconds,autoSync:V},v.push(vq("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",X.playlistId,"mainPlaylistEntity",0,DT,{mainPlaylistEntityActionMetadata:D})));return pc.return(new $o("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",m,v))}p.length&&(yp=p[0],e=!!yp.upToDate,V&&(L=(H5=yp.shouldAutoSyncMetadata)!=null?H5:!0,N=(ad=yp.shouldAutoSyncVideos)!=
null?ad:!0,yp.checkInSeconds&&(P=yp.checkInSeconds)));if(e||!L)return pc.return(new $o("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",m));Md=[];U=R[0];if(!U.downloadState){Nd=void 0;pc.iT(15);break}return g.z(pc,YE(a.T,U.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:Nd=pc.T;case 15:return hz=Nd,ec=((EQ=hz)==null?0:EQ.addedTimestampMillis)?String(hz.addedTimestampMillis):void 0,g.LP(pc,17),g.z(pc,hR5(a,y,ec,P),19);case 19:Md=pc.T;g.e7(pc,18);break;case 17:MF=g.OQ(pc);if(!(MF instanceof
Error&&MF.message==="No data for playlist")){if(MF instanceof Error&&MF.message==="Empty response body for playlist")T3(MF.message);else return KP="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Ft="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",MF instanceof g.Ww&&MF.type==="QUOTA_EXCEEDED"&&(KP="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Ft="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),pc.return(new $o("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",m,void 0,KP,Ft));
pc.iT(18);break}return g.z(pc,NOB(y,a.T,l,a.Z),18);case 18:if(!N)return pc.return(new $o("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",m));Hn=[];Q=new Map;if((gw=Md)==null?0:gw.length)for(D9=g.c(Md),Nj=D9.next();!Nj.done;Nj=D9.next())zd=Nj.value,Gd=zd.offlineVideoData,ww=void 0,((ww=Gd)==null?0:ww.videoId)&&Q.set(Gd.videoId,Gd);fD=new Map;vn=[];if((h=U)==null?0:(O=h.videos)==null?0:O.length)for(K=g.c(U.videos),f=K.next();!f.done;f=K.next())if(C=f.value,tz=JSON.parse(g.aN(C).entityId),TH=tz.videoId)Q.has(TH)?
(fD.set(TH,Q.get(TH)),Q.delete(TH)):vn.push(TH);Rd=Number(((ZR=l.actionMetadata)==null?void 0:ZR.priority)||0)+1;v5=g.c(Q.entries());for(UQ=v5.next();!UQ.done;UQ=v5.next())Q5=UQ.value,Qk=g.c(Q5),$_=Qk.next().value,XP=Qk.next().value,D2=$_,YA=XP,Hn.push(vq("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",D2,"mainVideoEntity",Rd,DT,OeF(l,YA,y)));Nc=g.c(fD.entries());for(jp=Nc.next();!jp.done;jp=Nc.next())$1=jp.value,Z4=g.c($1),sh=Z4.next().value,Dn=Z4.next().value,uv=sh,F6=Dn,Hn.push(vq("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
uv,"mainVideoEntity",Rd,DT,OeF(l,F6,y)));H6=g.c(vn);for(U8=H6.next();!U8.done;U8=H6.next())qj=U8.value,F3={playlistId:y},Eu={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:F3},Hn.push(vq("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",qj,"mainVideoEntity",0,DT,Eu));return pc.return(new $o("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",m,Hn))}})},$$B=function(a,l){var m,T,y,R;
return g.J(function(H){switch(H.L){case 1:return m=gc(l),g.LP(H,2),T=g.aN(l.entityKey).entityId,T==="!*$_ALL_ENTITIES_!*$"?g.z(H,tzD(a.T,l,a.Z,(y=l.actionMetadata)==null?void 0:(R=y.offlineLoggingData)==null?void 0:R.offlineDeleteReason),5):g.z(H,NOB(T,a.T,l,a.Z),6);case 6:if(!a.aj.V("woffle_enable_main_downloads_library")){H.iT(5);break}return g.z(H,vY5(a.T,l.entityKey),5);case 5:g.e7(H,3);break;case 2:return g.OQ(H),H.return(new $o("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",m,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return H.return(new $o("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",m))}})},hR5=function(a,l,m,T){var y,R,H,b,M,d,A;
return g.J(function(P){switch(P.L){case 1:return g.z(P,CnF([l]),2);case 2:return y=P.T,g.z(P,sH_(a,y[0],m,T),3);case 3:return R=P.T,H=R.mainPlaylistEntity,b=R.dIT,d=cQ_(H,(M=b)==null?void 0:M.avatar),g.LP(P,4),g.z(P,cq(d),6);case 6:g.e7(P,5);break;case 4:A=g.OQ(P),A instanceof Error&&A.message==="Failed to fetch"&&T3(A.message);case 5:return P.return(y[0].videos)}})},sH_=function(a,l,m,T){var y,R,H,b,M,d,A,P,G,V,p,L,N,e,t,v,S;
return g.J(function(n){switch(n.L){case 1:y=Date.now().toString();m||(m=y);R=l.videos;H=l.playlistId;b=[];M=[];if(R)for(d=g.c(R),A=d.next();!A.done;A=d.next()){P=A.value;G=P.offlineVideoData;if(!G||!G.videoId)throw T3("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");V=G.videoId;p={videoId:V,playlistId:H};L={id:g.lZ(JSON.stringify(p),"mainPlaylistVideoEntity"),video:g.lZ(V,"mainVideoEntity")};b.push(L);M.push(L.id)}e={key:g.lZ(H,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:m,lastSyncedTimestampMillis:y};t={key:g.lZ(H,"mainPlaylistEntity"),playlistId:H,videos:M,title:l.title,thumbnailStyleData:S39(l),visibility:fS9(l),downloadState:e.key};l.channel&&(v=l.channel.offlineChannelData,N=JMB(g.lZ(H,"ytMainChannelEntity"),v),t.channelOwner=N.id);((S=t)==null?0:S.entityMetadata)?(t.entityMetadata.offlineLastModifiedTimestampSeconds=l.lastModifiedTimestamp,T&&(t.entityMetadata.nextAutoRefreshIntervalSeconds=String(T))):t&&(t.entityMetadata={nextAutoRefreshIntervalSeconds:T?
String(T):void 0,offlineLastModifiedTimestampSeconds:l.lastModifiedTimestamp});g.LP(n,2);return g.z(n,u8(a.T,{mode:"readwrite",xX:!0},function(X){var D=Em(X,t,"mainPlaylistEntity"),yp=Em(X,e,"mainPlaylistDownloadStateEntity");D=[D,yp];yp=g.c(b);for(var H5=yp.next();!H5.done;H5=yp.next())D.push(Em(X,H5.value,"mainPlaylistVideoEntity"));N&&D.push(Em(X,N,"ytMainChannelEntity"));return g.Fz.all(D)}),4);
case 4:g.e7(n,3);break;case 2:throw g.OQ(n),T3("PES failure for playlist"),Error("PES failure for playlist");case 3:return n.return({mainPlaylistEntity:t,dIT:N,Bpx:b})}})},JMB=function(a,l){return{id:a,
channelId:l.channelId,title:l.title,avatar:l.thumbnail}},S39=function(a){var l=[],m=a.videos;
m&&m.length>0&&l.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:m[0].offlineVideoData.thumbnail}}});if((a=a.additionalMetadadatas)&&a.length>0)for(a=g.c(a),m=a.next();!m.done;m=a.next()){var T=m.value.offlineBundleItemPlaylistData,y=void 0;m=(y=T)==null?void 0:y.style;y=void 0;T={collageThumbnail:{coverThumbnail:(y=T)==null?void 0:y.coverThumbnail}};switch(m){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":l.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:T});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":l.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:T});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":l.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:T});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":l.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:T})}}return l},fS9=function(a){switch(a.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},OeF=function(a,l,m){l={offlineVideoData:l,
playlistId:m};if(a=g.I(a.actionMetadata,zRB))l.maximumDownloadQuality=a.maximumDownloadQuality;return{mainVideoEntityActionMetadata:l}},BKs=function(a,l,m){this.T=a;
this.aj=l;this.Z=m},wbs=function(a,l){var m,T,y,R,H,b,M,d,A,P,G,V,p;
return g.J(function(L){switch(L.L){case 1:return m=gc(l),T=g.aN(l.entityKey),y=T.entityId,R=g.I(l.actionMetadata,uC),b=!((H=R)==null?0:H.playlistId),g.LP(L,2),g.z(L,kwX(a,y,void 0,(M=R)==null?void 0:M.offlineVideoData,b),4);case 4:g.e7(L,3);break;case 2:return d=g.OQ(L),A="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",P="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",d instanceof g.Ww&&d.type==="QUOTA_EXCEEDED"&&(A="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",P="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
L.return(new $o("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",m,void 0,A,P));case 3:G=1;G=Number(((V=l.actionMetadata)==null?void 0:V.priority)||0)+1;var N=(N=g.I(l.actionMetadata,uC))?{playbackDataActionMetadata:{maximumDownloadQuality:N.maximumDownloadQuality}}:void 0;p=vq("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",y,"playbackData",G,nes,N);return L.return(new $o("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",m,[p]))}})},ISB=function(a,l){var m,T,y,R,H,b,M,d,A,P,G,V,p,L,N,e,t;
return g.J(function(v){switch(v.L){case 1:return m=gc(l),T=g.aN(l.entityKey),y=T.entityId,g.z(v,YE(a.T,l.entityKey,"mainVideoEntity"),2);case 2:R=v.T;if(!R){H=void 0;v.iT(3);break}return g.z(v,YE(a.T,R.downloadState,"mainVideoDownloadStateEntity"),4);case 4:H=v.T;case 3:b=H;if(!R||!b)return v.return(new $o("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",m));g.LP(v,5);return g.z(v,kwX(a,y,b.addedTimestampMillis,(d=g.I(l.actionMetadata,uC))==null?void 0:d.offlineVideoData),7);case 7:A=1;A=Number(((P=
l.actionMetadata)==null?void 0:P.priority)||0)+1;M=vq("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",y,"playbackData",A,nes);g.e7(v,6);break;case 5:G=g.OQ(v);if(!(G instanceof Error&&G.message==="No data")){if(G instanceof Error&&G.message==="Empty response body")T3(G.message);else return V="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",p="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",G instanceof g.Ww&&G.type==="QUOTA_EXCEEDED"&&(V="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
p="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),v.return(new $o("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",m,void 0,V,p));v.iT(6);break}return g.z(v,Qy(a.T,y),9);case 9:L=v.T;N=g.I(l.actionMetadata,uC);if(t=(e=N)==null?void 0:e.playlistId)L.playlistId=t;L.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return g.z(v,LX(y,a.T,l,a.Z,L),6);case 6:return v.return(new $o("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",m,M?[M]:void 0))}})},C0V=function(a,l){var m,T,y,R,H,b,M,d,A,P;
return g.J(function(G){switch(G.L){case 1:return m=gc(l),g.LP(G,2),T=g.aN(l.entityKey).entityId,T==="!*$_ALL_ENTITIES_!*$"?g.z(G,tzD(a.T,l,a.Z,(A=l.actionMetadata)==null?void 0:(P=A.offlineLoggingData)==null?void 0:P.offlineDeleteReason),5):g.z(G,Qy(a.T,T),6);case 6:y=G.T;R=g.I(l.actionMetadata,uC);if(b=(H=R)==null?void 0:H.playlistId)y.playlistId=b;y.offlineDeleteReason=(M=l.actionMetadata)==null?void 0:(d=M.offlineLoggingData)==null?void 0:d.offlineDeleteReason;return g.z(G,LX(T,a.T,l,a.Z,y),7);
case 7:if(!a.aj.V("woffle_enable_main_downloads_library")){G.iT(5);break}return g.z(G,vY5(a.T,l.entityKey),5);case 5:g.e7(G,3);break;case 2:return g.OQ(G),G.return(new $o("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",m,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return G.return(new $o("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",m))}})},kwX=function(a,l,m,T,y){var R,H,b,M,d,A;
return g.J(function(P){switch(P.L){case 1:if(R=T){P.iT(2);break}return g.z(P,IyX([l]),3);case 3:H=P.T,R=H[0];case 2:return g.z(P,EeI(a,R,m,y),4);case 4:b=P.T;M=b.mainVideoEntity;d=b.channelEntity;g.LP(P,5);var G=G3(M.thumbnail),V=G3(d.avatar);return g.z(P,cq(G.concat(V)),7);case 7:g.e7(P,0);break;case 5:A=g.OQ(P),A instanceof Error&&A.message==="Failed to fetch"&&T3(A.message),g.c5(P)}})},EeI=function(a,l,m,T){var y,R,H,b,M,d,A,P,G,V,p,L,N;
return g.J(function(e){switch(e.L){case 1:m||(m=Date.now().toString());R=(y=l.channel)==null?void 0:y.offlineChannelData;H={id:g.lZ(l.videoId,"ytMainChannelEntity"),channelId:R.channelId,title:R.title,avatar:R.thumbnail};b={key:g.lZ(l.videoId,"mainVideoDownloadStateEntity"),playbackData:g.lZ(l.videoId,"playbackData"),addedTimestampMillis:m,videoDownloadContextEntity:g.lZ(l.videoId,"videoDownloadContextEntity")};M={key:g.lZ(l.videoId,"videoPlaybackPositionEntity"),videoId:l.videoId,lastPlaybackPositionSeconds:"0"};
a.aj.V("html5_offline_playback_position_sync")&&(d={playbackPosition:M.key});A=g.lZ(l.videoId,"mainVideoEntity");P={key:A,videoId:l.videoId,title:l.title,thumbnail:l.thumbnail,localizedStrings:{viewCount:l.shortViewCountText},userState:d,lengthSeconds:l.lengthSeconds?Number(l.lengthSeconds):void 0,publishedTimestampMillis:l.publishedTimestamp?(Number(l.publishedTimestamp)*1E3).toString():void 0,formattedDescription:l.description,owner:H.id,downloadState:b.key};if(!a.aj.V("woffle_enable_main_downloads_library")||
!T){e.iT(2);break}return g.z(e,KXn(a.T,[A]),3);case 3:if(p=e.T)G=p.mainDownloadsLibraryEntity,V=p.mainDownloadsListEntity;case 2:return N=Pn9,L={key:g.lZ(l.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.o9(b,N,L),g.z(e,u8(a.T,{mode:"readwrite",xX:!0},function(t){var v=Em(t,H,"ytMainChannelEntity"),S=Em(t,b,"mainVideoDownloadStateEntity"),n=Em(t,P,"mainVideoEntity");v=[v,S,n];a.aj.V("html5_offline_playback_position_sync")&&(S=Em(t,M,"videoPlaybackPositionEntity"),
v.push(S));G&&(S=Em(t,G,"mainDownloadsLibraryEntity"),v.push(S));V&&(S=Em(t,V,"mainDownloadsListEntity"),v.push(S));L&&(t=Em(t,L,"downloadStatusEntity"),v.push(t));return g.Fz.all(v)}),4);
case 4:return e.return({mainVideoEntity:P,channelEntity:H})}})},oeD=function(a,l,m){this.T=a;
this.aj=l;this.Z=m},D$g=function(a,l){var m,T,y,R,H,b,M,d,A,P,G,V,p,L,N,e,t,v,S,n,X,D,yp,H5,ad,Md,U;
return g.J(function(Nd){switch(Nd.L){case 1:return m=gc(l),T=[],g.z(Nd,Bm.getInstance(),2);case 2:y=Nd.T;if(!y){Nd.iT(3);break}return g.z(Nd,y.get("sdois"),4);case 4:return R=Nd.T,g.z(Nd,(b=y)==null?void 0:b.get("lmqf"),5);case 5:H=Nd.T;case 3:g.LP(Nd,6);if(R===void 0)throw Error("prefStorage or opt-in state is undefined");M=[];if(R){Nd.iT(8);break}return g.z(Nd,OrV(a.T),9);case 9:M=Nd.T,M.reverse();case 8:if(!M.length){Nd.iT(10);break}d=g.c(M);A=d.next();case 11:if(A.done){Nd.iT(10);break}P=A.value;
if(!P){Nd.iT(12);break}G=g.aN(P).entityId;return g.z(Nd,Qy(a.T,G),14);case 14:return V=Nd.T,V.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",g.z(Nd,LX(G,a.T,{entityKey:P,actionType:l.actionType},a.Z,V),12);case 12:A=d.next();Nd.iT(11);break;case 10:return g.z(Nd,DP9(R,(p=H)!=null?p:"SD"),16);case 16:return L=Nd.T,g.z(Nd,eGV(L),17);case 17:N=hGX(L);if(!a.aj.V("woffle_enable_main_downloads_library")){Nd.iT(18);break}if(R){Nd.iT(19);break}return g.z(Nd,vY5(a.T,g.sH),19);case 19:return g.z(Nd,
zGn(a.T,[g.sH]),18);case 18:if((e=N)==null?0:e.length)for(t=g.c(N),v=t.next();!v.done;v=t.next())if(n=S=v.value,X=n.actionType,D=n.entityKey,yp=n.actionMetadata,X&&D&&yp&&!g.I(yp,x$n)){X==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(yp.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if(H5=g.I(S.actionMetadata,uC))H5.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",S.actionMetadata=Object.assign({},S.actionMetadata,{mainVideoEntityActionMetadata:H5});T.push(S)}g.e7(Nd,
7);break;case 6:return ad=g.OQ(Nd),Md="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",U="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",ad instanceof g.Ww&&ad.type==="QUOTA_EXCEEDED"&&(Md="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",U="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Nd.return(new $o("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",m,void 0,Md,U));case 7:return Nd.return(new $o("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",m,T))}})},uWg=function(){oC.apply(this,
arguments);
this.N="mainVideoEntity"},Xb_=function(a,l,m){l=l===void 0?43200:l;
m=m===void 0?!0:m;var T=T===void 0?!1:T;var y,R,H;return g.J(function(b){switch(b.L){case 1:if(!a.C.Dq())return b.return([]);y=[];g.LP(b,2);return g.z(b,oYr(l,m,T),4);case 4:y=b.T;g.e7(b,3);break;case 2:R=g.OQ(b),R instanceof Error&&R.message==="No data"||R instanceof Error&&R.message==="Empty response body"&&T3(R.message);case 3:return H=ttX(a,y,m,"mainPlaylistEntity"),b.return(H)}})},Y3s=function(a,l,m,T){T=T===void 0?!1:T;
var y,R,H,b,M,d,A,P,G,V,p,L,N,e,t;return g.J(function(v){switch(v.L){case 1:return y=[],g.z(v,xPB(),2);case 2:return(R=v.T)||T?g.z(v,ues(l,m),3):v.return([]);case 3:H=v.T;if((b=H)==null||!b.length)return v.return([]);M={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};d=g.c(H);A=d.next();case 4:if(A.done){v.iT(6);break}G=P=A.value;V=G.actionType;p=G.entityKey;L=G.actionMetadata;if(!(V&&p&&L)||g.I(L,x$n)){v.iT(5);break}V==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(L.offlineLoggingData=
M);N=g.aN(p);e=N.entityId;return g.z(v,xo(a,[e],"mainVideoEntity",V,L),8);case 8:t=v.T,y=y.concat(t);case 5:A=d.next();v.iT(4);break;case 6:return v.return(y)}})},U$c=function(a,l){this.T=a;
this.Z=l},afD=function(a,l){var m,T,y,R,H,b,M,d,A,P,G,V,p,L,N,e;
return g.J(function(t){switch(t.L){case 1:return m=gc(l),T=g.aN(l.entityKey),y=T.entityId,R=[],g.LP(t,2),g.z(t,rM9(a,y),4);case 4:R=t.T;if((H=R)==null||!H.length){t.iT(5);break}return g.z(t,JQ9(a.T,l.entityKey),5);case 5:g.e7(t,3);break;case 2:return b=g.OQ(t),M="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",d="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",b instanceof g.Ww&&b.type==="QUOTA_EXCEEDED"&&(M="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",d="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
t.return(new $o("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",m,void 0,M,d));case 3:return A=[],g.z(t,G6B(a.T,"musicTrack",R),7);case 7:R=t.T;if(R.length)for(P=g.c(R),G=P.next();!G.done;G=P.next())if(V=G.value,p=V.offlineVideoData,L=void 0,(L=p)==null?0:L.videoId)N=void 0,e=Number(((N=l.actionMetadata)==null?void 0:N.priority)||0)+1,A.push(vq("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",p.videoId,"musicTrack",e,XT,hX(l,p,y)));return t.return(new $o("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",m,A))}})},
lfB=function(a,l){var m,T,y,R,H,b,M,d,A,P,G,V,p,L,N,e,t,v,S,n,X,D,yp,H5,ad,Md,U,Nd,hz,EQ,ec,MF,KP,Ft,Hn,Q,gw,D9,Nj,zd,Gd,ww,fD,vn,h,O,K,f,C,tz,TH,ZR,Rd,v5,UQ,Q5,Qk,$_,XP;
return g.J(function(D2){switch(D2.L){case 1:return m=gc(l),T=l.entityKey,y=g.aN(T).entityId,R=[],H=!1,y==="!*$_ALL_ENTITIES_!*$"?(H=!0,g.z(D2,Um(a.T,"musicAlbumRelease"),5)):g.z(D2,YE(a.T,T,"musicAlbumRelease"),4);case 4:(b=D2.T)&&R.push(b);D2.iT(3);break;case 5:R=D2.T;case 3:if((M=R)==null||!M.length)return D2.return(new $o("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",m));if(H){d=[];A=g.c(R);for(P=A.next();!P.done;P=A.next())G=P.value,V=g.aN(G.id).entityId,d.push(vq("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
V,"musicAlbumRelease",0,XT));return D2.return(new $o("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",m,d))}p=[];L=R[0];N=void 0;if(!L.downloadMetadata){D2.iT(6);break}return g.z(D2,YE(a.T,L.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:e=D2.T,N=Number((v=(t=e)==null?void 0:t.addedTimestampMillis)!=null?v:"0")/1E3;case 6:return g.LP(D2,8),g.z(D2,rM9(a,y,(S=N)==null?void 0:S.toString()),10);case 10:p=D2.T;g.e7(D2,9);break;case 8:n=g.OQ(D2);if(!(n instanceof Error&&n.message===
"No data")){if(n instanceof Error&&n.message==="Empty response body")T3(n.message);else return X="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",D="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",n instanceof g.Ww&&n.type==="QUOTA_EXCEEDED"&&(X="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",D="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),D2.return(new $o("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",m,void 0,X,D));D2.iT(9);break}return g.z(D2,eT(y,"musicAlbumRelease",a.T,
l,a.Z),9);case 9:yp=[];H5=new Map;if((ad=p)==null?0:ad.length)for(Md=g.c(p),U=Md.next();!U.done;U=Md.next())Nd=U.value,hz=Nd.offlineVideoData,EQ=void 0,((EQ=hz)==null?0:EQ.videoId)&&H5.set(hz.videoId,hz);ec=new Map;MF=[];if((KP=L)==null?0:(Ft=KP.tracks)==null?0:Ft.length)for(Hn=g.c(L.tracks),Q=Hn.next();!Q.done;Q=Hn.next())if(gw=Q.value,D9=g.aN(gw).entityId)H5.has(D9)?(ec.set(D9,H5.get(D9)),H5.delete(D9)):MF.push(D9);zd=Number(((Nj=l.actionMetadata)==null?void 0:Nj.priority)||0)+1;Gd=g.c(H5.entries());
for(ww=Gd.next();!ww.done;ww=Gd.next())fD=ww.value,vn=g.c(fD),h=vn.next().value,O=vn.next().value,K=h,f=O,yp.push(vq("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",K,"musicTrack",zd,XT,hX(l,f)));C=g.c(ec.entries());for(tz=C.next();!tz.done;tz=C.next())TH=tz.value,ZR=g.c(TH),Rd=ZR.next().value,v5=ZR.next().value,UQ=Rd,Q5=v5,yp.push(vq("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",UQ,"musicTrack",zd,XT,hX(l,Q5)));Qk=g.c(MF);for($_=Qk.next();!$_.done;$_=Qk.next())XP=$_.value,yp.push(vq("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
XP,"musicTrack",0,XT));return D2.return(new $o("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",m,yp))}})},mMI=function(a,l){var m,T;
return g.J(function(y){switch(y.L){case 1:return m=gc(l),g.LP(y,2),T=g.aN(l.entityKey).entityId,T==="!*$_ALL_ENTITIES_!*$"?g.z(y,FT(a.T,l,a.Z),5):g.z(y,eT(T,"musicAlbumRelease",a.T,l,a.Z),6);case 6:return g.z(y,BOg(a.T,l.entityKey),5);case 5:g.e7(y,3);break;case 2:return g.OQ(y),y.return(new $o("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",m,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return y.return(new $o("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
m))}})},rM9=function(a,l,m){var T,y,R;
return g.J(function(H){switch(H.L){case 1:return g.z(H,CnF([l]),2);case 2:return T=H.T,g.z(H,ThI(a,T[0],m),3);case 3:return y=H.T,R=G3(y.thumbnailDetails),g.z(H,cq(R),4);case 4:return H.return(T[0].videos)}})},ThI=function(a,l,m){var T,y,R,H,b,M,d,A,P,G,V,p,L,N;
return g.J(function(e){if(e.L==1){T=l.additionalMetadadatas;y=void 0;if(T&&T.length>0)for(R=g.c(T),H=R.next();!H.done;H=R.next())if(b=H.value,b.offlineMusicPlaylistData){y=b.offlineMusicPlaylistData;break}M=l.playlistId;d=k6X(l);A=d.Bk;P=d.Vq;G=m?(Number(m)*1E3).toString():Date.now().toString();V=l.lastModifiedTimestamp?(Number(l.lastModifiedTimestamp)*1E3).toString():"0";p={id:g.lZ(M,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:P,lastModifiedTimestampMillis:V,addedTimestampMillis:G,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};L={id:g.lZ(M,"musicAlbumRelease"),title:l.title,audioPlaylistId:M,trackCount:l.totalVideoCount,tracks:A,downloadMetadata:p.id};y&&(L.thumbnailDetails=(N=y.albumHqThumbnail)!=null?N:y.albumArtistThumbnail,L.artistDisplayName=y.albumArtistDisplayName,L.releaseDate=y.albumReleaseDate,L.contentRating={explicitType:y.albumReleaseExplicitType},L.releaseType=y.albumReleaseType);return g.z(e,u8(a.T,{mode:"readwrite",xX:!0},function(t){var v=Em(t,L,"musicAlbumRelease");
t=Em(t,p,"musicAlbumReleaseDownloadMetadataEntity");return g.Fz.all([v,t])}),2)}return e.return(L)})},yWr=function(a,l){this.T=a;
this.Z=l},H5V=function(a,l){var m,T,y,R,H,b,M,d,A,P,G,V,p,L,N,e;
return g.J(function(t){switch(t.L){case 1:return m=gc(l),T=g.aN(l.entityKey),y=T.entityId,R=[],g.LP(t,2),g.z(t,RyI(a,y),4);case 4:R=t.T;if((H=R)==null||!H.length){t.iT(5);break}return g.z(t,JQ9(a.T,l.entityKey),5);case 5:g.e7(t,3);break;case 2:return b=g.OQ(t),M="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",d="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",b instanceof g.Ww&&b.type==="QUOTA_EXCEEDED"&&(M="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",d="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
t.return(new $o("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",m,void 0,M,d));case 3:return A=[],g.z(t,G6B(a.T,"musicTrack",R),7);case 7:R=t.T;if(R.length)for(P=g.c(R),G=P.next();!G.done;G=P.next())if(V=G.value,p=V.offlineVideoData,L=void 0,(L=p)==null?0:L.videoId)N=void 0,e=Number(((N=l.actionMetadata)==null?void 0:N.priority)||0)+1,A.push(vq("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",p.videoId,"musicTrack",e,Yo,hX(l,p,y)));return t.return(new $o("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",m,A))}})},
qu5=function(a,l){var m,T,y,R,H,b,M,d,A,P,G,V,p,L,N,e,t,v,S,n,X,D,yp,H5,ad,Md,U,Nd,hz,EQ,ec,MF,KP,Ft,Hn,Q,gw,D9,Nj,zd,Gd,ww,fD,vn,h,O,K,f,C,tz,TH,ZR,Rd,v5,UQ,Q5,Qk,$_,XP,D2,YA,Nc,jp,$1,Z4,sh,Dn,uv,F6,H6,U8;
return g.J(function(qj){switch(qj.L){case 1:return m=gc(l),T=l.entityKey,y=g.aN(T).entityId,R=[],H=!1,y==="!*$_ALL_ENTITIES_!*$"?(H=!0,g.z(qj,Um(a.T,"musicPlaylist"),5)):g.z(qj,YE(a.T,T,"musicPlaylist"),4);case 4:(b=qj.T)&&R.push(b);qj.iT(3);break;case 5:R=qj.T;case 3:if((M=R)==null||!M.length)return qj.return(new $o("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",m));d=g.I(l.actionMetadata,nYs);P=(A=d)==null?void 0:A.autoSync;G=[];p=V=!0;L=!1;N=void 0;if(!H&&P===!1){qj.iT(6);break}g.LP(qj,7);return g.z(qj,
Xvr(0,!!P,!0,R),9);case 9:G=qj.T;g.e7(qj,8);break;case 7:e=g.OQ(qj);if(!(e instanceof Error&&e.message==="No data")){e instanceof Error&&e.message==="Empty response body"&&T3(e.message);qj.iT(8);break}return y==="!*$_ALL_ENTITIES_!*$"?g.z(qj,FT(a.T,l,a.Z),8):g.z(qj,eT(y,"musicPlaylist",a.T,l,a.Z),8);case 8:if(!G.length||!H&&G[0].playlistId!==y)return qj.return(new $o("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",m));case 6:if(H){t=[];v=g.c(G);for(S=v.next();!S.done;S=v.next())n=S.value,n.upToDate||
P&&!n.shouldAutoSyncMetadata||!n.playlistId||(X={autoSync:P},t.push(vq("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",n.playlistId,"musicPlaylist",0,Yo,{musicPlaylistEntityActionMetadata:X})));return qj.return(new $o("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",m,t))}G.length&&(D=G[0],L=!!D.upToDate,P&&(V=(yp=D.shouldAutoSyncMetadata)!=null?yp:!0,p=(H5=D.shouldAutoSyncVideos)!=null?H5:!0,D.checkInSeconds&&(N=D.checkInSeconds)));if(L||!V)return qj.return(new $o("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
m));ad=[];Md=R[0];U=void 0;if(!Md.downloadMetadata){qj.iT(15);break}return g.z(qj,YE(a.T,Md.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:Nd=qj.T,U=Number((EQ=(hz=Nd)==null?void 0:hz.addedTimestampMillis)!=null?EQ:"0")/1E3;case 15:return g.LP(qj,17),g.z(qj,RyI(a,y,(ec=U)==null?void 0:ec.toString(),N),19);case 19:ad=qj.T;g.e7(qj,18);break;case 17:MF=g.OQ(qj);if(!(MF instanceof Error&&MF.message==="No data")){if(MF instanceof Error&&MF.message==="Empty response body")T3(MF.message);
else return KP="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Ft="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",MF instanceof g.Ww&&MF.type==="QUOTA_EXCEEDED"&&(KP="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Ft="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),qj.return(new $o("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",m,void 0,KP,Ft));qj.iT(18);break}return g.z(qj,eT(y,"musicPlaylist",a.T,l,a.Z),18);case 18:if(!p)return qj.return(new $o("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
m));Hn=[];Q=new Map;if((gw=ad)==null?0:gw.length)for(D9=g.c(ad),Nj=D9.next();!Nj.done;Nj=D9.next())zd=Nj.value,Gd=zd.offlineVideoData,ww=void 0,((ww=Gd)==null?0:ww.videoId)&&Q.set(Gd.videoId,Gd);fD=new Map;vn=[];if((h=Md)==null?0:(O=h.tracks)==null?0:O.length)for(K=g.c(Md.tracks),f=K.next();!f.done;f=K.next())if(C=f.value,tz=g.aN(C).entityId)Q.has(tz)?(fD.set(tz,Q.get(tz)),Q.delete(tz)):vn.push(tz);ZR=Number(((TH=l.actionMetadata)==null?void 0:TH.priority)||0)+1;Rd=g.c(Q.entries());for(v5=Rd.next();!v5.done;v5=
Rd.next())UQ=v5.value,Q5=g.c(UQ),Qk=Q5.next().value,$_=Q5.next().value,XP=Qk,D2=$_,Hn.push(vq("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",XP,"musicTrack",ZR,Yo,hX(l,D2)));YA=g.c(fD.entries());for(Nc=YA.next();!Nc.done;Nc=YA.next())jp=Nc.value,$1=g.c(jp),Z4=$1.next().value,sh=$1.next().value,Dn=Z4,uv=sh,Hn.push(vq("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",Dn,"musicTrack",ZR,Yo,hX(l,uv)));F6=g.c(vn);for(H6=F6.next();!H6.done;H6=F6.next())U8=H6.value,Hn.push(vq("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
U8,"musicTrack",0,Yo));return qj.return(new $o("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",m,Hn))}})},b5D=function(a,l){var m,T;
return g.J(function(y){switch(y.L){case 1:return m=gc(l),g.LP(y,2),T=g.aN(l.entityKey).entityId,T==="!*$_ALL_ENTITIES_!*$"?g.z(y,FT(a.T,l,a.Z),5):g.z(y,eT(T,"musicPlaylist",a.T,l,a.Z),6);case 6:return g.z(y,BOg(a.T,l.entityKey),5);case 5:g.e7(y,3);break;case 2:return g.OQ(y),y.return(new $o("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",m,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return y.return(new $o("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
m))}})},RyI=function(a,l,m,T){var y,R,H;
return g.J(function(b){switch(b.L){case 1:return g.z(b,CnF([l]),2);case 2:return y=b.T,g.z(b,gvX(a,y[0],m,T),3);case 3:return R=b.T,H=G3(R.thumbnailDetails),g.z(b,cq(H),4);case 4:return b.return(y[0].videos)}})},gvX=function(a,l,m,T){var y,R,H,b,M,d,A,P,G;
return g.J(function(V){return V.L==1?(y=l.playlistId,R=k6X(l),H=R.Bk,b=R.Vq,M=m?(Number(m)*1E3).toString():Date.now().toString(),d=l.lastModifiedTimestamp?(Number(l.lastModifiedTimestamp)*1E3).toString():"0",A={id:g.lZ(y,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:b,lastModifiedTimestampMillis:d,addedTimestampMillis:M,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},P={id:g.lZ(y,"musicPlaylist"),title:l.title,playlistId:y,thumbnailDetails:l.thumbnail,visibility:MQX(l),trackCount:l.totalVideoCount,
tracks:H,downloadMetadata:A.id},T&&(((G=P)==null?0:G.entityMetadata)?P.entityMetadata.nextAutoRefreshIntervalSeconds=String(T):P&&(P.entityMetadata={nextAutoRefreshIntervalSeconds:String(T)})),g.z(V,u8(a.T,{mode:"readwrite",xX:!0},function(p){var L=Em(p,P,"musicPlaylist");p=Em(p,A,"musicPlaylistDownloadMetadataEntity");return g.Fz.all([L,p])}),2)):V.return(P)})},MQX=function(a){switch(a.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},i5_=function(a,l){this.T=a;
this.Z=l},Pp9=function(a,l){var m,T,y,R,H,b,M,d,A,P,G,V,p;
return g.J(function(L){switch(L.L){case 1:return m=gc(l),T=g.aN(l.entityKey),y=T.entityId,R=g.I(l.actionMetadata,dMD),g.LP(L,2),g.z(L,jw5(a,y,void 0,(H=R)==null?void 0:H.track,(b=R)==null?void 0:b.albumRelease),4);case 4:if((M=R)==null?0:M.playlistId){L.iT(5);break}return g.z(L,JQ9(a.T,l.entityKey),5);case 5:g.e7(L,3);break;case 2:return d=g.OQ(L),A="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",P="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",d instanceof g.Ww&&d.type==="QUOTA_EXCEEDED"&&
(A="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",P="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),L.return(new $o("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",m,void 0,A,P));case 3:V=Number(((G=l.actionMetadata)==null?void 0:G.priority)||0)+1;var N=(N=g.I(l.actionMetadata,dMD))?{playbackDataActionMetadata:{maximumDownloadQuality:N.maximumDownloadQuality}}:void 0;p=vq("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",y,"playbackData",V,AW_,N);return L.return(new $o("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
m,[p]))}})},Gcs=function(a,l){var m,T,y,R,H,b,M,d,A,P,G,V,p,L,N;
return g.J(function(e){switch(e.L){case 1:return m=gc(l),T=g.aN(l.entityKey),y=T.entityId,g.z(e,YE(a.T,l.entityKey,"musicTrack"),2);case 2:R=e.T;if(!R){H=void 0;e.iT(3);break}return g.z(e,YE(a.T,R.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:H=e.T;case 3:b=H;if(!R||!b)return e.return(new $o("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",m));d=g.I(l.actionMetadata,dMD);g.LP(e,5);return g.z(e,jw5(a,y,b.addedTimestampMillis,(A=d)==null?void 0:A.track,(P=d)==null?void 0:P.albumRelease),
7);case 7:V=Number(((G=l.actionMetadata)==null?void 0:G.priority)||0)+1;M=vq("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",y,"playbackData",V,AW_);g.e7(e,6);break;case 5:p=g.OQ(e);if(!(p instanceof Error&&p.message==="No data")){if(p instanceof Error&&p.message==="Empty response body")T3(p.message);else return L="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",N="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",p instanceof g.Ww&&p.type==="QUOTA_EXCEEDED"&&(L="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
N="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),e.return(new $o("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",m,void 0,L,N));e.iT(6);break}return g.z(e,tX(y,a.T,l,a.Z),6);case 6:return e.return(new $o("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",m,M?[M]:void 0))}})},VQn=function(a,l){var m,T;
return g.J(function(y){switch(y.L){case 1:return m=gc(l),g.LP(y,2),T=g.aN(l.entityKey).entityId,T==="!*$_ALL_ENTITIES_!*$"?g.z(y,FT(a.T,l,a.Z),5):g.z(y,tX(T,a.T,l,a.Z),6);case 6:return g.z(y,BOg(a.T,l.entityKey),5);case 5:g.e7(y,3);break;case 2:return g.OQ(y),y.return(new $o("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",m,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return y.return(new $o("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
m))}})},jw5=function(a,l,m,T,y){var R,H,b,M,d,A;
return g.J(function(P){switch(P.L){case 1:if(R=T){P.iT(2);break}return g.z(P,IyX([l]),3);case 3:H=P.T,b=H[0],R=fyc(b);case 2:return g.z(P,pps(a,R,l,y,m),4);case 4:M=P.T;d=M.musicTrackEntity;A=M.wm;var G=G3(d.thumbnailDetails),V=[];A&&(V=G3(A.thumbnailDetails));return g.z(P,cq(G.concat(V)),0)}})},pps=function(a,l,m,T,y){var R;
return g.J(function(H){return H.L==1?(y||(y=Date.now().toString()),R={id:g.lZ(m,"musicTrackDownloadMetadataEntity"),playbackData:g.lZ(m,"playbackData"),addedTimestampMillis:y,videoDownloadContextEntity:g.lZ(m,"videoDownloadContextEntity")},T&&(l.albumRelease=T.id),g.z(H,u8(a.T,{mode:"readwrite",xX:!0},function(b){var M=[],d=Em(b,R,"musicTrackDownloadMetadataEntity");M.push(d);d=Em(b,l,"musicTrack");M.push(d);T&&(b=Em(b,T,"musicAlbumRelease"),M.push(b));return g.Fz.all(M)}),2)):H.L!=3?g.z(H,jT(m,"musicTrackDownloadMetadataEntity",
a.T,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):H.return({musicTrackEntity:l,
wm:T})})},U1=function(){oC.apply(this,arguments);
this.N="musicTrack"},Z5s=function(a,l,m){l=l===void 0?43200:l;
m=m===void 0?!0:m;var T=T===void 0?!1:T;var y,R;return g.J(function(H){switch(H.L){case 1:if(!a.C.Dq())return H.return([]);y=[];g.LP(H,2);return g.z(H,Xvr(l,m,T),4);case 4:y=H.T;g.e7(H,3);break;case 2:g.OQ(H);case 3:return R=ttX(a,y,m,"musicPlaylist"),H.return(R)}})},Wo_=function(){g.P3.apply(this,arguments);
var a=this;this.events=new g.BT(this);this.aj=this.player.Y();this.lM={lk8:function(){return a.T},
tK:function(){return a.tK()},
gh:function(l){return a.gh(l)}}},cW5=function(a){var l;
a=g.I((l=a.getWatchNextResponse())==null?void 0:l.currentVideoEndpoint,g.m3);if(a==null?0:a.playlistId)var m=a.playlistId;return m},Los=function(a,l){var m,T,y,R;
return g.J(function(H){if(H.L==1){m=l.clientPlaybackNonce;T={cpn:m,offlineSourceVisualElement:g.Fd(l.Cx||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};l.L&&(T.videoFmt=Number(l.L.itag));l.j&&(T.audioFmt=Number(l.j.itag));if((y=cW5(l))&&l.videoId){var b=l.videoId;b=y!=="PPSV"?Promise.resolve(!1):a.T.HH(b);H=g.z(H,b,3)}else H=H.iT(2);return H}H.L!=2&&(R=H.T)&&(T.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");a.L=m;g.js("offlinePlaybackStarted",T);g.c5(H)})};
g.hB.prototype.oT=g.qd(51,function(a){return this.app.oT(a)});
g.Pu.prototype.oT=g.qd(50,function(a){return g.now(this,9,a)});
g.W(fE,S1);g.b7.Object.defineProperties(fE.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.T.entityMetadata},
set:function(a){this.T.entityMetadata=a}}});
g.W(A5V,fE);A5V.prototype.L=function(){return[]};
g.W(Pvr,fE);Pvr.prototype.L=function(){return[]};
g.W(Gac,fE);Gac.prototype.L=function(){return[]};
g.W(Vqr,fE);Vqr.prototype.L=function(){return[]};
g.W(pHg,fE);pHg.prototype.L=function(){var a=[];this.T.alternateChannel&&a.push(this.T.alternateChannel);this.T.alternateChannelList&&a.push.apply(a,g.F(this.T.alternateChannelList));this.T.oneofChannelEntity&&a.push(this.T.oneofChannelEntity);return[].concat(g.F(new Set(a)))};
g.W(ZQD,fE);ZQD.prototype.L=function(){var a=[];this.T.entryCollection&&a.push(this.T.entryCollection);return[].concat(g.F(new Set(a)))};
g.W(W4c,S1);W4c.prototype.L=function(){var a=[];this.T.video&&a.push(this.T.video);return[].concat(g.F(new Set(a)))};
g.W(c5n,fE);c5n.prototype.L=function(){var a=[];this.T.parentPlaylist&&a.push(this.T.parentPlaylist);if(this.T.entries)for(var l=g.c(this.T.entries),m=l.next();!m.done;m=l.next())a.push.apply(a,g.F((new W4c(m.value)).L()));return[].concat(g.F(new Set(a)))};
g.W(L4n,fE);L4n.prototype.L=function(){var a=[];this.T.descriptionEntity&&a.push(this.T.descriptionEntity);this.T.creators&&a.push.apply(a,g.F(this.T.creators));this.T.theBiggestFan&&a.push(this.T.theBiggestFan);return[].concat(g.F(new Set(a)))};
g.W(NZI,fE);NZI.prototype.L=function(){return[]};
g.W(QUn,fE);QUn.prototype.L=function(){return[]};
g.W(tqD,fE);tqD.prototype.L=function(){return[]};
g.W(eac,fE);eac.prototype.L=function(){return[]};
g.W(F4d,fE);F4d.prototype.L=function(){return[]};
g.W(haX,fE);haX.prototype.L=function(){return[]};
g.W(OQs,fE);OQs.prototype.L=function(){return[]};
g.W(K4I,fE);K4I.prototype.L=function(){return[]};
g.W(zaI,fE);zaI.prototype.L=function(){return[]};
g.W(vp5,fE);vp5.prototype.L=function(){var a=[];this.T.downloadsList&&a.push(this.T.downloadsList);this.T.smartDownloadsList&&a.push(this.T.smartDownloadsList);this.T.recommendedDownloadsList&&a.push(this.T.recommendedDownloadsList);this.T.refresh&&a.push(this.T.refresh);return[].concat(g.F(new Set(a)))};
g.W($ag,S1);$ag.prototype.L=function(){var a=[];this.T.video&&a.push(this.T.video);this.T.playlist&&a.push(this.T.playlist);this.T.videoItem&&a.push(this.T.videoItem);this.T.playlistItem&&a.push(this.T.playlistItem);return[].concat(g.F(new Set(a)))};
g.W(sUs,fE);sUs.prototype.L=function(){var a=[];this.T.refresh&&a.push(this.T.refresh);if(this.T.downloads)for(var l=g.c(this.T.downloads),m=l.next();!m.done;m=l.next())a.push.apply(a,g.F((new $ag(m.value)).L()));return[].concat(g.F(new Set(a)))};
g.W(SOB,fE);SOB.prototype.L=function(){var a=[];this.T.localImageEntities&&a.push.apply(a,g.F(this.T.localImageEntities));return[].concat(g.F(new Set(a)))};
g.W(fn5,fE);fn5.prototype.L=function(){var a=[];this.T.playbackData&&a.push(this.T.playbackData);this.T.localImageEntities&&a.push.apply(a,g.F(this.T.localImageEntities));this.T.videoDownloadContextEntity&&a.push(this.T.videoDownloadContextEntity);return[].concat(g.F(new Set(a)))};
g.W(J5d,fE);J5d.prototype.L=function(){return[]};
g.W(BZ_,fE);BZ_.prototype.L=function(){var a=[];this.T.fakeChildren&&a.push.apply(a,g.F(this.T.fakeChildren));return[].concat(g.F(new Set(a)))};
g.W(kaI,fE);kaI.prototype.L=function(){var a=[];this.T.video&&a.push(this.T.video);this.T.playbackData&&a.push(this.T.playbackData);this.T.offlineVideoPolicy&&a.push(this.T.offlineVideoPolicy);return[].concat(g.F(new Set(a)))};
g.W(npB,fE);npB.prototype.L=function(){return[]};
g.W(wHs,fE);wHs.prototype.L=function(){var a=[];this.T.channelOwner&&a.push(this.T.channelOwner);this.T.videos&&a.push.apply(a,g.F(this.T.videos));this.T.collaboratorChannels&&a.push.apply(a,g.F(this.T.collaboratorChannels));this.T.downloadState&&a.push(this.T.downloadState);this.T.refresh&&a.push(this.T.refresh);return[].concat(g.F(new Set(a)))};
g.W(Ins,fE);Ins.prototype.L=function(){var a=[];this.T.video&&a.push(this.T.video);this.T.channelContributor&&a.push(this.T.channelContributor);return[].concat(g.F(new Set(a)))};
g.W(CvV,S1);CvV.prototype.L=function(){var a=[];this.T.localImageEntities&&a.push.apply(a,g.F(this.T.localImageEntities));this.T.videoDownloadContextEntity&&a.push(this.T.videoDownloadContextEntity);return[].concat(g.F(new Set(a)))};
g.W(Epr,S1);Epr.prototype.L=function(){var a=[];this.T.recommendedVideoMetadata&&a.push.apply(a,g.F((new CvV(this.T.recommendedVideoMetadata)).L()));return[].concat(g.F(new Set(a)))};
g.W(opc,S1);opc.prototype.L=function(){var a=[];this.T.playbackPosition&&a.push(this.T.playbackPosition);return[].concat(g.F(new Set(a)))};
g.W(xaI,fE);xaI.prototype.L=function(){var a=[];this.T.owner&&a.push(this.T.owner);this.T.downloadState&&a.push(this.T.downloadState);this.T.userState&&a.push.apply(a,g.F((new opc(this.T.userState)).L()));this.T.additionalMetadata&&a.push.apply(a,g.F((new Epr(this.T.additionalMetadata)).L()));return[].concat(g.F(new Set(a)))};
g.W(Dag,fE);Dag.prototype.L=function(){var a=[];this.T.userChannelDetails&&a.push(this.T.userChannelDetails);return[].concat(g.F(new Set(a)))};
g.W(uyF,fE);uyF.prototype.L=function(){var a=[];this.T.channelOwner&&a.push(this.T.channelOwner);this.T.playbackPosition&&a.push(this.T.playbackPosition);this.T.localImageEntities&&a.push.apply(a,g.F(this.T.localImageEntities));this.T.downloadStatus&&a.push(this.T.downloadStatus);return[].concat(g.F(new Set(a)))};
g.W(XHX,fE);XHX.prototype.L=function(){return[]};
g.W(YOV,fE);YOV.prototype.L=function(){return[]};
g.W(Ua_,fE);Ua_.prototype.L=function(){return[]};
g.W(r5V,fE);r5V.prototype.L=function(){return[]};
g.W(ax5,fE);ax5.prototype.L=function(){return[]};
g.W(lx5,fE);lx5.prototype.L=function(){return[]};
g.W(mSF,fE);mSF.prototype.L=function(){return[]};
g.W(T9X,fE);T9X.prototype.L=function(){return[]};
g.W(ypd,fE);ypd.prototype.L=function(){return[]};
g.W(RUI,fE);RUI.prototype.L=function(){return[]};
g.W(HaV,fE);HaV.prototype.L=function(){return[]};
g.W(q$B,fE);q$B.prototype.L=function(){var a=[];this.T.trackDownloadMetadatas&&a.push.apply(a,g.F(this.T.trackDownloadMetadatas));return[].concat(g.F(new Set(a)))};
g.W(bas,fE);
bas.prototype.L=function(){var a=[];this.T.downloadedTracks&&a.push.apply(a,g.F(this.T.downloadedTracks));this.T.smartDownloadedTracks&&a.push.apply(a,g.F(this.T.smartDownloadedTracks));this.T.downloadedEpisodes&&a.push.apply(a,g.F(this.T.downloadedEpisodes));this.T.downloadedAlbumReleases&&a.push.apply(a,g.F(this.T.downloadedAlbumReleases));this.T.smartDownloadedAlbumReleases&&a.push.apply(a,g.F(this.T.smartDownloadedAlbumReleases));this.T.downloadedPlaylists&&a.push.apply(a,g.F(this.T.downloadedPlaylists));this.T.smartDownloadedPlaylists&&
a.push.apply(a,g.F(this.T.smartDownloadedPlaylists));this.T.metadataOnlyTracks&&a.push.apply(a,g.F(this.T.metadataOnlyTracks));return[].concat(g.F(new Set(a)))};
g.W(gxD,fE);gxD.prototype.L=function(){var a=[];this.T.trackDownloadMetadatas&&a.push.apply(a,g.F(this.T.trackDownloadMetadatas));return[].concat(g.F(new Set(a)))};
g.W(MfF,fE);MfF.prototype.L=function(){var a=[];this.T.playbackData&&a.push(this.T.playbackData);this.T.localImageEntities&&a.push.apply(a,g.F(this.T.localImageEntities));this.T.videoDownloadContextEntity&&a.push(this.T.videoDownloadContextEntity);return[].concat(g.F(new Set(a)))};
g.W(iag,fE);iag.prototype.L=function(){var a=[];this.T.musicLibraryStatusEntity&&a.push(this.T.musicLibraryStatusEntity);this.T.primaryArtists&&a.push.apply(a,g.F(this.T.primaryArtists));this.T.details&&a.push(this.T.details);this.T.userDetails&&a.push(this.T.userDetails);this.T.tracks&&a.push.apply(a,g.F(this.T.tracks));this.T.share&&a.push(this.T.share);this.T.downloadMetadata&&a.push(this.T.downloadMetadata);this.T.refresh&&a.push(this.T.refresh);return[].concat(g.F(new Set(a)))};
g.W(dSD,fE);dSD.prototype.L=function(){var a=[];this.T.albumRelease&&a.push(this.T.albumRelease);this.T.tracks&&a.push.apply(a,g.F(this.T.tracks));return[].concat(g.F(new Set(a)))};
g.W(j3g,fE);j3g.prototype.L=function(){var a=[];this.T.albumRelease&&a.push(this.T.albumRelease);return[].concat(g.F(new Set(a)))};
g.W(Ap5,fE);Ap5.prototype.L=function(){var a=[];this.T.details&&a.push(this.T.details);this.T.userDetails&&a.push(this.T.userDetails);return[].concat(g.F(new Set(a)))};
g.W(Ph5,fE);Ph5.prototype.L=function(){var a=[];this.T.parentArtist&&a.push(this.T.parentArtist);return[].concat(g.F(new Set(a)))};
g.W(GtF,fE);GtF.prototype.L=function(){var a=[];this.T.parentArtist&&a.push(this.T.parentArtist);return[].concat(g.F(new Set(a)))};
g.W(VfI,fE);VfI.prototype.L=function(){return[]};
g.W(pEs,fE);pEs.prototype.L=function(){return[]};
g.W(Zag,S1);Zag.prototype.L=function(){var a=[];this.T.creatorEntity&&a.push(this.T.creatorEntity);return[].concat(g.F(new Set(a)))};
g.W(WpV,fE);
WpV.prototype.L=function(){var a=[];this.T.tracks&&a.push.apply(a,g.F(this.T.tracks));this.T.refresh&&a.push(this.T.refresh);this.T.musicLibraryStatusEntity&&a.push(this.T.musicLibraryStatusEntity);this.T.details&&a.push(this.T.details);this.T.downloadMetadata&&a.push(this.T.downloadMetadata);this.T.sideloadMetadata&&a.push(this.T.sideloadMetadata);this.T.userDetails&&a.push(this.T.userDetails);this.T.entryCollection&&a.push(this.T.entryCollection);this.T.share&&a.push(this.T.share);this.T.podcastShowAdditionalMetadata&&a.push.apply(a,
g.F((new Zag(this.T.podcastShowAdditionalMetadata)).L()));return[].concat(g.F(new Set(a)))};
g.W(cpD,fE);cpD.prototype.L=function(){return[]};
g.W(Lp5,fE);
Lp5.prototype.L=function(){var a=[];this.T.musicLibraryStatusEntity&&a.push(this.T.musicLibraryStatusEntity);this.T.artists&&a.push.apply(a,g.F(this.T.artists));this.T.audioModeVersion&&a.push(this.T.audioModeVersion);this.T.videoModeVersion&&a.push(this.T.videoModeVersion);this.T.userDetails&&a.push(this.T.userDetails);this.T.details&&a.push(this.T.details);this.T.albumRelease&&a.push(this.T.albumRelease);this.T.share&&a.push(this.T.share);this.T.libraryEdit&&a.push(this.T.libraryEdit);this.T.downloadMetadata&&
a.push(this.T.downloadMetadata);this.T.playbackPosition&&a.push(this.T.playbackPosition);this.T.lyrics&&a.push(this.T.lyrics);return[].concat(g.F(new Set(a)))};
g.W(N9s,fE);N9s.prototype.L=function(){var a=[];this.T.parentTrack&&a.push(this.T.parentTrack);return[].concat(g.F(new Set(a)))};
g.W(Q39,fE);Q39.prototype.L=function(){var a=[];this.T.parentTrack&&a.push(this.T.parentTrack);return[].concat(g.F(new Set(a)))};
g.W(tfF,fE);tfF.prototype.L=function(){return[]};
g.W(eUc,fE);eUc.prototype.L=function(){return[]};
g.W(Fp_,fE);Fp_.prototype.L=function(){return[]};
g.W(hUF,fE);hUF.prototype.L=function(){return[]};
g.W(OaD,fE);OaD.prototype.L=function(){var a=[];this.T.transfer&&a.push(this.T.transfer);this.T.adsPlaybackData&&a.push.apply(a,g.F(this.T.adsPlaybackData));this.T.drmLicense&&a.push(this.T.drmLicense);this.T.offlineVideoPolicy&&a.push(this.T.offlineVideoPolicy);this.T.videoDownloadContextEntity&&a.push(this.T.videoDownloadContextEntity);return[].concat(g.F(new Set(a)))};
g.W(KpI,fE);KpI.prototype.L=function(){return[]};
g.W(zU_,fE);zU_.prototype.L=function(){var a=[];this.T.offlineVideoStreams&&a.push.apply(a,g.F(this.T.offlineVideoStreams));this.T.captionTrack&&a.push.apply(a,g.F(this.T.captionTrack));return[].concat(g.F(new Set(a)))};
g.W(vxV,fE);vxV.prototype.L=function(){return[]};
g.W($Ss,fE);$Ss.prototype.L=function(){return[]};
g.W(s3D,fE);s3D.prototype.L=function(){return[]};
g.W(S$_,fE);S$_.prototype.L=function(){return[]};
g.W(fx_,fE);fx_.prototype.L=function(){return[]};
g.W(Jpc,fE);Jpc.prototype.L=function(){return[]};
g.W(B9d,fE);B9d.prototype.L=function(){return[]};
g.W(ktc,fE);ktc.prototype.L=function(){return[]};
g.W(nxF,fE);nxF.prototype.L=function(){return[]};
g.W(wEr,fE);wEr.prototype.L=function(){return[]};
g.W(IxB,fE);IxB.prototype.L=function(){return[]};
g.W(Ch9,fE);Ch9.prototype.L=function(){return[]};
g.W(ExI,fE);ExI.prototype.L=function(){return[]};
g.W(ox_,fE);ox_.prototype.L=function(){return[]};
g.W(xSc,fE);xSc.prototype.L=function(){return[]};
g.W(DSF,fE);DSF.prototype.L=function(){return[]};
g.W(u0D,fE);u0D.prototype.L=function(){return[]};
g.W(XEd,fE);XEd.prototype.L=function(){return[]};
g.W(Y$s,fE);Y$s.prototype.L=function(){return[]};
g.W(US_,fE);US_.prototype.L=function(){return[]};
var YA9=["browse","music/browse","unplugged/browse"],mVs=["offline/playlist_sync_check"],wv_=["offline"],UPn=["offline/offline_video_playback_position_sync"],aKc=["offline/get_playback_data_entity"],Jx;Bm.getInstance=function(){return g.J(function(a){return a.return(new Promise(function(l){g.m8().then(function(m){m?(Bm.instance||(Bm.instance=new Bm(m)),l(Bm.instance)):l(void 0)})}))})};
Bm.prototype.get=function(a){var l=this,m,T,y;return g.J(function(R){if(R.L==1)return g.z(R,m2F(l.token),2);if(R.L!=3)return m=R.T,g.z(R,m.get("prefs",a),3);T=R.T;if(!T)return R.return();y=(0,g.E)();return T.expirationTimestampMs<=y?R.return():R.return(T.value)})};
Bm.prototype.set=function(a,l,m){m=m===void 0?31536E3:m;var T=this,y,R,H;return g.J(function(b){if(b.L==1)return y=(0,g.E)(),R={key:a,value:l,expirationTimestampMs:y+m*1E3},g.z(b,m2F(T.token),2);H=b.T;return g.z(b,g.f2(H,"prefs",R),0)})};
Bm.prototype.remove=function(a){var l=this,m;return g.J(function(T){if(T.L==1)return g.z(T,m2F(l.token),2);m=T.T;return g.z(T,m.delete("prefs",a),0)})};
g.W(kE,g.YH);g.W(nE,qBI);nE.prototype.Z=function(a,l){l=gGg(l);a=(new TextEncoder).encode(JSON.stringify(a));return this.T.encrypt(a,l)};
nE.prototype.L=function(a,l){if(!(a instanceof Uint8Array))throw TXr(1);var m=new TextDecoder;l=gGg(l);a=this.T.decrypt(a,l);return JSON.parse(m.decode(a))};
var MFV={accountLinkStatusEntity:tqD,booleanEntity:Gac,buttonEntity:ExI,captionTrack:tfF,channelHandle:A5V,commerceAcquisitionClientPayloadEntity:xSc,commerceCartListEntity:DSF,contextNoteFeedEntityPayload:Pvr,continuationTokenEntity:npB,downloadQualityPickerEntity:OQs,downloadsPageRefreshTokenEntity:zaI,downloadsPageViewConfigurationEntity:XHX,downloadStatusEntity:K4I,dismissState:B9d,sfvAudioItemCurrentlyPlayingEntity:S$_,emojiFountainDataEntity:IxB,emojiCustomizationSetEntity:wEr,fakeChannel:pHg,
fakePlaylist:ZQD,fakePlaylistEntryCollection:c5n,fakeVideo:L4n,fakeVideoDescription:NZI,featuredProductsEntity:ypd,flowStateEntity:QUn,iconBadgeEntity:u0D,interstitialInteractionStateEntity:F4d,likeButtonAnimationEntity:YOV,liveChatPollStateEntity:haX,liveViewerLeaderboardChatEntryPointStateEntity:$Ss,liveViewerLeaderboardPointsEntity:s3D,liveReactionsDataEntity:Ch9,logoEntity:eac,macroMarkerEntity:Ua_,mainDownloadsLibraryEntity:vp5,mainDownloadsListEntity:sUs,mainPlaylistDownloadStateEntity:SOB,
mainPlaylistEntity:wHs,mainPlaylistVideoEntity:Ins,mainVideoDownloadStateEntity:fn5,mainVideoEntity:xaI,markersEngagementPanelSyncEntity:r5V,markersVisibilityOverrideEntity:ax5,musicAlbumReleaseDetail:dSD,musicAlbumReleaseDownloadMetadataEntity:q$B,musicAlbumRelease:iag,musicAlbumReleaseUserDetail:j3g,musicArtistDetail:Ph5,musicArtist:Ap5,musicArtistUserDetail:GtF,musicDownloadsLibraryEntity:bas,musicLibraryEdit:VfI,musicLibraryStatusEntity:pEs,musicPlaylist:WpV,musicPlaylistDownloadMetadataEntity:gxD,
musicShare:cpD,musicTrackDetail:N9s,musicTrackDownloadMetadataEntity:MfF,musicTrack:Lp5,musicTrackUserDetail:Q39,offlineOrchestrationActionWrapperEntity:eUc,offlineVideoPolicy:Fp_,offlineVideoStreams:hUF,offlineabilityEntity:J5d,orchestrationWebSamplingEntity:BZ_,pageHeaderEntity:ktc,pdpStateEntity:XEd,pinnedProductEntity:RUI,playbackData:OaD,playerStateEntity:lx5,quantityIncrementerEntity:Y$s,refresh:KpI,saveToPlaylistListEntity:fx_,settingEntity:Jpc,stringEntity:Vqr,suggestedFeedbackChipStateEntity:mSF,
transfer:zU_,trendingOfferEntity:HaV,videoDownloadContextEntity:vxV,videoOverviewAsyncDataEntity:US_,videoPlaybackPositionEntity:ox_,votingEntity:nxF,ytMainChannelEntity:Dag,youchatPendingResponseEntity:T9X,ytMainDownloadedVideoEntity:kaI,ytMainVideoEntity:uyF};g.W(xE,qBI);xE.prototype.Z=function(a){return a};
xE.prototype.L=function(a){if(a instanceof Uint8Array)throw TXr(0);return a};
g.W(Do,g.k);Do.prototype.observe=function(a){var l=this;this.observers.push(a);return function(){var m=l.observers.indexOf(a);m>=0&&l.observers.splice(m,1)}};
Do.prototype.L=function(a){Qkd(this,a.data)};
Do.prototype.sL=function(){this.channel.close()};
var O1I,FXB=new g.Ou("elementsCommand");var N0=new g.Ou("entityBatchUpdate");var Pn9=new g.Ou("downloadStatusEntity");var zRB=new g.Ou("mainPlaylistEntityActionMetadata");var uC=new g.Ou("mainVideoEntityActionMetadata");var nYs=new g.Ou("musicPlaylistEntityActionMetadata");var dMD=new g.Ou("musicTrackEntityActionMetadata");var x$n=new g.Ou("localImageEntityActionMetadata");var s1=new g.Ou("playbackDataActionMetadata");var hWd=new g.Ou("transferEntityActionMetadata");var jAs=new g.Ou("videoPlaybackPositionEntityActionMetadata");var EGs;new g.pr;new g.pr;XZV.prototype.request=function(a,l,m){l=l===void 0?{}:l;return this.locks.request(a,l,function(T){return m(T)})};var mx=g.u7.caches,lC,lyB;aC.prototype.open=function(a){return mx.open(rCs(a))};
aC.prototype.has=function(a){return mx.has(rCs(a))};
aC.prototype.delete=function(a){return mx.delete(rCs(a))};
aC.prototype.match=function(a,l){var m=this,T,y,R,H,b,M;return g.J(function(d){switch(d.L){case 1:return g.z(d,m.keys(),2);case 2:T=d.T,y=g.c(T),R=y.next();case 3:if(R.done){d.iT(5);break}H=R.value;return g.z(d,m.open(H),6);case 6:return b=d.T,g.z(d,b.match(a,l),7);case 7:if(M=d.T)return d.return(M);R=y.next();d.iT(3);break;case 5:return d.return()}})};
g.W(U2F,aC);U2F.prototype.keys=function(){var a,l,m,T,y,R,H,b,M;return g.J(function(d){if(d.L==1)return a=[],l=g.UC("CacheStorage keys"),g.z(d,mx.keys(),2);m=d.T;T=g.c(m);for(y=T.next();!y.done;y=T.next()){R=y.value;var A=R.indexOf(":");H=A===-1?{RE:R}:{RE:R.substring(0,A),datasyncId:R.substring(A+1)};b=H.RE;M=H.datasyncId;M===l&&a.push(b)}return d.return(a)})};g.W(yy,g.k);yy.prototype.Z=function(a){this.api.Pz("onOfflineOperationFailure",a.data)};
yy.prototype.j=function(a){this.api.publish("offlinetransferpause",a.data)};
yy.prototype.sL=function(){var a;(a=this.T)==null||a.close();var l;(l=this.L)==null||l.close()};yQ9.prototype.aY=function(){this.T&&Hq(this)};
yQ9.prototype.ij=function(){this.L&&this.L.resolve();this.Z=this.T=!1;this.N()};var E$r=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var QIs="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var SA9="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.W(yyV,z3);yyV.prototype.L=function(a){return M0(a)?qds(this,a):iC(a)?MYr(this,a):Promise.reject(Error("Unsupported action type: "+a.actionType))};g.W(iG5,z3);iG5.prototype.L=function(a){return iC(a)?dVs(this,a):AQI(a)?Ayn(this,a):dc(a)?P_I(this,a):Promise.reject(Error("Unsupported action type: "+a.actionType))};g.Z=GJF.prototype;g.Z.s0b=function(a){var l=this,m,T,y,R;return g.J(function(H){if(!g.u(a.state,128))return H.iT(0);m=a.state.p7;var b=(T=m)==null?void 0:T.errorCode,M=(y=m)==null?void 0:y.ZL;R=b==="net.connect"&&M===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(b==null?0:b.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return g.z(H,l.h2(l.player.getVideoData().videoId,R),0)})};
g.Z.h2=function(a,l){var m=this;return g.J(function(T){if(T.L==1){if(m.L)return T.return();m.L=!0;return l==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?(JX(m,a,!1,!0),T.iT(0)):g.z(T,fX(m,a),3)}g.sS(a,4);return g.z(T,m.T.h2(l),0)})};
g.Z.oE=function(a){a.status===2?(a.status!==this.Z&&(d$s(this.T),g.sS(a.videoId,2)),a.zO&&VtF(this.T,a.videoId,a.zO)):a.status===4?(fX(this,a.videoId),this.h2(a.videoId,a.vK?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):a.status===1&&Gwc(this.T);this.Z=a.status;this.api.Pz("localmediachange",{videoId:a.videoId,status:a.status})};
g.Z.pC=function(){var a=this,l;return g.J(function(m){if(m.L==1){if(a.L)return m.return();a.L=!0;l=a.player.getVideoData().videoId;return g.z(m,fX(a,l),2)}return g.z(m,a.T.pC(),0)})};
g.Z.DB=function(a){switch(a){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.Z.V=function(a){return this.api.Y().V(a)};g.W(NR9,z3);NR9.prototype.L=function(a){return M0(a)?tYI(this,a):iC(a)?eWX(this,a):AQI(a)?Fy_(this,a):Promise.reject(Error("Unsupported action type: "+a.actionType))};$Vr.prototype.T=function(a,l){var m=a.action.actionMetadata.priority-l.action.actionMetadata.priority;m===0&&(a.T<l.T?m=-1:a.T>l.T&&(m=1));return m};g.W(Bq,g.k);Bq.prototype.sL=function(){this.N&&this.N();g.k.prototype.sL.call(this)};
Bq.prototype.createAction=function(a,l){var m=g.aN(a.entityKey).entityType,T=g.FH(16);return new Vy(m,T,a,l.actionId,l.rootActionId)};
Bq.prototype.lT=function(a){var l=this,m,T,y,R,H,b,M,d,A;return g.J(function(P){if(P.L==1){if(l.FO())return P.return();T=(m=a.offlineOrchestrationActionWrapperEntity)!=null?m:new Set;y=[];R=g.c(T);for(H=R.next();!H.done;H=R.next())b=H.value,M=g.aN(b),d=M.entityId,fKF(l.T,d)||y.push(b);return g.z(P,DVF(l,y),2)}A=P.T;return g.z(P,xVI(l,A),0)})};
Bq.prototype.retry=function(){var a=this;return g.J(function(l){return g.z(l,u3V(a),0)})};YdX.prototype.pu=function(a,l){l=l===void 0?!0:l;var m=this,T,y,R,H,b,M,d,A;return g.J(function(P){switch(P.L){case 1:if(!m.T)return P.return();T=[];y=g.mB(m.T.L,l);R=[];for(H={Jx:0};H.Jx<y.length;H={Jx:H.Jx},H.Jx++)b=y[H.Jx],M=m.T.G7(b,"json3"),d=g.$a(M,{withCredentials:!0,format:"RAW"},3,500).then(function(G){return function(V){V={metadata:g.Zj(y[G.Jx]),trackData:V.xhr.responseText};R.push(V)}}(H)).wd(function(G){T3("Caption fetch error",G)}),T.push(d);
return g.z(P,jUc(T),2);case 2:return g.LP(P,3),g.z(P,JC_(a,R),5);case 5:g.e7(P,0);break;case 3:A=g.OQ(P),T3("Caption DB transaction error",A),g.c5(P)}})};g.W(ko,g.k);ko.prototype.sL=function(){this.L&&this.L();g.k.prototype.sL.call(this)};
ko.prototype.Z=function(a){var l=this,m,T,y,R,H,b,M,d;return g.J(function(A){T=(m=a.transfer)!=null?m:new Set;y=[];R=g.c(T);for(H=R.next();!H.done;H=R.next())b=H.value,M=g.aN(b),d=M.entityId,y.push(d);return y.length===0?A.return():g.z(A,aSr(l,y),0)})};g.W(RRg,g.k);g.Z=RRg.prototype;g.Z.sL=function(){this.jt&&this.jt();this.qj.dispose();this.j.dispose();this.Cx&&g.Rk(this.C.UO,this.Cx);this.Kx&&g.Rk(this.C.UO,this.Kx);g.k.prototype.sL.call(this)};
g.Z.f6O=function(a){var l=this,m,T,y;return g.J(function(R){switch(R.L){case 1:m=g.lZ(a,"transfer");if(l.T&&m===l.T.key){JX(l.B,l.K,!0);l.j.stop();R.iT(0);break}return g.z(R,u8(l.L,{mode:"readwrite",xX:!0},function(H){return wB(H,m,"transfer").then(function(b){if(b&&b.transferState!=="TRANSFER_STATE_COMPLETE"&&b.transferState!=="TRANSFER_STATE_FAILED")return b.transferState="TRANSFER_STATE_PAUSED_BY_USER",Em(H,b,"transfer").then(function(){return b})})}),3);
case 3:T=R.T;if(!T){R.iT(0);break}if(!a||!l.Z){R.iT(5);break}return g.z(R,jT(a,l.Z,l.L,"DOWNLOAD_STATE_PAUSED"),5);case 5:return g.z(R,IC(l,a),7);case 7:y=R.T,dPV({videoId:a,Ms:T,offlineModeType:y}),g.c5(R)}})};
g.Z.JbT=function(){var a=this;if(this.T&&this.K){JX(this.B,this.K,!1);var l=this.T,m=(l==null?0:l.key)?g.aN(l.key).entityId:"";m&&this.Z&&(new Promise(function(T,y){jT(m,a.Z,a.L,"DOWNLOAD_STATE_PAUSED").catch(function(R){y(R)})})).catch(function(T){T3("Download state setting error",T)})}this.j.stop()};
g.Z.u8=function(){this.T?beg(this,this.T):wc(this)};
g.Z.u6=function(a){var l=this;return g.J(function(m){switch(m.L){case 1:if(!l.T){m.iT(2);break}if(l.T.transferState==="TRANSFER_STATE_COMPLETE"||l.T.transferState==="TRANSFER_STATE_FAILED"||!a.transfer||!a.transfer.has(l.T.key)){m.iT(3);break}return g.z(m,YE(l.L,l.T.key,"transfer"),4);case 4:l.T=m.T;if(l.T){m.iT(3);break}return g.z(m,ge_(l),3);case 3:if(l.T)return m.return();case 2:return g.z(m,wc(l),0)}})};
g.Z.h2=function(a,l){var m=this,T,y,R,H,b;return g.J(function(M){switch(M.L){case 1:if(!m.T){CX(m,"onTransferFailure: "+a);M.iT(2);break}T=m.T;R=((y=T)==null?0:y.key)?g.aN(T.key).entityId:"";a:switch(a){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var d=!1;break a;default:d=!0}return d&&pbr(m)?g.z(M,E1(m,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):g.z(M,
ZeX(m,a),5);case 5:if(!R||!m.Z){M.iT(2);break}return g.z(M,jT(R,m.Z,m.L,"DOWNLOAD_STATE_FAILED"),2);case 8:return g.z(M,IC(m,R),9);case 9:H=M.T;bC({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:R,Ms:T,offlineModeType:H});if(!R||!m.Z){M.iT(2);break}return g.z(M,jT(R,m.Z,m.L,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:nX(m),b=wc(m,!0),l&&l(b),g.c5(M)}})};
g.Z.pC=function(a){var l=this,m,T,y,R,H,b,M,d,A,P,G,V;return g.J(function(p){switch(p.L){case 1:if(!l.T){CX(l,"onMaybeTransferStreamsExpired");p.iT(2);break}return pbr(l)?g.z(p,E1(l,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):g.z(p,ZeX(l,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!l.Z){p.iT(2);break}m=l.T;y=((T=m)==null?0:T.key)?g.aN(m.key).entityId:"";if(!y){p.iT(2);break}return g.z(p,jT(y,l.Z,l.L,"DOWNLOAD_STATE_FAILED"),2);case 9:return l.T||CX(l,"onMaybeTransferStreamsExpiredRetryAttempting"),
R=l.T,b=((H=R)==null?0:H.key)?g.aN(R.key).entityId:"",g.z(p,IC(l,b),10);case 10:return M=p.T,bC({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:b,Ms:R,offlineModeType:M}),d=pvF(),g.o9(d,s1,{isEnqueuedForExpiredStreamUrlRefetch:!0}),A=g.lZ(b,"playbackData"),P={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:A,actionMetadata:d},G=ZT(new Vy("playbackData",b,P)),g.z(p,Xo(l.L,G,"offlineOrchestrationActionWrapperEntity"),2);case 2:nX(l),V=wc(l,!0),
a&&a(V),g.c5(p)}})};
var Nh9={},WqV=(Nh9.TRANSFER_STATE_TRANSFERRING=1,Nh9.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,Nh9);g.Z=oC.prototype;g.Z.KD=function(){return this.K.promise};
g.Z.ST=function(){if(this.L&&this.B)return this.K.promise;NKV(this).then(this.K.resolve).catch(this.K.reject);return this.K.promise};
g.Z.yR=function(a){var l={};return l.playbackData=new yyV(a,this.aj,this.T),l.transfer=new NR9(a,this.aj),l.videoPlaybackPositionEntity=new iG5(a,this.aj),l};
g.Z.Gv=function(){var a=this;return g.J(function(l){return a.L?g.z(l,Hec(a.L),0):l.iT(0)})};
g.Z.po=function(){var a=this,l,m;return g.J(function(T){if(T.L==1)return a.L||a.B?g.z(T,a.KD(),2):T.return();a.J!==void 0&&(g.Ly(a.J),a.J=void 0);a.j!==void 0&&(g.Ly(a.j),a.j=void 0);(l=a.L)==null||l.dispose();a.L=void 0;(m=a.B)==null||m.dispose();a.B=void 0;a.api.Pz("onOrchestrationLostLeader");a.K=new g.pr;g.c5(T)})};
g.Z.isOrchestrationLeader=function(){return this.Z.T};
g.Z.HH=function(){return g.J(function(a){return a.return(!1)})};
g.Z.j3=function(a){var l=this.T;l.api.publish("offlinetransferpause",a);var m;(m=l.L)==null||m.postMessage(a)};
g.Z.u8=function(a){var l,m;return g.J(function(T){if(T.L==1)return g.z(T,rB(),2);l=T.T;if(!l)return T.return();m=g.lZ(a,"transfer");return g.z(T,u8(l,{mode:"readwrite",xX:!0},function(y){var R=wB(y,m,"transfer"),H=wB(y,g.lZ(a,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.Fz.all([R,H]).then(function(b){b=g.c(b);var M=b.next().value;var d=b.next().value;return M&&M.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(M.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",Em(y,M,"transfer").then(function(){bC({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:a,Ms:M,offlineModeType:d==null?void 0:d.offlineModeType});return g.Fz.resolve(null)})):g.Fz.resolve(null)})}),0)})};
g.Z.S3=function(a){a=a===void 0?43200:a;var l=this,m,T,y,R,H,b,M,d;return g.J(function(A){if(A.L==1)return l.C.Dq()?g.z(A,rB(),2):A.return(QH_());if(A.L!=3){m=A.T;if(!m)return A.return([]);T=Date.now()/1E3;return g.z(A,Um(m,"offlineVideoPolicy"),3)}y=A.T;R=[];H=g.c(y);for(b=H.next();!b.done;b=H.next())M=b.value,Number(M.lastUpdatedTimestampSeconds)+a<=T&&(d=g.aN(M.key).entityId,R.push(d));return R.length?A.return(xo(l,R,l.N,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):A.return([])})};
g.Z.deleteAll=function(){return xo(this,["!*$_ALL_ENTITIES_!*$"],this.N,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.Z.refreshAllStaleEntities=function(a){var l=this;return g.J(function(m){return m.L==1?g.z(m,l.S3(a),2):m.return(m.T)})};
g.Z.setUpPositionSyncInterval=function(a){var l=this;this.j!==void 0&&(g.Ly(this.j),this.j=void 0);var m=a!=null?a:864E5;this.j=g.W$(function(){l.c8(m)},m)};
g.Z.c8=function(a){var l=this,m,T,y,R,H,b;return g.J(function(M){switch(M.L){case 1:return g.LP(M,2),g.z(M,Bm.getInstance(),4);case 4:m=M.T;if(!m)throw Error("prefStorage is undefined");return g.z(M,m.get("psi"),5);case 5:T=M.T;R=((y=T)==null?0:y.wG)?Number(T.wG)/1E3:0;H=Date.now();if(!(R+a<=H)){M.iT(6);break}return g.z(M,xo(l,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:g.e7(M,0);break;case 2:b=g.OQ(M),T3("Offline manager error",b),
g.c5(M)}})};
g.Z.rX=function(){var a=this,l,m,T,y,R,H,b;return g.J(function(M){if(M.L==1)return g.z(M,rB(),2);if(M.L!=3)return(l=M.T)?g.z(M,Um(l,"transfer"),3):M.return([]);m=M.T;T=[];y=g.c(m);for(R=y.next();!R.done;R=y.next())H=R.value,H.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&H.key&&(b=g.aN(H.key).entityId,T.push(b));return M.return(eRn(a,T))})};
g.Z.nw=function(){return g.J(function(a){return a.return([])})};
g.Z.KJ=function(){return g.J(function(a){g.c5(a)})};
g.Z.Nv=function(){return g.J(function(a){g.c5(a)})};g.W(Fqr,z3);Fqr.prototype.L=function(a){return M0(a)?Kqg(this,a):iC(a)?veF(this,a):dc(a)?$$B(this,a):Promise.reject(Error("Unsupported action type: "+a.actionType))};
var DT=[10];g.W(BKs,z3);BKs.prototype.L=function(a){return M0(a)?wbs(this,a):iC(a)?ISB(this,a):dc(a)?C0V(this,a):Promise.reject(Error("Unsupported action type: "+a.actionType))};
var nes=[10];g.W(oeD,z3);oeD.prototype.L=function(a){return iC(a)?D$g(this,a):Promise.reject(Error("Unsupported action type: "+a.actionType))};g.W(uWg,oC);g.Z=uWg.prototype;g.Z.yR=function(a){var l=oC.prototype.yR.call(this,a);l.mainVideoEntity=new BKs(a,this.aj,this.T);l.mainPlaylistEntity=new Fqr(a,this.aj,this.T);l.mainDownloadsListEntity=new oeD(a,this.aj,this.T);return l};
g.Z.refreshAllStaleEntities=function(a,l){var m=this,T,y,R,H,b,M,d,A,P,G,V;return g.J(function(p){switch(p.L){case 1:T=[];if(!m.aj.V("web_player_offline_playlist_auto_refresh")){p.iT(2);break}return g.z(p,Xb_(m,a,l),3);case 3:T=p.T;case 2:return g.z(p,Bm.getInstance(),4);case 4:return y=p.T,g.z(p,(R=y)==null?void 0:R.get("sdois"),5);case 5:return H=p.T,g.z(p,(b=y)==null?void 0:b.get("lmqf"),6);case 6:M=p.T;if(!H){p.iT(7);break}A=T;P=A.concat;return g.z(p,Y3s(m,H,(d=M)!=null?d:"SD",a===0),8);case 8:T=
P.call(A,p.T);case 7:return G=T,V=G.concat,g.z(p,oC.prototype.refreshAllStaleEntities.call(m,a,l),9);case 9:return T=V.call(G,p.T),p.return(T)}})};
g.Z.HH=function(a){var l,m,T,y,R,H,b,M;return g.J(function(d){if(d.L==1)return g.z(d,rB(),2);if(d.L!=3)return(l=d.T)?g.z(d,YE(l,g.sH,"mainDownloadsListEntity"),3):d.return(!1);m=d.T;if((T=m)==null?0:(y=T.downloads)==null?0:y.length)for(R=g.lZ(a,"mainVideoEntity"),H=g.c(m.downloads),b=H.next();!b.done;b=H.next())if(M=b.value,M.videoItem===R)return d.return(!0);return d.return(!1)})};
g.Z.nw=function(){var a=this,l,m,T,y,R,H,b,M;return g.J(function(d){if(d.L==1)return g.z(d,rB(),2);if(d.L!=3)return(l=d.T)?g.z(d,Um(l,"downloadStatusEntity"),3):d.return([]);m=d.T;T=[];y=g.c(m);for(R=y.next();!R.done;R=y.next())H=R.value,H.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&H.key&&(b=g.aN(H.key).entityId,T.push(b));return T.length?(M={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},d.return(xo(a,T,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
M))):d.return([])})};
g.Z.Nv=function(){var a;return g.J(function(l){return l.L==1?g.z(l,rB(),2):(a=l.T)?g.z(l,u8(a,{mode:"readwrite",xX:!0},function(m){return IJ(m,"mainVideoEntity").then(function(T){var y=[];T=g.c(T);for(var R=T.next();!R.done;R=T.next()){R=R.value;var H=void 0;(H=R.userState)!=null&&H.playbackPosition||(H=g.aN(R.key).entityId,H={key:g.lZ(H,"videoPlaybackPositionEntity"),videoId:H,lastPlaybackPositionSeconds:"0"},y.push(Em(m,H,"videoPlaybackPositionEntity")),R.userState={playbackPosition:H.key},y.push(Em(m,
R,"mainVideoEntity")))}return g.Fz.all(y)})}),0):l.return()})};
g.Z.KJ=function(){var a,l,m,T,y,R,H,b,M,d,A,P,G,V,p,L,N,e,t,v,S,n,X,D,yp,H5,ad,Md,U,Nd,hz,EQ,ec,MF,KP,Ft,Hn,Q;return g.J(function(gw){if(gw.L==1)return g.z(gw,rB(),2);if(gw.L!=3){a=gw.T;if(!a)return gw.return();l=g.lZ("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return g.z(gw,u8(a,{mode:"readonly",xX:!0},function(D9){return g.Fz.all([wB(D9,l,"mainDownloadsListEntity"),wB(D9,g.sH,"mainDownloadsListEntity"),IJ(D9,"mainVideoEntity"),IJ(D9,"mainPlaylistEntity")])}),3)}m=gw.T;
T=g.c(m);y=T.next().value;R=T.next().value;H=T.next().value;b=T.next().value;M=y;d=R;A=H;P=b;G=new Set;if((V=M)==null?0:(p=V.downloads)==null?0:p.length)for(L=g.c(M.downloads),N=L.next();!N.done;N=L.next())e=N.value,t=void 0,(v=(t=e.videoItem)!=null?t:e.playlistItem)&&G.add(v);if((S=d)==null?0:(n=S.downloads)==null?0:n.length)for(X=g.c(d.downloads),D=X.next();!D.done;D=X.next())yp=D.value,yp.videoItem&&G.add(yp.videoItem);H5=new Set;ad=[];Md=g.c(P);for(U=Md.next();!U.done;U=Md.next()){Nd=U.value;
if(Nd.videos)for(hz=g.c(Nd.videos),EQ=hz.next();!EQ.done;EQ=hz.next())ec=EQ.value,(MF=JSON.parse(g.aN(ec).entityId).videoId)&&H5.add(MF);Nd.key&&!G.has(Nd.key)&&ad.push(Nd.key)}KP=g.c(A);for(Ft=KP.next();!Ft.done;Ft=KP.next())Hn=Ft.value,Hn.key&&!G.has(Hn.key)&&(Q=g.aN(Hn.key).entityId,H5.has(Q)||ad.push(Hn.key));return ad.length?g.z(gw,zGn(a,ad),0):gw.iT(0)})};g.W(U$c,z3);U$c.prototype.L=function(a){return M0(a)?afD(this,a):iC(a)?lfB(this,a):dc(a)?mMI(this,a):Promise.reject(Error("Unsupported action type: "+a.actionType))};
var XT=[10];g.W(yWr,z3);yWr.prototype.L=function(a){return M0(a)?H5V(this,a):iC(a)?qu5(this,a):dc(a)?b5D(this,a):Promise.reject(Error("Unsupported action type: "+a.actionType))};
var Yo=[10];g.W(i5_,z3);i5_.prototype.L=function(a){return M0(a)?Pp9(this,a):iC(a)?Gcs(this,a):dc(a)?VQn(this,a):Promise.reject(Error("Unsupported action type: "+a.actionType))};
var AW_=[10];g.W(U1,oC);U1.prototype.yR=function(a){var l=oC.prototype.yR.call(this,a);l.musicTrack=new i5_(a,this.T);l.musicPlaylist=new yWr(a,this.T);l.musicAlbumRelease=new U$c(a,this.T);return l};
U1.prototype.refreshAllStaleEntities=function(a,l){var m=this,T,y,R;return g.J(function(H){if(H.L==1)return g.z(H,Z5s(m,a,l),2);if(H.L!=3)return y=T=H.T,R=y.concat,g.z(H,oC.prototype.refreshAllStaleEntities.call(m,a,l),3);T=R.call(y,H.T);return H.return(T)})};g.W(Wo_,g.P3);g.Z=Wo_.prototype;g.Z.create=function(){var a=this;g.w(this,this.events);if(g.aX(this.aj))this.T=new uWg(this.aj,this.player);else if(g.IE(this.aj)||g.yX(this.aj)==="WEB_MUSIC_INTEGRATIONS")this.T=new U1(this.aj,this.player);this.events.W(this.player,"onPlaybackStartExternal",function(){a.tK()});
this.events.W(this.player,"videodatachange",function(){a.tK()});
this.aj.V("html5_offline_playback_position_sync")&&this.events.W(this.player,"presentingplayerstatechange",this.gh)};
g.Z.fl=function(){return!1};
g.Z.T6=function(a,l,m,T){var y=this;return g.J(function(R){return y.T?R.return(xo(y.T,a,l,m,T)):R.return(Promise.reject())})};
g.Z.deleteAll=function(){return this.T.deleteAll()};
g.Z.S3=function(a){return this.T.S3(a)};
g.Z.refreshAllStaleEntities=function(a){return this.T.refreshAllStaleEntities(a)};
g.Z.setUpPositionSyncInterval=function(a){this.T.setUpPositionSyncInterval(a)};
g.Z.j3=function(a){this.T.j3(a)};
g.Z.u8=function(a){return this.T.u8(a)};
g.Z.tK=function(){var a=this,l;return g.J(function(m){l=a.player.getVideoData();return g.u9(l)?cW5(l)&&a.L!==l.clientPlaybackNonce?g.z(m,Los(a,l),0):m.iT(0):m.return()})};
g.Z.gh=function(a){var l=this,m,T,y,R,H,b,M;return g.J(function(d){if(d.L==1)return m=l.player.getVideoData(),T=m.wW,g.Wr(a,2)||g.Wr(a,512)?g.z(d,rB(),2):d.return();if(d.L!=3){y=d.T;if(!y)return T3("PES is undefined"),d.return();R=m.videoId;return g.z(d,YE(y,g.lZ(R,"mainVideoEntity"),"mainVideoEntity"),3)}H=d.T;if(!H)return d.return();b=Math.floor(T).toString();M={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:b}};return g.z(d,l.T6([R],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
M),0)})};
g.Z.isOrchestrationLeader=function(){return this.T.isOrchestrationLeader()};
g.Z.updateDownloadState=function(a,l){var m,T,y,R;return g.J(function(H){if(H.L==1)return g.z(H,rB(),2);m=H.T;if(!m)return T3("PES is undefined"),H.return();T=g.aN(a);y=T.entityType;R=T.entityId;return g.z(H,jT(R,y,m,l,!0),0)})};g.AO("offline",Wo_);})(_yt_player);
